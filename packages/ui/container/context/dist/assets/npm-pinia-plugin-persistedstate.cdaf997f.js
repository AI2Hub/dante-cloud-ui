var e=Object.defineProperty,r=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,a=(r,t,o)=>t in r?e(r,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):r[t]=o,n=(e,n)=>{for(var s in n||(n={}))t.call(n,s)&&a(e,s,n[s]);if(r)for(var s of r(n))o.call(n,s)&&a(e,s,n[s]);return e};function s(e){return e}function i(e,r){var t;return e="object"==typeof(t=e)&&null!==t?e:Object.create(null),new Proxy(e,{get(e,t,o){var a;return"key"===t?(null!=(a=r.key)?a:s)(Reflect.get(e,t,o)):Reflect.get(e,t,o)||Reflect.get(r,t,o)}})}function l(e){return null!==e&&"object"==typeof e}function c(e,r){const t=Array.isArray(e)&&Array.isArray(r),o=l(e)&&l(r);if(!t&&!o)throw new Error("Can only merge object with object or array with array");const a=t?[]:{};return[...Object.keys(e),...Object.keys(r)].forEach((t=>{Array.isArray(e[t])&&Array.isArray(r[t])?a[t]=[...Object.values(c(e[t],r[t]))]:null!==r[t]&&"object"==typeof r[t]&&"object"==typeof e[t]?a[t]=c(e[t],r[t]):void 0!==e[t]&&void 0===r[t]?a[t]=e[t]:void 0===e[t]&&void 0!==r[t]&&(a[t]=r[t])})),a}function y(e,r){return r.reduce(((e,r)=>"[]"===r&&Array.isArray(e)?e:null==e?void 0:e[r]),e)}function u(e,r,t){const o=r.slice(0,-1).reduce(((e,r)=>/^(__proto__)$/.test(r)?{}:e[r]=e[r]||{}),e);if(Array.isArray(o[r[r.length-1]])&&Array.isArray(t)){const e=o[r[r.length-1]].map(((e,r)=>Array.isArray(e)&&"object"!=typeof e?[...e,...t[r]]:"object"==typeof e&&null!==e&&Object.keys(e).some((r=>Array.isArray(e[r])))?c(e,t[r]):n(n({},e),t[r])));o[r[r.length-1]]=e}else void 0===r[r.length-1]&&Array.isArray(o)&&Array.isArray(t)?o.push(...t):o[r[r.length-1]]=t;return e}function f(e,r){return r.reduce(((r,t)=>{const o=t.split(".");if(!o.includes("[]"))return u(r,o,y(e,o));const a=o.indexOf("[]"),n=o.slice(0,a),s=o.slice(0,a+1),i=o.slice(a+1),l=y(e,s),c=[];for(const e of l)0===i.length||!Array.isArray(e)&&"object"!=typeof e?c.push(e):c.push(f(e,[i.join(".")]));return u(r,n,c)}),Array.isArray(e)?[]:{})}function b(e,r,t,o,a){try{const a=null==r?void 0:r.getItem(o);a&&e.$patch(null==t?void 0:t.deserialize(a))}catch(n){}}function p(e={}){return r=>{const{options:{persist:t},store:o}=r;if(!t)return;const a=(Array.isArray(t)?t.map((r=>i(r,e))):[i(t,e)]).map((({storage:e=localStorage,beforeRestore:r=null,afterRestore:t=null,serializer:a={serialize:JSON.stringify,deserialize:JSON.parse},key:n=o.$id,paths:s=null,debug:i=!1})=>({storage:e,beforeRestore:r,afterRestore:t,serializer:a,key:n,paths:s,debug:i})));a.forEach((e=>{const{storage:t,serializer:a,key:n,paths:s,beforeRestore:i,afterRestore:l,debug:c}=e;null==i||i(r),b(o,t,a,n),null==l||l(r),o.$subscribe(((e,r)=>{try{const e=Array.isArray(s)?f(r,s):r;t.setItem(n,a.serialize(e))}catch(o){}}),{detached:!0})})),o.$hydrate=({runHooks:e=!0}={})=>{a.forEach((t=>{const{beforeRestore:a,afterRestore:n,storage:s,serializer:i,key:l,debug:c}=t;e&&(null==a||a(r)),b(o,s,i,l),e&&(null==n||n(r))}))}}}export{p as c};
