import{I as t}from"./npm-ids.5da4be8a.js";import{i as e,g as n,f as i}from"./npm-bpmn-js.b6fce442.js";import{h as o,n as s}from"./npm-min-dash.ee8df4a0.js";import{i as r}from"./npm-inherits.058e0d9d.js";import{a,b as c,c as l,d as p,e as h,f as u,g as m}from"./npm-min-dom.8fd3350a.js";import{c as d,a as f,b as v,r as g}from"./npm-tiny-svg.98039dc0.js";import{r as _}from"./npm-randomcolor.b697b63b.js";import{e as y}from"./npm-diagram-js.3dccf4f1.js";const b=Object.freeze({ACTIVATED:1,RUNNING:2,ENDING:4,ENDED:8,DESTROYED:16,FAILED:32,TERMINATED:64,CANCELED:128,COMPLETED:256,COMPENSABLE:512,ACTIVE:7,NOT_DEAD:9}),w={};function S(t,e){throw new Error(`illegal transition: ${t.name} -> ${e}`)}function E(t,e){return t===w?e:t}class C{constructor(t,e,{start:n,cancel:i,complete:o,destroy:s,fail:r,terminate:a,compensable:c}={}){this.name=t,this.traits=e,this._start=E(n,this),this._compensable=E(c,this),this._cancel=E(i,this),this._complete=E(o,this),this._destroy=E(s,this),this._fail=E(r,this),this._terminate=E(a,this)}hasTrait(t){return 0!=(this.traits&t)}complete(){return this._complete||S(this,"complete")}destroy(){return this._destroy||S(this,"destroy")}cancel(){return this._cancel||S(this,"cancel")}fail(){return this._fail||S(this,"fail")}terminate(){return this._terminate||S(this,"terminate")}compensable(){return this._compensable||S(this,"compensable")}start(){return this._start||S(this,"start")}}const x=new C("failed",b.DESTROYED|b.FAILED),B=new C("terminated",b.DESTROYED|b.TERMINATED),T=new C("completed",b.DESTROYED|b.COMPLETED),k=new C("terminating",b.ENDING|b.TERMINATED,{destroy:B}),F=new C("canceling",b.ENDING|b.FAILED|b.CANCELED,{destroy:x,complete:w,terminate:k}),$=new C("completing",b.ENDING|b.COMPLETED,{destroy:T,cancel:F,terminate:k}),I=new C("failing",b.ENDING|b.FAILED,{cancel:F,complete:$,destroy:x,terminate:k}),P=new C("compensable:failing",b.ENDING|b.FAILED,{complete:w,terminate:k,destroy:x}),L=new C("compensable:completed",b.ENDED|b.COMPLETED,{cancel:F,fail:P,destroy:T,compensable:w}),A=new C("compensable:completing",b.ENDING|b.COMPLETED,{destroy:L,terminate:k,compensable:w}),M=new C("compensable:running",b.RUNNING|b.COMPENSABLE,{cancel:F,complete:A,compensable:w,destroy:L,fail:I,terminate:k}),D=new C("running",b.RUNNING,{cancel:F,complete:$,compensable:M,destroy:B,fail:I,terminate:k}),j=new C("activated",b.ACTIVATED,{start:D,destroy:B}),N=Object.freeze({ACTIVATED:j,RUNNING:D,CANCELING:F,COMPLETING:$,COMPLETED:T,FAILING:I,FAILED:x,TERMINATING:k,TERMINATED:B});class R{constructor(t,e,n=null,i=null){this.id=t,this.element=e,this.parent=n,this.initiator=i,this.subscriptions=new Set,this.children=[],this.state=N.ACTIVATED}get running(){return this.hasTrait(b.RUNNING)}get destroyed(){return this.hasTrait(b.DESTROYED)}get completed(){return this.hasTrait(b.COMPLETED)}get canceled(){return this.hasTrait(b.CANCELED)}get failed(){return this.hasTrait(b.FAILED)}hasTrait(t){return this.state.hasTrait(t)}start(){return this.state=this.state.start(),this}compensable(){return this.state=this.state.compensable(),this}fail(t){return this.failed||(this.state=this.state.fail(),this.failInitiator=t),this}cancel(t){return this.canceled||(this.state=this.state.cancel(),this.cancelInitiator=t),this}terminate(t){return this.state=this.state.terminate(),this.terminateInitiator=t,this}complete(){return this.state=this.state.complete(),this}destroy(t){return this.state=this.state.destroy(),this.destroyInitiator=t,this}getTokens(){return this.children.filter((t=>!t.destroyed)).length}getTokensByElement(t){return this.children.filter((e=>!e.destroyed&&e.element===t)).length}}function O(t,e){const n=[];for(const i of t)e(i)&&n.push(i);return n}function z(t,e){for(const n of t)if(e(n))return n;return null}function G(t,e){return["type","name","ref","iref"].every((n=>!(n in t)||t[n]===e[n]))}function H(t){return t.filter((t=>e(t,"bpmn:SequenceFlow")))}function q(t){return e(t,"bpmn:MessageFlow")}function V(t){return e(t,"bpmn:SequenceFlow")}function Y(t){return W(t)&&et(t,"bpmn:CompensateEventDefinition")}function U(t){return e(t,"bpmn:Activity")&&t.businessObject.isForCompensation}function W(t){return e(t,"bpmn:CatchEvent")&&!J(t)}function Z(t){return e(t,"bpmn:BoundaryEvent")&&!J(t)}function K(t){return e(t,"bpmn:StartEvent")&&!J(t)}function J(t){return!!t.labelTarget}function Q(t){return n(t).triggeredByEvent}function X(t){return e(t,"bpmn:StartEvent")&&n(t).isInterrupting||e(t,"bpmn:BoundaryEvent")&&n(t).cancelActivity}function tt(t,n){return n.some((n=>e(t,n)))}function et(t,i){return o(n(t).eventDefinitions,(t=>e(t,i)))}function nt(i,o,s){const r=i.get("scopeIds",!1)||new t([32,36]),a={},c={},l=new it,p=new Set,h=[],u=new Set,m=new Set;function d(t,e){if(h.push([e,t]),1!==h.length)return;let n;for(;n=h[0];){const[t,e]=n;e.destroyed||t(),h.shift()}F("tick")}function f(t){return c[t.type]||l}function v(t){const{element:e,parentScope:n,initiator:i=null}=t,o=t.scope||L({element:e,parent:n,initiator:i});return d(o,(function(){o.running||o.start(),B("signal",{...t,scope:o}),f(e).signal({...t,scope:o}),o.parent&&k(o.parent)})),o}function g(t){const{event:e,initiator:n,scope:i}=t,o=w(e),s=i.subscriptions,r=O(s,(t=>G(o,t.event))),a=r.filter((t=>!t.event.interrupting)),c=r.filter((t=>t.event.interrupting));if(!c.length)return a.map((t=>t.triggerFn(n))).flat();const l=c.find((t=>!t.event.boundary))||c[0],p=O(s,(t=>t.event.persistent||function(t,e){return t.type===e.type&&t.boundary&&!e.boundary}(t.event,l.event)));return s.forEach((t=>{p.includes(t)||t.remove()})),[l.triggerFn(n)].flat().filter((t=>t))}function _(t,e,n){const i=(e=w(e)).element,o={scope:t,event:e,element:i,triggerFn:n,remove(){y(o)}};return m.add(o),t.subscriptions.add(o),i&&T(i),o}function y(t){const{scope:e,event:n}=t;m.delete(t),e.subscriptions.delete(t),n.element&&T(n.element)}function w(t){if(!t.businessObject)return t;const i=X(t),o=Z(t),r=function(t){return e(t,"bpmn:StartEvent")||e(t,"bpmn:IntermediateCatchEvent")||e(t,"bpmn:ReceiveTask")?n(t).name||t.id:null}(t),a={element:t,interrupting:i,boundary:o,...r?{iref:r}:{}},c=(t.businessObject.eventDefinitions||{})[0];if(!c)return{...a,type:ot(t)?"message":"none"};if(e(c,"bpmn:LinkEventDefinition"))return{...a,type:"link",name:c.name};if(e(c,"bpmn:SignalEventDefinition"))return{...a,type:"signal",ref:c.signalRef};if(e(c,"bpmn:TimerEventDefinition"))return{...a,type:"timer"};if(e(c,"bpmn:ConditionalEventDefinition"))return{...a,type:"condition"};if(e(c,"bpmn:EscalationEventDefinition"))return{...a,type:"escalation",ref:c.escalationRef};if(e(c,"bpmn:CancelEventDefinition"))return{...a,type:"cancel"};if(e(c,"bpmn:ErrorEventDefinition"))return{...a,type:"error",ref:c.errorRef};if(e(c,"bpmn:MessageEventDefinition"))return{...a,type:"message",ref:c.messageRef};if(e(c,"bpmn:CompensateEventDefinition")){let e=c.activityRef&&s.get(c.activityRef.id);return e||(e=K(t)&&Q(t.parent)?t.parent.parent:Z(t)?t.host:t.parent),{...a,type:"compensate",ref:e,persistent:!0}}throw new Error("unknown event definition",c)}function S(t,e=!0){const{element:n,parent:i,initiator:o}=t;e&&B("createScope",{element:n,scope:i});const s=new R(r.next(),n,i,o);return i&&i.children.push(s),u.add(s),e&&F("createScope",{scope:s}),T(n),i&&T(i.element),s}function E(t){if("function"==typeof t)return t;const{event:e,element:n,scope:i}=t,o=t.elements||n&&[n],s=e&&w(e);return t=>(!s||G(s,t.event))&&(!o||o.includes(t.element))&&(!i||i===t.scope)}function C(t){if("function"==typeof t)return t;const{element:e,waitsOnElement:n,parent:i,trait:o=b.RUNNING,subscribedTo:s}=t,r=s?function(t){const e="function"===t?t:E(t);return t=>Array.from(t.subscriptions).some(e)}(s):()=>!0;return t=>(!e||t.element===e)&&(!i||t.parent===i)&&(!n||t.getTokensByElement(n)>0)&&t.hasTrait(o)&&r(t)}function x(t,e=null){if(!t.destroyed){t.destroy(e);for(const e of t.subscriptions){const n=e.event.traits||b.ACTIVE;t.hasTrait(n)||y(e)}if(t.destroyed){for(const n of t.children)n.destroyed||x(n,e);B("destroyScope",{element:t.element,scope:t}),u.delete(t),F("destroyScope",{scope:t})}T(t.element),t.parent&&T(t.parent.element)}}function B(t,e){F("trace",{...e,action:t})}function T(t){p.add(t),h.length||F("tick")}function k(t){F("scopeChanged",{scope:t})}function F(t,e={}){return o.fire(`tokenSimulation.simulator.${t}`,e)}function $(t,e){o.on("tokenSimulation.simulator."+t,e)}function I(t,e){o.off("tokenSimulation.simulator."+t,e)}function P(t,e){const n=A(t);a[t.id||t]={...n,...e},T(t)}function L(t){const{element:e}=t,n=S(t),{children:i=[],attachers:o=[]}=e;for(const s of i)if(Q(s)){const t=s.children.filter((t=>K(t)&&!Y(t)));for(const e of t)_(n,e,(t=>v({element:s,parentScope:n,startEvent:e,initiator:t})))}for(const s of o)Z(s)&&!Y(s)&&_(n,s,(t=>v({element:s,parentScope:n.parent,hostScope:n,initiator:t})));return n}function A(t){return a[t.id||t]||{}}$("tick",(function(){for(const t of p)F("elementChanged",{element:t});p.clear()})),this.createScope=S,this.destroyScope=x,this.findScope=function(t){return z(u,C(t))},this.findScopes=function(t){return O(u,C(t))},this.findSubscription=function(t){return z(m,E(t))},this.findSubscriptions=function(t){return O(m,E(t))},this.waitAtElement=function(t,e=!0){P(t,{wait:e})},this.waitForScopes=function(t,e){if(!e.length)return;const n={type:"all-completed",persistent:!1},i=new Set(e),o=e=>{i.delete(e.scope),0===i.size&&(I("destroyScope",o),g({scope:t,event:n}))};return $("destroyScope",o),n},this.setConfig=P,this.getConfig=A,this.signal=v,this.enter=function(t){const{element:e,scope:n,initiator:i=n}=t,o=L({element:e,parent:n,initiator:i});return d(o,(function(){o.running||o.start(),B("enter",t),f(e).enter({...t,initiator:i,scope:o}),k(n)})),o},this.exit=function(t){const{element:e,scope:n,initiator:i=n}=t;d(n,(function(){B("exit",t),f(e).exit({...t,initiator:i}),n.running&&n.complete(),x(n,i),n.parent&&k(n.parent)}))},this.subscribe=_,this.trigger=g,this.reset=function(){for(const t of u)x(t);for(const t of function(){const t=[];return s.forEach((e=>{if(!tt(e,["bpmn:Process","bpmn:Participant"]))return;const n=S({element:e},!1);t.push(n);const i=e.children.filter(K);for(const t of i)_(n,{...w(t),interrupting:!1},(n=>v({element:e,startEvent:t,initiator:n})))})),t}())u.add(t);F("tick"),F("reset")},this.on=$,this.off=I,this.registerBehavior=function(t,e){c[t]=e}}function it(){this.signal=function(t){},this.exit=function(t){},this.enter=function(t){}}function ot(t){return e(t,"bpmn:ReceiveTask")||t.incoming.some((t=>e(t,"bpmn:MessageFlow")))}function st(t,e){this._simulator=t,this._activityBehavior=e,t.registerBehavior("bpmn:StartEvent",this)}function rt(t,e,n){this._intermediateThrowEventBehavior=n,this._scopeBehavior=e,t.registerBehavior("bpmn:EndEvent",this)}function at(t,e,n){this._simulator=t,this._activityBehavior=e,this._scopeBehavior=n,t.registerBehavior("bpmn:BoundaryEvent",this)}function ct(t,e){this._activityBehavior=e,this._simulator=t,t.registerBehavior("bpmn:IntermediateCatchEvent",this),t.registerBehavior("bpmn:ReceiveTask",this)}function lt(t,e,n){this._simulator=t,this._activityBehavior=e,this._eventBehaviors=n,t.registerBehavior("bpmn:IntermediateThrowEvent",this)}function pt(t){this._simulator=t,t.registerBehavior("bpmn:ExclusiveGateway",this)}function ht(t,e){this._simulator=t,this._activityBehavior=e,t.registerBehavior("bpmn:ParallelGateway",this)}function ut(t){this._simulator=t,t.registerBehavior("bpmn:EventBasedGateway",this)}function mt(t,e,n){this._simulator=t,this._scopeBehavior=e,this._transactionBehavior=n;const i=["bpmn:BusinessRuleTask","bpmn:CallActivity","bpmn:ManualTask","bpmn:ScriptTask","bpmn:SendTask","bpmn:ServiceTask","bpmn:Task","bpmn:UserTask"];for(const o of i)t.registerBehavior(o,this)}function dt(t,e,n,i,o){this._simulator=t,this._activityBehavior=e,this._scopeBehavior=n,this._transactionBehavior=i,this._elementRegistry=o,t.registerBehavior("bpmn:SubProcess",this),t.registerBehavior("bpmn:Transaction",this),t.registerBehavior("bpmn:AdHocSubProcess",this)}nt.$inject=["injector","eventBus","elementRegistry"],st.prototype.signal=function(t){this._simulator.exit(t)},st.prototype.exit=function(t){this._activityBehavior.exit(t)},st.$inject=["simulator","activityBehavior"],rt.$inject=["simulator","scopeBehavior","intermediateThrowEventBehavior"],rt.prototype.enter=function(t){this._intermediateThrowEventBehavior.enter(t)},rt.prototype.signal=function(t){this._intermediateThrowEventBehavior.signal(t)},rt.prototype.exit=function(t){const{scope:e}=t;this._scopeBehavior.tryExit(e.parent,e)},at.prototype.signal=function(t){const{element:e,scope:i,hostScope:o=this._simulator.findScope({parent:i.parent,element:e.host})}=t;if(!o)throw new Error("host scope not found");if(n(e).cancelActivity){this._scopeBehavior.interrupt(o,i);const e=this._scopeBehavior.tryExit(o,i);if(e){const n=this._simulator.subscribe(o,e,(e=>(n.remove(),this._simulator.exit(t))));return}}this._simulator.exit(t)},at.prototype.exit=function(t){this._activityBehavior.exit(t)},at.$inject=["simulator","activityBehavior","scopeBehavior"],ct.$inject=["simulator","activityBehavior"],ct.prototype.signal=function(t){const{element:n}=t;return e(n,"bpmn:ReceiveTask")?this._activityBehavior.signal(t):this._simulator.exit(t)},ct.prototype.enter=function(t){const{element:n}=t;if(e(n,"bpmn:ReceiveTask")){const e=this._activityBehavior._triggerMessages(t);if(e)return this._activityBehavior.signalOnEvent(t,e)}return this._activityBehavior.signalOnEvent(t,n)},ct.prototype.exit=function(t){this._activityBehavior.exit(t)},lt.prototype.enter=function(t){const{element:e}=t,n=this._eventBehaviors.get(e);if(n){const e=n(t);if(e)return this._activityBehavior.signalOnEvent(t,e)}this._activityBehavior.enter(t)},lt.prototype.signal=function(t){this._activityBehavior.signal(t)},lt.prototype.exit=function(t){this._activityBehavior.exit(t)},lt.$inject=["simulator","activityBehavior","eventBehaviors"],pt.prototype.enter=function(t){this._simulator.exit(t)},pt.prototype.exit=function(t){const{element:e,scope:n}=t,i=H(e.outgoing);if(1===i.length)return this._simulator.enter({element:i[0],scope:n.parent});const{activeOutgoing:o}=this._simulator.getConfig(e),s=i.find((t=>t===o));if(!s)throw new Error("no outgoing configured");return this._simulator.enter({element:s,scope:n.parent})},pt.$inject=["simulator"],ht.prototype.enter=function(t){const{scope:e,element:n}=t,i=H(n.incoming),{parent:o}=e,s=this._simulator.findScopes({parent:o,element:n});if(s.length===i.length){for(const t of s)t!==e&&this._simulator.destroyScope(t.complete(),e);this._simulator.exit(t)}},ht.prototype.exit=function(t){this._activityBehavior.exit(t)},ht.$inject=["simulator","activityBehavior"],ut.$inject=["simulator"],ut.prototype.enter=function(t){const{element:e,scope:n}=t,i=n.parent,o=function(t){return t.outgoing.map((t=>t.target)).filter((t=>tt(t,["bpmn:IntermediateCatchEvent","bpmn:ReceiveTask"])))}(e),s=o.map((t=>this._simulator.subscribe(i,t,(e=>(s.forEach((t=>t.remove())),this._simulator.destroyScope(n,e),this._simulator.signal({element:t,parentScope:i,initiator:e}))))))},mt.$inject=["simulator","scopeBehavior","transactionBehavior"],mt.prototype.signal=function(t){const e=this._triggerMessages(t);if(e)return this.signalOnEvent(t,e);this._simulator.exit(t)},mt.prototype.enter=function(t){const{element:e}=t,n=this.waitAtElement(e);if(n)return this.signalOnEvent(t,n);const i=this._triggerMessages(t);if(i)return this.signalOnEvent(t,i);this._simulator.exit(t)},mt.prototype.exit=function(t){const{element:e,scope:n}=t,i=n.parent,o=!n.failed;o&&!Q(e)&&this._transactionBehavior.registerCompensation(n);const s=o?e.outgoing.filter(V):[];s.forEach((t=>this._simulator.enter({element:t,scope:i}))),0===s.length&&this._scopeBehavior.tryExit(i,n)},mt.prototype.signalOnEvent=function(t,e){const{scope:n,element:i}=t,o=this._simulator.subscribe(n,e,(t=>(o.remove(),this._simulator.signal({scope:n,element:i,initiator:t}))))},mt.prototype.waitAtElement=function(t){return this._simulator.getConfig(t).wait&&{element:t,type:"continue",interrupting:!1,boundary:!1}},mt.prototype._getMessageContexts=function(t,e=null){const n=e?t=>t.referencePoint.x>e.x:()=>!0;return[...t.incoming.filter(q).map((t=>{return{incoming:t,referencePoint:(e=t.waypoints,e&&e[e.length-1])};var e})),...t.outgoing.filter(q).map((t=>{return{outgoing:t,referencePoint:(e=t.waypoints,e&&e[0])};var e}))].sort(((t,e)=>t.referencePoint.x-e.referencePoint.x)).filter(n)},mt.prototype._triggerMessages=function(t){const{element:e,initiator:n,scope:i}=t;let o=i.messageContexts;o||(o=i.messageContexts=this._getMessageContexts(e));const s=n&&n.element;if(!q(s)||i.expectedIncoming===s)for(;o.length;){const{incoming:t,outgoing:s}=o.shift();if(t){if(!n)continue;return i.expectedIncoming=t,{element:e,type:"message",name:t.id,interrupting:!1,boundary:!1}}this._simulator.signal({element:s})}},dt.$inject=["simulator","activityBehavior","scopeBehavior","transactionBehavior","elementRegistry"],dt.prototype.signal=function(t){this._start(t)},dt.prototype.enter=function(t){const{element:e}=t,n=this._activityBehavior.waitAtElement(e);if(n)return this._activityBehavior.signalOnEvent(t,n);this._start(t)},dt.prototype.exit=function(t){const{scope:e}=t,n=e.parent;n.failInitiator===e&&n.complete(),this._activityBehavior.exit(t)},dt.prototype._start=function(t){const{element:n,startEvent:i,scope:o}=t,s=o.parent;if(Q(n)){if(!i)throw new Error("missing <startEvent>: required for event sub-process")}else if(i)throw new Error("unexpected <startEvent>: not allowed for sub-process");if(s.destroyed)throw new Error(`target scope <${s.id}> destroyed`);(function(t){return e(t,"bpmn:Transaction")})(n)&&this._transactionBehavior.setup(t),i&&X(i)&&this._scopeBehavior.interrupt(s,o);const r=i?[i]:this._findStarts(n);for(const e of r)this._simulator.signal({element:e,parentScope:o,initiator:o})},dt.prototype._findStarts=function(t){return(t=this._elementRegistry.get(t.id+"_plane")||t).children.filter((t=>{if(J(t))return!1;return!t.incoming.find((t=>e(t,"bpmn:SequenceFlow")))&&(!U(t)&&(!Q(t)&&tt(t,["bpmn:Activity","bpmn:StartEvent","bpmn:EndEvent"])))}))};const ft={type:"cancel",interrupting:!0,boundary:!1,persistent:!0};function vt(t,e){this._simulator=t,this._scopeBehavior=e}function gt(t,e){this._simulator=t,this._scopeBehavior=e,t.registerBehavior("bpmn:SequenceFlow",this)}function _t(t){this._simulator=t,t.registerBehavior("bpmn:MessageFlow",this)}function yt(t,n){return"label"!==t.type&&(Array.isArray(n)||(n=[n]),n.some((function(n){return e(t,n)})))}function bt(t,e){return o(n(t).eventDefinitions,(t=>yt(t,e)))}function wt(t,e,n){this._simulator=t,this._elementRegistry=e,this._scopeBehavior=n}function St(t){return e="bpmn:LinkEventDefinition",s(n(t).eventDefinitions,(t=>yt(t,e)));var e}function Et(t){for(;Q(t.parent.element);)t=t.parent;return t.parent}vt.$inject=["simulator","scopeBehavior"],vt.prototype.setup=function(t){const{scope:e}=t,n=this._simulator.subscribe(e,ft,(t=>(n.remove(),this.cancel({scope:e,initiator:t})))),i={type:"compensate",ref:e.element,persistent:!0,traits:b.NOT_DEAD},o=this._simulator.subscribe(e,i,(t=>e.canceled?(o.remove(),this.compensate({scope:e,element:e.element,initiator:t})):this._simulator.trigger({event:ft,scope:e})))},vt.prototype.cancel=function(t){const{scope:e,initiator:n}=t;if(!e.destroyed)return e.cancel(n),this._simulator.trigger({event:{type:"compensate",ref:e.element},initiator:n,scope:e}),this._simulator.trigger({scope:e,initiator:n,event:ft})},vt.prototype.registerCompensation=function(t){const{element:n}=t,i=n.children.filter(Q).map((t=>t.children.find((t=>K(t)&&Y(t))))).filter((t=>t)),o=n.attachers.filter(Y);if(!i.length&&!o.length)return;const s=this.findTransactionScope(t.parent);e(s.element,"bpmn:Transaction")||this.makeCompensable(s);for(const e of i){const i={element:e,type:"compensate",persistent:!0,interrupting:!0,ref:n,traits:b.NOT_DEAD},o=e.parent,s=this._simulator.subscribe(t,i,(n=>(s.remove(),this._simulator.signal({initiator:n,element:o,startEvent:e,parentScope:t}))))}for(const e of o){const t={element:e,type:"compensate",persistent:!0,ref:n,traits:b.NOT_DEAD},i=e.outgoing.map((t=>t.target)).find(U);if(!i)continue;const o=this._simulator.subscribe(s,t,(t=>(o.remove(),this._simulator.enter({initiator:t,element:i,scope:s}))))}},vt.prototype.makeCompensable=function(t){if(t.hasTrait(b.COMPENSABLE)||!t.parent)return;const e={type:"compensate",ref:t.element,interrupting:!0,persistent:!0,traits:b.NOT_DEAD};t.compensable();const n=this._simulator.subscribe(t,e,(e=>(n.remove(),t.fail(e),this.compensate({scope:t,element:t.element,initiator:e}),this._scopeBehavior.tryExit(t,e),t))),i=t.parent;if(!i)return;const o=this._simulator.subscribe(i,e,(n=>(o.remove(),this._simulator.trigger({scope:t,event:e,initiator:n}))));this.makeCompensable(i)},vt.prototype.findTransactionScope=function(t){let n=t;for(;n;){const t=n.element;if(e(t,"bpmn:SubProcess")&&!Q(t))return n;if(tt(t,["bpmn:Transaction","bpmn:Process","bpmn:Participant"]))return n;n=n.parent}throw function(t){throw new Error(`no transaction context for <${t.id}>`)}(t)},vt.prototype.compensate=function(t){const{scope:e,element:n}=t,i=O(e.subscriptions,(t=>G({type:"compensate"},t.event))),o=i.filter((t=>t.event.ref===n)),s=i.filter((t=>t.event.ref!==n));for(const r of o)this._scopeBehavior.preExit(e,(t=>this._simulator.trigger(r)));for(const r of s.reverse())this._scopeBehavior.preExit(e,(t=>this._simulator.trigger(r)))},gt.prototype.enter=function(t){this._simulator.exit(t)},gt.prototype.exit=function(t){const{element:e,scope:n}=t;this._simulator.enter({element:e.target,scope:n.parent})},gt.$inject=["simulator","scopeBehavior"],_t.$inject=["simulator"],_t.prototype.signal=function(t){this._simulator.exit(t)},_t.prototype.exit=function(t){const{element:e,scope:n}=t,i=e.target,o=W(i)?i:{type:"message",element:e,name:e.id},s=this._simulator.findSubscription({event:o,elements:[i,i.parent]});s&&this._simulator.trigger({event:o,initiator:n,scope:s.scope})},wt.$inject=["simulator","elementRegistry","scopeBehavior"],wt.prototype.get=function(t){const e={"bpmn:LinkEventDefinition":t=>{const{element:e,scope:n}=t,i=St(e),o=n.parent,s=o.element.children.filter((t=>function(t){return W(t)&&et(t,"bpmn:LinkEventDefinition")}(t)&&St(t).name===i.name));for(const r of s)this._simulator.signal({element:r,parentScope:o,initiator:n})},"bpmn:SignalEventDefinition":t=>{const{element:e,scope:n}=t,i=this._simulator.findSubscriptions({event:e}),o=new Set;for(const s of i){const t=s.scope;o.has(t)||(o.add(t),this._simulator.trigger({event:e,scope:t,initiator:n}))}},"bpmn:EscalationEventDefinition":t=>{const{element:e,scope:n}=t,i=this._simulator.findScopes({subscribedTo:{event:e},trait:b.ACTIVE});let o=n;for(;o=o.parent;)if(i.includes(o)){this._simulator.trigger({event:e,scope:o,initiator:n});break}},"bpmn:ErrorEventDefinition":t=>{const{element:e,scope:n}=t;this._simulator.trigger({event:e,initiator:n,scope:Et(n)})},"bpmn:TerminateEventDefinition":t=>{const{scope:e}=t;this._scopeBehavior.terminate(e.parent,e)},"bpmn:CancelEventDefinition":t=>{const{scope:e,element:n}=t;this._simulator.trigger({event:n,initiator:e,scope:Et(e)})},"bpmn:CompensateEventDefinition":t=>{const{scope:e,element:n}=t;return this._simulator.waitForScopes(e,this._simulator.trigger({event:n,scope:Et(e)}))}},n=Object.entries(e).find((e=>bt(t,e[0])));return n&&n[1]};const Ct={type:"pre-exit",persistent:!0,interrupting:!0,boundary:!1},xt={type:"exit",interrupting:!0,boundary:!1,persistent:!0};function Bt(t){this._simulator=t}function Tt(t){return"function"==typeof t?t:e=>e===t}function kt(t,e){this._simulator=t,this._scopeBehavior=e,t.registerBehavior("bpmn:Process",this),t.registerBehavior("bpmn:Participant",this)}Bt.$inject=["simulator"],Bt.prototype.isFinished=function(t,e=null){return e=Tt(e),t.children.every((t=>t.destroyed||t.completed||e(t)))},Bt.prototype.destroyChildren=function(t,e,n=null){n=Tt(n),t.children.filter((t=>!t.destroyed&&!n(t))).map((t=>{this._simulator.destroyScope(t,e)}))},Bt.prototype.terminate=function(t,e){this.destroyChildren(t,e),t.terminate(e),this.tryExit(t,e)},Bt.prototype.interrupt=function(t,e){this.destroyChildren(t,e,e),t.fail(e)},Bt.prototype.tryExit=function(t,e){if(!t)throw new Error("missing <scope>");if(e||(e=t),!this.isFinished(t,e))return xt;const n=this._simulator.findSubscriptions({event:Ct,scope:t});for(const i of n){const{event:t,scope:n}=i;if(this._simulator.trigger({event:t,scope:n,initiator:e}).length)return xt}this._simulator.trigger({event:xt,scope:t,initiator:e}),this.exit({scope:t,initiator:e})},Bt.prototype.exit=function(t){const{scope:e,initiator:n}=t;if(!n)throw new Error("missing <initiator>");this._simulator.exit({element:e.element,scope:e,initiator:n})},Bt.prototype.preExit=function(t,e){const n=this._simulator.subscribe(t,Ct,(t=>(n.remove(),e(t))));return n},kt.prototype.signal=function(t){const{startEvent:e,scope:n}=t;if(!e)throw new Error("missing <startEvent>");this._simulator.signal({element:e,parentScope:n})},kt.prototype.exit=function(t){const{scope:e,initiator:n}=t;this._scopeBehavior.destroyChildren(e,n)},kt.$inject=["simulator","scopeBehavior"];const Ft={__depends__:[{__init__:["startEventBehavior","endEventBehavior","boundaryEventBehavior","intermediateCatchEventBehavior","intermediateThrowEventBehavior","exclusiveGatewayBehavior","parallelGatewayBehavior","eventBasedGatewayBehavior","subProcessBehavior","sequenceFlowBehavior","messageFlowBehavior","processBehavior"],startEventBehavior:["type",st],endEventBehavior:["type",rt],boundaryEventBehavior:["type",at],intermediateCatchEventBehavior:["type",ct],intermediateThrowEventBehavior:["type",lt],exclusiveGatewayBehavior:["type",pt],parallelGatewayBehavior:["type",ht],eventBasedGatewayBehavior:["type",ut],activityBehavior:["type",mt],subProcessBehavior:["type",dt],sequenceFlowBehavior:["type",gt],messageFlowBehavior:["type",_t],eventBehaviors:["type",wt],scopeBehavior:["type",Bt],processBehavior:["type",kt],transactionBehavior:["type",vt]}],__init__:[["eventBus","simulator",function(t,e){t.on(["tokenSimulation.toggleMode","tokenSimulation.resetSimulation"],5e3,(t=>{e.reset()}))}]],simulator:["type",nt]};function $t(t,e){t.invoke(_t,this),this._animation=e}function It(t,e){t.invoke(gt,this),this._animation=e}r.exports($t,_t),$t.$inject=["injector","animation"],$t.prototype.signal=function(t){const{element:e,scope:n}=t;this._animation.animate(e,n,(()=>{_t.prototype.signal.call(this,t)}))},r.exports(It,gt),It.$inject=["injector","animation"],It.prototype.enter=function(t){const{element:e,scope:n}=t;this._animation.animate(e,n,(()=>{gt.prototype.enter.call(this,t)}))};const Pt={sequenceFlowBehavior:["type",It],messageFlowBehavior:["type",$t]},Lt="tokenSimulation.toggleMode",At="tokenSimulation.playSimulation",Mt="tokenSimulation.pauseSimulation",Dt="tokenSimulation.resetSimulation",jt="tokenSimulation.animationSpeedChanged",Nt="tokenSimulation.simulator.elementChanged",Rt="tokenSimulation.simulator.destroyScope",Ot="tokenSimulation.simulator.createScope",zt="tokenSimulation.scopeFilterChanged",Gt="tokenSimulation.simulator.trace",Ht=t=>!0;function qt(t,e){this._eventBus=t,this._simulator=e,this._filter=Ht,t.on([Lt,Dt],(()=>{this._filter=Ht})),t.on(Rt,(t=>{const{scope:e}=t;this._scope===e&&e.parent&&this.toggle(e.parent)})),t.on(Ot,(t=>{const{scope:e}=t;e.parent||!this._scope||Vt(this._scope,e)||this.toggle(null)}))}function Vt(t,e){do{if(t===e)return!0}while(e=e.parent);return!1}qt.prototype.toggle=function(t){const e=this._scope!==t;this._scope=e?t:null,this._filter=this._scope?t=>Vt(this._scope,t):t=>!0,this._eventBus.fire(zt,{filter:this._filter,scope:this._scope})},qt.prototype.isShown=function(t){return"string"==typeof t&&(t=this._simulator.findScope((e=>e.id===t))),t&&this._filter(t)},qt.prototype.findScope=function(t){return this._simulator.findScopes(t).filter((t=>this.isShown(t)))[0]},qt.$inject=["eventBus","simulator"];const Yt={scopeFilter:["type",qt]},Ut=getComputedStyle(document.documentElement),Wt=Ut.getPropertyValue("--token-simulation-green-base-44"),Zt=Ut.getPropertyValue("--token-simulation-white");function Kt(){}function Jt(t,e){return 2===e.length?ee:1===t?Xt:t===e.length-1?te:Qt}const Qt=function(t){return t},Xt=function(t){return 1-Math.cos(t*Math.PI/2)},te=function(t){return Math.sin(t*Math.PI/2)},ee=function(t){return-Math.cos(t*Math.PI)/2+.5};function ne(t,e,n){this._eventBus=e,this._scopeFilter=n,this._canvas=t,this._animations=new Set,this._speed=1,e.on(Dt,(()=>{this.clearAnimations()})),e.on(Mt,(()=>{this.pause()})),e.on(At,(()=>{this.play()})),e.on(zt,(t=>{this.each((t=>{this._scopeFilter.isShown(t.scope)?t.show():t.hide()}))})),e.on(Rt,(t=>{const{scope:e}=t;this.clearAnimations(e)}))}function ie(t,e,n){this.gfx=t,this.waypoints=e,this.done=n,this._paused=!0,this._t=0,this._parts=[],this.create()}ne.prototype.animate=function(t,e,n){this.createAnimation(t,e,n)},ne.prototype.pause=function(){this.each((t=>t.pause()))},ne.prototype.play=function(){this.each((t=>t.play()))},ne.prototype.each=function(t){this._animations.forEach(t)},ne.prototype.createAnimation=function(t,e,n=Kt){const i=this._getGroup(e);if(!i)return;const o=new ie(this._createTokenGfx(i,e),t.waypoints,(()=>{this._animations.delete(o),n()}));return o.setSpeed(this.getAnimationSpeed()),this._scopeFilter.isShown(e)||o.hide(),o.scope=e,o.element=t,this._animations.add(o),this._eventBus.fire("tokenSimulation.animationCreated",{animation:o}),o.play(),o},ne.prototype.setAnimationSpeed=function(t){this._speed=t,this.each((e=>e.setSpeed(t))),this._eventBus.fire(jt,{speed:t})},ne.prototype.getAnimationSpeed=function(){return this._speed},ne.prototype.clearAnimations=function(t){this.each((e=>{t&&e.scope!==t||e.remove()}))},ne.prototype._createTokenGfx=function(t,e){const n=d(this._getTokenSVG(e).trim());return f(n,t)},ne.prototype._getTokenSVG=function(t){const e=t.colors||{primary:Wt,auxiliary:Zt};return`\n    <g class="bts-token">\n      <circle\n        class="bts-circle"\n        r="10"\n        cx="10"\n        cy="10"\n        fill="${e.primary}"\n      />\n      <text\n        class="bts-text"\n        transform="translate(10, 14)"\n        text-anchor="middle"\n        fill="${e.auxiliary}"\n      >1</text>\n    </g>\n  `},ne.prototype._getGroup=function(t){var e,n,i=this._canvas;"findRoot"in i?(n=i.findRoot(t.element),e=i._findPlaneForRoot(n).layer):e=a(".viewport",i._svg);var o=a(".bts-animation-tokens",e);return o||(o=d('<g class="bts-animation-tokens" />'),f(o,e)),o},ne.$inject=["canvas","eventBus","scopeFilter"],ie.prototype.pause=function(){this._paused=!0},ie.prototype.play=function(){this._paused&&(this._paused=!1,this.tick(0)),this.schedule()},ie.prototype.schedule=function(){if(this._paused)return;if(this._scheduled)return;const t=Date.now();this._scheduled=!0,requestAnimationFrame((()=>{this._scheduled=!1,this._paused||(this.tick((Date.now()-t)*this._speed),this.schedule())}))},ie.prototype.tick=function(t){const e=this._t=this._t+t,n=this._parts.find((t=>t.startTime<=e&&t.endTime>e));if(!n)return this.remove();const i=e-n.startTime,o=n.length*n.easing(i/n.duration),s=n.startLength+o,r=this._path.getPointAtLength(s);this.move(r.x,r.y)},ie.prototype.move=function(t,e){v(this.gfx,"transform",`translate(${t}, ${e})`)},ie.prototype.create=function(){const t=this.waypoints,e=t.reduce(((e,n,i)=>{const o=t[i-1];if(o){const a=e[e.length-1],c=a&&a.endLength||0,l=(s=o,r=n,Math.sqrt(Math.pow(s.x-r.x,2)+Math.pow(s.y-r.y,2)));e.push({startLength:c,endLength:c+l,length:l,easing:Jt(i,t)})}var s,r;return e}),[]),n=e.reduce((function(t,e){return t+e.length}),0),i=t.reduce(((t,e,n)=>{const i=e.x-10,o=e.y-10;return t.push([n>0?"L":"M",i,o]),t}),[]).flat().join(" "),o=(s=n,Math.log(s)*(a=300,(r=250)+Math.floor(Math.random()*(a-r))));var s,r,a;this._parts=e.reduce(((t,e,i)=>{const s=o/n*e.length,r=i>0?t[i-1].endTime:0,a=r+s;return[...t,{...e,startTime:r,endTime:a,duration:s}]}),[]),this._path=d(`<path d="${i}" />`),this._t=0},ie.prototype.show=function(){v(this.gfx,"display","")},ie.prototype.hide=function(){v(this.gfx,"display","none")},ie.prototype.remove=function(){this.pause(),g(this.gfx),this.done()},ie.prototype.setSpeed=function(t){this._speed=t};const oe={__depends__:[Ft,Pt,Yt],animation:["type",ne]};function se(t){const e=_({count:60}).filter((t=>n(t.substring(1))<200));function n(t){return(299*parseInt(t.substr(0,2),16)+587*parseInt(t.substr(2,2),16)+114*parseInt(t.substr(4,2),16))/1e3}let i=0;t.on(Ot,1500,(t=>{const{scope:o}=t;o.colors=function(t){const{element:o}=t;if(o&&"bpmn:MessageFlow"===o.type)return{primary:"#999",auxiliary:"#FFF"};if(t.parent)return t.parent.colors;const s=e[i++%e.length];return{primary:s,auxiliary:n(s)>=128?"#111":"#fff"}}(o)}))}se.$inject=["eventBus"];const re={__init__:["coloredScopes"],coloredScopes:["type",se]};function ae(t){return function(e=""){return`<span class="bts-icon ${e}">${t}</span>`}}const ce=ae('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">\x3c!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --\x3e<path fill="currentColor" d="M12.83 352h262.34A12.82 12.82 0 0 0 288 339.17v-38.34A12.82 12.82 0 0 0 275.17 288H12.83A12.82 12.82 0 0 0 0 300.83v38.34A12.82 12.82 0 0 0 12.83 352zm0-256h262.34A12.82 12.82 0 0 0 288 83.17V44.83A12.82 12.82 0 0 0 275.17 32H12.83A12.82 12.82 0 0 0 0 44.83v38.34A12.82 12.82 0 0 0 12.83 96zM432 160H16a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h416a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0 256H16a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h416a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16z"/></svg>'),le=ae('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 512">\x3c!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --\x3e<path fill="currentColor" d="M224.3 273l-136 136c-9.4 9.4-24.6 9.4-33.9 0l-22.6-22.6c-9.4-9.4-9.4-24.6 0-33.9l96.4-96.4-96.4-96.4c-9.4-9.4-9.4-24.6 0-33.9L54.3 103c9.4-9.4 24.6-9.4 33.9 0l136 136c9.5 9.4 9.5 24.6.1 34z"/></svg>'),pe=ae('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">\x3c!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --\x3e<path fill="currentColor" d="M504 256c0 136.967-111.033 248-248 248S8 392.967 8 256 119.033 8 256 8s248 111.033 248 248zM227.314 387.314l184-184c6.248-6.248 6.248-16.379 0-22.627l-22.627-22.627c-6.248-6.249-16.379-6.249-22.628 0L216 308.118l-70.059-70.059c-6.248-6.248-16.379-6.248-22.628 0l-22.627 22.627c-6.248 6.248-6.248 16.379 0 22.627l104 104c6.249 6.249 16.379 6.249 22.628.001z"/></svg>'),he=ae('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 580.5 448">\n  <path fill="currentColor" d="M112 0C85 0 64 22 64 48v196l192-89V48c0-26-22-48-48-48zm256 0c-27 0-48 22-48 48v77l190-89c-5-21-24-36-46-36Zm144 105-192 89v70l192-89zM256 224 64 314v70l192-90zm256 21-192 89v66c0 27 21 48 48 48h96c26 0 48-21 48-48zM256 364 89 442c7 4 14 6 23 6h96c26 0 48-21 48-48z"/>\n  <rect fill="currentColor" width="63.3" height="618.2" x="311.5" y="-469.4" transform="rotate(65)" rx="10"/>\n</svg>\n'),ue=ae('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512">\x3c!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --\x3e<path fill="currentColor" d="M384 144c0-44.2-35.8-80-80-80s-80 35.8-80 80c0 36.4 24.3 67.1 57.5 76.8-.6 16.1-4.2 28.5-11 36.9-15.4 19.2-49.3 22.4-85.2 25.7-28.2 2.6-57.4 5.4-81.3 16.9v-144c32.5-10.2 56-40.5 56-76.3 0-44.2-35.8-80-80-80S0 35.8 0 80c0 35.8 23.5 66.1 56 76.3v199.3C23.5 365.9 0 396.2 0 432c0 44.2 35.8 80 80 80s80-35.8 80-80c0-34-21.2-63.1-51.2-74.6 3.1-5.2 7.8-9.8 14.9-13.4 16.2-8.2 40.4-10.4 66.1-12.8 42.2-3.9 90-8.4 118.2-43.4 14-17.4 21.1-39.8 21.6-67.9 31.6-10.8 54.4-40.7 54.4-75.9zM80 64c8.8 0 16 7.2 16 16s-7.2 16-16 16-16-7.2-16-16 7.2-16 16-16zm0 384c-8.8 0-16-7.2-16-16s7.2-16 16-16 16 7.2 16 16-7.2 16-16 16zm224-320c8.8 0 16 7.2 16 16s-7.2 16-16 16-16-7.2-16-16 7.2-16 16-16z"/></svg>'),me=ae('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512">\x3c!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --\x3e<path fill="currentColor" d="M569.517 440.013C587.975 472.007 564.806 512 527.94 512H48.054c-36.937 0-59.999-40.055-41.577-71.987L246.423 23.985c18.467-32.009 64.72-31.951 83.154 0l239.94 416.028zM288 354c-25.405 0-46 20.595-46 46s20.595 46 46 46 46-20.595 46-46-20.595-46-46-46zm-43.673-165.346l7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373 0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884 0-12.356 5.78-11.981 12.654z"/></svg>'),de=ae('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 192 512">\x3c!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --\x3e<path fill="currentColor" d="M20 424.229h20V279.771H20c-11.046 0-20-8.954-20-20V212c0-11.046 8.954-20 20-20h112c11.046 0 20 8.954 20 20v212.229h20c11.046 0 20 8.954 20 20V492c0 11.046-8.954 20-20 20H20c-11.046 0-20-8.954-20-20v-47.771c0-11.046 8.954-20 20-20zM96 0C56.235 0 24 32.235 24 72s32.235 72 72 72 72-32.235 72-72S135.764 0 96 0z"/></svg>'),fe=ae('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">\x3c!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --\x3e<path fill="currentColor" d="M144 479H48c-26.5 0-48-21.5-48-48V79c0-26.5 21.5-48 48-48h96c26.5 0 48 21.5 48 48v352c0 26.5-21.5 48-48 48zm304-48V79c0-26.5-21.5-48-48-48h-96c-26.5 0-48 21.5-48 48v352c0 26.5 21.5 48 48 48h96c26.5 0 48-21.5 48-48z"/></svg>'),ve=ae('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">\x3c!-- Adapted from Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --\x3e<path fill="currentColor" d="M424.4 214.7L72.4 6.6C43.8-10.3 0 6.1 0 47.9V464c0 37.5 40.7 60.1 72.4 41.3l352-208c31.4-18.5 31.5-64.1 0-82.6z"/></svg>'),ge=ae('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">\x3c!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --\x3e<path fill="currentColor" d="M440.65 12.57l4 82.77A247.16 247.16 0 0 0 255.83 8C134.73 8 33.91 94.92 12.29 209.82A12 12 0 0 0 24.09 224h49.05a12 12 0 0 0 11.67-9.26 175.91 175.91 0 0 1 317-56.94l-101.46-4.86a12 12 0 0 0-12.57 12v47.41a12 12 0 0 0 12 12H500a12 12 0 0 0 12-12V12a12 12 0 0 0-12-12h-47.37a12 12 0 0 0-11.98 12.57zM255.83 432a175.61 175.61 0 0 1-146-77.8l101.8 4.87a12 12 0 0 0 12.57-12v-47.4a12 12 0 0 0-12-12H12a12 12 0 0 0-12 12V500a12 12 0 0 0 12 12h47.35a12 12 0 0 0 12-12.6l-4.15-82.57A247.17 247.17 0 0 0 255.83 504c121.11 0 221.93-86.92 243.55-201.82a12 12 0 0 0-11.8-14.18h-49.05a12 12 0 0 0-11.67 9.26A175.86 175.86 0 0 1 255.83 432z"/></svg>'),_e=ae('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512">\x3c!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --\x3e<path fill="currentColor" d="M288 32C128.94 32 0 160.94 0 320c0 52.8 14.25 102.26 39.06 144.8 5.61 9.62 16.3 15.2 27.44 15.2h443c11.14 0 21.83-5.58 27.44-15.2C561.75 422.26 576 372.8 576 320c0-159.06-128.94-288-288-288zm0 64c14.71 0 26.58 10.13 30.32 23.65-1.11 2.26-2.64 4.23-3.45 6.67l-9.22 27.67c-5.13 3.49-10.97 6.01-17.64 6.01-17.67 0-32-14.33-32-32S270.33 96 288 96zM96 384c-17.67 0-32-14.33-32-32s14.33-32 32-32 32 14.33 32 32-14.33 32-32 32zm48-160c-17.67 0-32-14.33-32-32s14.33-32 32-32 32 14.33 32 32-14.33 32-32 32zm246.77-72.41l-61.33 184C343.13 347.33 352 364.54 352 384c0 11.72-3.38 22.55-8.88 32H232.88c-5.5-9.45-8.88-20.28-8.88-32 0-33.94 26.5-61.43 59.9-63.59l61.34-184.01c4.17-12.56 17.73-19.45 30.36-15.17 12.57 4.19 19.35 17.79 15.17 30.36zm14.66 57.2l15.52-46.55c3.47-1.29 7.13-2.23 11.05-2.23 17.67 0 32 14.33 32 32s-14.33 32-32 32c-11.38-.01-20.89-6.28-26.57-15.22zM480 384c-17.67 0-32-14.33-32-32s14.33-32 32-32 32 14.33 32 32-14.33 32-32 32z"/></svg>'),ye=ae('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">\x3c!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --\x3e<path fill="currentColor" d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm121.6 313.1c4.7 4.7 4.7 12.3 0 17L338 377.6c-4.7 4.7-12.3 4.7-17 0L256 312l-65.1 65.6c-4.7 4.7-12.3 4.7-17 0L134.4 338c-4.7-4.7-4.7-12.3 0-17l65.6-65-65.6-65.1c-4.7-4.7-4.7-12.3 0-17l39.6-39.6c4.7-4.7 12.3-4.7 17 0l65 65.7 65.1-65.6c4.7-4.7 12.3-4.7 17 0l39.6 39.6c4.7 4.7 4.7 12.3 0 17L312 256l65.6 65.1z"/></svg>'),be=ae('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 352 512">\x3c!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --\x3e<path fill="currentColor" d="M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z"/></svg>'),we=ae('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512">\x3c!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --\x3e<path fill="currentColor" d="M384 64H192C85.961 64 0 149.961 0 256s85.961 192 192 192h192c106.039 0 192-85.961 192-192S490.039 64 384 64zM64 256c0-70.741 57.249-128 128-128 70.741 0 128 57.249 128 128 0 70.741-57.249 128-128 128-70.741 0-128-57.249-128-128zm320 128h-48.905c65.217-72.858 65.236-183.12 0-256H384c70.741 0 128 57.249 128 128 0 70.74-57.249 128-128 128z"/></svg>'),Se=ae('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512">\x3c!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --\x3e<path fill="currentColor" d="M384 64H192C86 64 0 150 0 256s86 192 192 192h192c106 0 192-86 192-192S490 64 384 64zm0 320c-70.8 0-128-57.3-128-128 0-70.8 57.3-128 128-128 70.8 0 128 57.3 128 128 0 70.8-57.3 128-128 128z"/></svg>');function Ee(t){this._exclusiveGatewaySettings=t}function Ce(t){this._simulator=t}function xe(t){this._simulator=t}Ee.prototype.createContextPads=function(t){if(t.outgoing.filter((function(t){return yt(t,"bpmn:SequenceFlow")})).length<2)return;const e=`\n    <div class="bts-context-pad" title="Set Sequence Flow">\n      ${ue()}\n    </div>\n  `;return[{action:()=>{this._exclusiveGatewaySettings.setSequenceFlow(t)},element:t,html:e}]},Ee.$inject=["exclusiveGatewaySettings"],Ce.prototype.createContextPads=function(t){return yt(t,"bpmn:ReceiveTask")||yt(t,"bpmn:SubProcess")&&n(t).triggeredByEvent?[]:[this.createPauseContextPad(t)]},Ce.prototype.createPauseContextPad=function(t){const e=this._isPaused(t),n=`\n    <div class="bts-context-pad ${e?"":"show-hover"}" title="${e?"Remove":"Add"} pause point">\n      ${(e?he:fe)("show-hover")}\n      ${fe("hide-hover")}\n    </div>\n  `;return{action:()=>{this._togglePaused(t)},element:t,hideContexts:()=>this._findSubscriptions({element:t}),html:n}},Ce.prototype._isPaused=function(t){const{wait:e}=this._simulator.getConfig(t);return e},Ce.prototype._togglePaused=function(t){const e=!this._isPaused(t);this._simulator.waitAtElement(t,e)},Ce.prototype._findSubscriptions=function(t){return this._simulator.findSubscriptions(t)},Ce.$inject=["simulator"],xe.$inject=["simulator"],xe.prototype.createContextPads=function(t){return[this.createTriggerContextPad(t)]},xe.prototype.createTriggerContextPad=function(t){const e=`\n    <div class="bts-context-pad" title="Trigger Event">\n      ${ve()}\n    </div>\n  `;return{action:t=>{const{event:e,scope:n}=t[0];return this._simulator.trigger({event:e,scope:n})},element:t,html:e,contexts:()=>this._findSubscriptions({element:t})}},xe.prototype._findSubscriptions=function(t){return this._simulator.findSubscriptions(t)};function Be(t,e,n,i,o,s){this._elementRegistry=e,this._overlays=n,this._injector=i,this._canvas=o,this._scopeFilter=s,this._overlayCache=new Map,this._handlerIdx=0,this._handlers=[],this.registerHandler("bpmn:ExclusiveGateway",Ee),this.registerHandler("bpmn:Activity",Ce),this.registerHandler("bpmn:StartEvent",xe),this.registerHandler("bpmn:IntermediateCatchEvent",xe),this.registerHandler("bpmn:BoundaryEvent",xe),this.registerHandler("bpmn:Activity",xe),t.on(Lt,500,(t=>{t.active?this.openContextPads():this.closeContextPads()})),t.on(Dt,500,(()=>{this.closeContextPads(),this.openContextPads()})),t.on(zt,(t=>{const e=c(".djs-overlay-ts-context-menu [data-scope-ids]",n._overlayRoot);for(const n of e){const t=n.dataset.scopeIds.split(",").some((t=>s.isShown(t)));l(n).toggle("hidden",!t)}const i=c(".djs-overlay-ts-context-menu [data-hide-scope-ids]",n._overlayRoot);for(const n of i){const t=n.dataset.hideScopeIds.split(",").some((t=>s.isShown(t)));l(n).toggle("hidden",t)}})),t.on(Nt,500,(t=>{const{element:e}=t;this.updateElementContextPads(e)}))}Be.prototype.registerHandler=function(t,e){const n=this._injector.instantiate(e);n.hash=String(this._handlerIdx++),this._handlers.push({handler:n,type:t})},Be.prototype.getHandlers=function(t){return this._handlers.filter((({type:e})=>yt(t,e))).map((({handler:t})=>t))},Be.prototype.openContextPads=function(t){t||(t=this._canvas.getRootElement()),this._elementRegistry.forEach((e=>{(function(t,e){do{if(t===e)return!0;e=e.parent}while(e);return!1})(t,e)&&this.updateElementContextPads(e)}))},Be.prototype._getOverlays=function(t){return this._overlayCache.get(t)||[]},Be.prototype._addOverlay=function(t,e){const{handlerHash:n}=e;if(!n)throw new Error("<handlerHash> required");const i=this._overlays.add(t,"ts-context-menu",{...e,position:{top:-15,left:-15},show:{minZoom:.5}}),o=this._overlays.get(i),s=this._overlayCache;s.has(n)||s.set(n,[]),s.get(n).push(o)},Be.prototype._removeOverlay=function(t){const{id:e,handlerHash:n}=t;this._overlays.remove(e);const i=this._overlayCache.get(n)||[],o=i.indexOf(t);-1!==o&&i.splice(o,1)},Be.prototype.updateElementContextPads=function(t){for(const e of this.getHandlers(t))this._updateElementContextPads(t,e)},Be.prototype._updateElementContextPads=function(t,e){const n=(e.createContextPads(t)||[]).filter((t=>t)),i=`${t.id}------${e.hash}`,o=this._getOverlays(i),s=[];for(const r of n){const{element:t,contexts:e,hideContexts:n,action:a,html:c}=r,u=`${r.element.id}-------${c}`;let m=o.find((t=>t.hash===u));const d=m&&m.html||p(c);if(e){const t=e();d.dataset.scopeIds=t.map((t=>t.scope.id)).join(",");const n=t.filter((t=>this._scopeFilter.isShown(t.scope)));l(d).toggle("hidden",0===n.length)}if(n){const t=n();d.dataset.hideScopeIds=t.map((t=>t.scope.id)).join(",");const e=t.filter((t=>this._scopeFilter.isShown(t.scope)));l(d).toggle("hidden",e.length>0)}m?s.push(m):(a&&h.bind(d,"click",(t=>{t.preventDefault();const n=e?e().filter((t=>this._scopeFilter.isShown(t.scope))):null;a(n)})),this._addOverlay(t,{hash:u,handlerHash:i,html:d}))}for(const r of o)s.includes(r)||this._removeOverlay(r)},Be.prototype.closeContextPads=function(){for(const t of this._overlayCache.values())for(const e of t)this._closeOverlay(e);this._overlayCache.clear()},Be.prototype._closeOverlay=function(t){this._overlays.remove(t.id)},Be.$inject=["eventBus","elementRegistry","overlays","injector","canvas","scopeFilter"];const Te={__depends__:[Yt],__init__:["contextPads"],contextPads:["type",Be]};function ke(t,e,n){t.on(Rt,(t=>{const{scope:e}=t,{destroyInitiator:i,element:o}=e;if(!e.completed||!i)return;["bpmn:Process","bpmn:Participant"].includes(o.type)&&n.addElementNotification(i.element,{type:"success",icon:pe(),text:"Finished",scope:e})}))}ke.$inject=["eventBus","simulator","elementNotifications"];function Fe(t,e){this._overlays=t,e.on([Dt,Ot,Lt],(()=>{this.clear()}))}Fe.prototype.addElementNotification=function(t,e){const n={top:-15,right:15},{type:i,icon:o,text:s,scope:r={}}=e,a=r.colors,c=a?`style="color: ${a.auxiliary}; background: ${a.primary}"`:"",l=p(`\n    <div class="bts-element-notification ${i||""}" ${c}>\n      ${o||""}\n      <span class="bts-text">${s}</span>\n    </div>\n  `);this._overlays.add(t,"element-notification",{position:n,html:l,show:{minZoom:.5}})},Fe.prototype.clear=function(){this._overlays.remove({type:"element-notification"})},Fe.prototype.removeElementNotification=function(t){this._overlays.remove({element:t})},Fe.$inject=["overlays","eventBus"];const $e={elementNotifications:["type",Fe]},Ie=2e3,Pe=de();function Le(t,e,n){this._eventBus=t,this._canvas=e,this._scopeFilter=n,this._init(),t.on([Lt,Dt],(t=>{this.clear()}))}Le.prototype._init=function(){this.container=p('<div class="bts-notifications"></div>'),this._canvas.getContainer().appendChild(this.container)},Le.prototype.showNotification=function(t){const{text:e,type:n="info",icon:i=Pe,scope:o,ttl:s=Ie}=t;if(o&&!this._scopeFilter.isShown(o))return;const r=i.startsWith("<")?i:`<i class="${i}"></i>`,a=o&&o.colors,c=a?`style="color: ${a.auxiliary}; background: ${a.primary}"`:"",l=p(`\n    <div class="bts-notification ${n}">\n      <span class="bts-icon">${r}</span>\n      <span class="bts-text">${e}</span>\n      ${o?`<span class="bts-scope" ${c}>${o.id}</span>`:""}\n    </div>\n  `);for(this.container.appendChild(l);this.container.children.length>5;)this.container.children[0].remove();setTimeout((function(){l.remove()}),s)},Le.prototype.clear=function(){for(;this.container.children.length;)this.container.children[0].remove()},Le.$inject=["eventBus","canvas","scopeFilter"];const Ae={__depends__:[Yt],notifications:["type",Le]},Me={__depends__:[$e,Ae],__init__:["simulationState"],simulationState:["type",ke]};function De(t,e,n,i,o){this._eventBus=t,this._canvas=e,this._scopeFilter=n,this._elementColors=i,this._simulationStyles=o,this._highlight=null,this._init(),t.on(Lt,(t=>{t.active?l(this._container).remove("hidden"):(l(this._container).add("hidden"),u(this._container),this.unhighlightScope())})),t.on(zt,(t=>{const e=this.getScopeElements();for(const n of e){const t=n.dataset.scopeId;l(n).toggle("inactive",!this._scopeFilter.isShown(t))}})),t.on(Ot,(t=>{this.addScope(t.scope)})),t.on(Rt,(t=>{this.removeScope(t.scope)})),t.on("tokenSimulation.simulator.scopeChanged",(t=>{this.updateScope(t.scope)})),t.on(Dt,(()=>{this.removeAllInstances()}))}function je(){this._cache={}}function Ne(){return{getPropertyValue:()=>""}}De.prototype._init=function(){this._container=p('<div class="bts-scopes hidden"></div>'),this._canvas.getContainer().appendChild(this._container)},De.prototype.addScope=function(t){const{element:e}=t;if(!["bpmn:Process","bpmn:SubProcess","bpmn:Participant"].includes(e.type))return;const n=t.colors,i=n?`style="color: ${n.auxiliary}; background: ${n.primary}"`:"",o=p(`\n    <div data-scope-id="${t.id}" class="bts-scope"\n         title="View Process Instance ${t.id}" ${i}>\n      ${t.getTokens()}\n    </div>\n  `);h.bind(o,"click",(()=>{this._scopeFilter.toggle(t)})),h.bind(o,"mouseenter",(()=>{this.highlightScope(e)})),h.bind(o,"mouseleave",(()=>{this.unhighlightScope()})),this._scopeFilter.isShown(t)||l(o).add("inactive"),this._container.appendChild(o)},De.prototype.getScopeElements=function(){return c("[data-scope-id]",this._container)},De.prototype.getScopeElement=function(t){return a(`[data-scope-id="${t.id}"]`,this._container)},De.prototype.updateScope=function(t){const e=this.getScopeElement(t);e&&(e.textContent=t.getTokens())},De.prototype.removeScope=function(t){const e=this.getScopeElement(t);e&&e.remove()},De.prototype.removeAllInstances=function(){this._container.innerHTML=""},De.prototype.highlightScope=function(t){this.unhighlightScope(),this._highlight={element:t,colors:this._elementColors.get(t)},this._elementColors.set(t,this._getHighlightColors()),t.parent||l(this._canvas.getContainer()).add("highlight")},De.prototype.unhighlightScope=function(){if(!this._highlight)return;const{element:t,colors:e}=this._highlight;this._elementColors.set(t,e),t.parent||l(this._canvas.getContainer()).remove("highlight"),this._highlight=null},De.prototype._getHighlightColors=function(){return{fill:this._simulationStyles.get("--token-simulation-silver-base-97"),stroke:this._simulationStyles.get("--token-simulation-green-base-44")}},De.$inject=["eventBus","canvas","scopeFilter","elementColors","simulationStyles"],je.$inject=[],je.prototype.get=function(t){const e=this._cache[t];return e||(this._computedStyle||(this._computedStyle=this._getComputedStyle()),this._cache[t]=this._computedStyle.getPropertyValue(t).trim())},je.prototype._getComputedStyle=function(){return("function"==typeof getComputedStyle?getComputedStyle:Ne)("undefined"!=typeof document?document.documentElement:{})};const Re={simulationStyles:["type",je]},Oe={__depends__:[Yt,Re],__init__:["showScopes"],showScopes:["type",De]},ze=de();function Ge(t){const e=t&&t.businessObject.name;return e&&y(e)}function He(t,e,i,o,s,r){this._notifications=e,this._tokenSimulationPalette=i,this._canvas=o,this._scopeFilter=s,this._init(),t.on(zt,(t=>{const e=c(".bts-entry[data-scope-id]",this._container);for(const n of e){const t=n.dataset.scopeId;l(n).toggle("inactive",!this._scopeFilter.isShown(t))}})),t.on(Rt,(t=>{const{scope:e}=t,{element:n}=e,i=e.completed;if(!["bpmn:Process","bpmn:Participant","bpmn:SubProcess"].includes(n.type))return;const o=`${yt(n,"bpmn:SubProcess")?Ge(n)||"SubProcess":"Process"} ${i?"finished":"canceled"}`;this.log({text:o,icon:i?pe():ye(),scope:e})})),t.on(Ot,(t=>{const{scope:e}=t,{element:n}=e;if(!["bpmn:Process","bpmn:Participant","bpmn:SubProcess"].includes(n.type))return;const i=`${yt(n,"bpmn:SubProcess")?Ge(n)||"SubProcess":"Process"} started`;this.log({text:i,icon:pe(),scope:e})})),t.on(Gt,(t=>{const{action:e,scope:i,element:o}=t;if("exit"!==e)return;const s=i.parent,r=Ge(o);if(yt(o,"bpmn:BusinessRuleTask")?this.log({text:r||"Business Rule Task",icon:"bpmn-icon-business-rule",scope:s}):yt(o,"bpmn:CallActivity")?this.log({text:r||"Call Activity",icon:"bpmn-icon-call-activity",scope:s}):(yt(o,"bpmn:IntermediateCatchEvent")||yt(o,"bpmn:IntermediateThrowEvent"))&&this.log({text:r||"Intermediate Event",icon:"bpmn-icon-intermediate-event-none",scope:s}),yt(o,"bpmn:BoundaryEvent"))this.log({text:r||"Boundary Event",icon:"bpmn-icon-intermediate-event-none",scope:s});else if(yt(o,"bpmn:ManualTask"))this.log({text:r||"Manual Task",icon:"bpmn-icon-manual",scope:s});else if(yt(o,"bpmn:ScriptTask"))this.log({text:r||"Script Task",icon:"bpmn-icon-script",scope:s});else if(yt(o,"bpmn:ServiceTask"))this.log({text:r||"Service Task",icon:"bpmn-icon-service",scope:s});else if(yt(o,"bpmn:Task"))this.log({text:r||"Task",icon:"bpmn-icon-task",scope:s});else if(yt(o,"bpmn:UserTask"))this.log({text:r||"User Task",icon:"bpmn-icon-user",scope:s});else if(yt(o,"bpmn:ExclusiveGateway")){if(o.outgoing.length<2)return;const t=Ge(o.sequenceFlow);let e=r||"Gateway";t&&(e=e.concat(` ${le()} ${t}`)),this.log({text:e,icon:"bpmn-icon-gateway-xor",scope:s})}else yt(o,"bpmn:EndEvent")?bt(n(o),"bpmn:TerminateEventDefinition")?this.log({text:r||"Terminate End Event",icon:"bpmn-icon-end-event-terminate",scope:s}):this.log({text:r||"End Event",icon:"bpmn-icon-end-event-none",scope:s}):yt(o,"bpmn:StartEvent")&&this.log({text:r||"Start Event",icon:"bpmn-icon-start-event-none",scope:s})})),t.on([Lt,Dt],(t=>{this.clear(),l(this._container).add("hidden")}))}He.prototype._init=function(){this._container=p(`\n    <div class="bts-log hidden">\n      <div class="bts-header">\n        ${ce("bts-log-icon")}\n        <button class="bts-close">\n          ${be()}\n        </button>\n      </div>\n      <div class="bts-content">\n        <p class="bts-entry placeholder">No Entries</p>\n      </div>\n    </div>\n  `),this._placeholder=a(".bts-placeholder",this._container),this._content=a(".bts-content",this._container),h.bind(this._content,"wheel",(t=>{t.stopPropagation()})),h.bind(this._content,"mousedown",(t=>{t.stopPropagation()})),this._close=a(".bts-close",this._container),h.bind(this._close,"click",(()=>{l(this._container).add("hidden")})),this._icon=a(".bts-log-icon",this._container),h.bind(this._icon,"click",(()=>{l(this._container).add("hidden")})),this._canvas.getContainer().appendChild(this._container),this.paletteEntry=p(`\n    <div class="bts-entry" title="Show Simulation Log">\n      ${ce()}\n    </div>\n  `),h.bind(this.paletteEntry,"click",(()=>{l(this._container).remove("hidden")})),this._tokenSimulationPalette.addEntry(this.paletteEntry,3)},He.prototype.toggle=function(){const t=this._container;l(t).has("hidden")?l(t).remove("hidden"):l(t).add("hidden")},He.prototype.log=function(t){const{text:e,type:n="info",icon:i=ze,scope:o}=t;l(this._placeholder).add("hidden");const s=new Date,r=s.toLocaleTimeString()+":"+s.getUTCMilliseconds();this._notifications.showNotification(t);const a=i.startsWith("<")?i:`<i class="${i}"></i>`,c=o&&o.colors,h=c?`style="background: ${c.primary}; color: ${c.auxiliary}"`:"",u=p(`\n    <p class="bts-entry ${n} ${o&&this._scopeFilter.isShown(o)?"":"inactive"}" ${o?`data-scope-id="${o.id}"`:""}>\n      <span class="bts-date">${r}</span>\n      <span class="bts-icon">${a}</span>\n      <span class="bts-text">${e}</span>\n      ${o?`<span class="bts-scope" data-scope-id="${o.id}" ${h}>${o.id}</span>`:""}\n    </p>\n  `);m.bind(u,".bts-scope[data-scope-id]","click",(t=>{this._scopeFilter.toggle(o)})),this._content.appendChild(u),this._content.scrollTop=this._content.scrollHeight},He.prototype.clear=function(){for(;this._content.firstChild;)this._content.removeChild(this._content.firstChild);this._placeholder=p('<p class="bts-entry placeholder">No Entries</p>'),this._content.appendChild(this._placeholder)},He.$inject=["eventBus","notifications","tokenSimulationPalette","canvas","scopeFilter","simulator"];const qe={__depends__:[Ae,Yt],__init__:["log"],log:["type",He]},Ve=["bpmn:InclusiveGateway","bpmn:ComplexGateway"];function Ye(t,e,n,i,o){this._eventBus=t,this._elementRegistry=e,this._elementNotifications=o,this._notifications=i,this._canvasParent=n.getContainer().parentNode,t.on(Lt,(t=>{t.active?this.enable():this.clear()}))}Ye.prototype.getUnsupportedElements=function(){return this._unsupportedElements},Ye.prototype.enable=function(){const t=[];this._elementRegistry.forEach((e=>{(function(t){return t.labelTarget})(e)||yt(e,Ve)&&(this.showWarning(e),t.push(e))})),t.length&&this._notifications.showNotification({text:"Found unsupported elements",icon:me(),type:"warning",ttl:5e3}),this._unsupportedElements=t},Ye.prototype.clear=function(){l(this._canvasParent).remove("warning")},Ye.prototype.showWarning=function(t){this._elementNotifications.addElementNotification(t,{type:"warning",icon:me(),text:"Not supported"})},Ye.$inject=["eventBus","elementRegistry","canvas","notifications","elementNotifications"];const Ue={__depends__:[$e,Ae],__init__:["elementSupport"],elementSupport:["type",Ye]},We=ve(),Ze=fe();function Ke(t,e,n,i){this._eventBus=t,this._tokenSimulationPalette=e,this._notifications=n,this.canvasParent=i.getContainer().parentNode,this.isActive=!1,this.isPaused=!0,this._init(),t.on(Ot,1500,(t=>{this.activate(),this.unpause()})),t.on([Dt,Lt],(()=>{this.deactivate(),this.pause()})),t.on(Gt,1500,(t=>{this.unpause()}))}Ke.prototype._init=function(){this.paletteEntry=p(`\n    <div class="bts-entry disabled" title="Play/Pause Simulation">\n      ${We}\n    </div>\n  `),h.bind(this.paletteEntry,"click",this.toggle.bind(this)),this._tokenSimulationPalette.addEntry(this.paletteEntry,1)},Ke.prototype.toggle=function(){this.isPaused?this.unpause():this.pause()},Ke.prototype.pause=function(){this.isActive&&(l(this.paletteEntry).remove("active"),l(this.canvasParent).add("paused"),this.paletteEntry.innerHTML=We,this._eventBus.fire(Mt),this._notifications.showNotification({text:"Pause Simulation"}),this.isPaused=!0)},Ke.prototype.unpause=function(){this.isActive&&this.isPaused&&(l(this.paletteEntry).add("active"),l(this.canvasParent).remove("paused"),this.paletteEntry.innerHTML=Ze,this._eventBus.fire(At),this._notifications.showNotification({text:"Play Simulation"}),this.isPaused=!1)},Ke.prototype.activate=function(){this.isActive=!0,l(this.paletteEntry).remove("disabled")},Ke.prototype.deactivate=function(){this.isActive=!1,l(this.paletteEntry).remove("active"),l(this.paletteEntry).add("disabled")},Ke.$inject=["eventBus","tokenSimulationPalette","notifications","canvas"];const Je={__depends__:[Ae],__init__:["pauseSimulation"],pauseSimulation:["type",Ke]};function Qe(t,e,n){this._eventBus=t,this._tokenSimulationPalette=e,this._notifications=n,this._init(),t.on(Ot,(()=>{l(this._paletteEntry).remove("disabled")})),t.on(Lt,(t=>{(this._active=t.active)||this.resetSimulation()}))}Qe.prototype._init=function(){this._paletteEntry=p(`\n    <div class="bts-entry disabled" title="Reset Simulation">\n      ${ge()}\n    </div>\n  `),h.bind(this._paletteEntry,"click",(()=>{this.resetSimulation(),this._notifications.showNotification({text:"Reset Simulation",type:"info"})})),this._tokenSimulationPalette.addEntry(this._paletteEntry,2)},Qe.prototype.resetSimulation=function(){l(this._paletteEntry).add("disabled"),this._eventBus.fire(Dt)},Qe.$inject=["eventBus","tokenSimulationPalette","notifications"];const Xe={__depends__:[Ae],__init__:["resetSimulation"],resetSimulation:["type",Qe]};function tn(t,e,n,i,o){this._overlays=e,this._scopeFilter=i,this._simulator=n,this._simulationStyles=o,this.overlayIds={},t.on(Nt,500,(t=>{const{element:e}=t;this.removeTokenCounts(e),this.addTokenCounts(e)})),t.on(zt,(t=>{const n=c(".bts-token-count[data-scope-id]",e._overlayRoot);for(const e of n){const t=e.dataset.scopeId;l(e).toggle("inactive",!this._scopeFilter.isShown(t))}}))}tn.prototype.addTokenCounts=function(t){if(yt(t,"bpmn:MessageFlow")||yt(t,"bpmn:SequenceFlow"))return;const e=this._simulator.findScopes((e=>!e.destroyed&&e.children.some((e=>!e.destroyed&&e.element===t&&!e.children.length))));this.addTokenCount(t,e)},tn.prototype.addTokenCount=function(t,e){if(!e.length)return;const n=e.map((e=>this._getTokenHTML(t,e))).join(""),i=p(`\n    <div class="bts-token-count-parent">\n      ${n}\n    </div>\n  `),o={bottom:10,left:-15},s=this._overlays.add(t,"token-count",{position:o,html:i,show:{minZoom:.5}});this.overlayIds[t.id]=s},tn.prototype.removeTokenCounts=function(t){this.removeTokenCount(t)},tn.prototype.removeTokenCount=function(t){const e=this.overlayIds[t.id];e&&(this._overlays.remove(e),delete this.overlayIds[t.id])},tn.prototype._getTokenHTML=function(t,e){const n=e.colors||this._getDefaultColors();return`\n    <div data-scope-id="${e.id}" class="bts-token-count waiting ${this._scopeFilter.isShown(e)?"":"inactive"}"\n         style="color: ${n.auxiliary}; background: ${n.primary}">\n      ${e.getTokensByElement(t)}\n    </div>\n  `},tn.prototype._getDefaultColors=function(){return{primary:this._simulationStyles.get("--token-simulation-green-base-44"),auxiliary:this._simuationStyles.get("--token-simulation-white")}},tn.$inject=["eventBus","overlays","simulator","scopeFilter","simulationStyles"];const en={__depends__:[Yt,Re],__init__:["tokenCount"],tokenCount:["type",tn]},nn=[["Slow",.5],["Normal",1],["Fast",2]];function on(t,e,n){this._canvas=t,this._animation=e,this._eventBus=n,this._init(e.getAnimationSpeed()),n.on(Lt,(t=>{t.active?l(this._container).remove("hidden"):l(this._container).add("hidden")})),n.on(jt,(t=>{this.setActive(t.speed)}))}on.prototype.getToggleSpeed=function(t){return parseFloat(t.dataset.speed)},on.prototype._init=function(t){this._container=p(`\n    <div class="bts-set-animation-speed hidden">\n      ${_e()}\n      <div class="bts-animation-speed-buttons">\n        ${nn.map((([e,n],i)=>`\n            <button title="Set animation speed = ${e}" data-speed="${n}" class="bts-animation-speed-button ${n===t?"active":""}">\n              ${Array.from({length:i+1}).map((()=>le())).join("")}\n            </button>\n          `)).join("")}\n      </div>\n    </div>\n  `),m.bind(this._container,"[data-speed]","click",(t=>{const e=t.delegateTarget,n=this.getToggleSpeed(e);this._animation.setAnimationSpeed(n)})),this._canvas.getContainer().appendChild(this._container)},on.prototype.setActive=function(t){c("[data-speed]",this._container).forEach((e=>{const n=this.getToggleSpeed(e)===t;l(e)[n?"add":"remove"]("active")}))},on.$inject=["canvas","animation","eventBus"];const sn={__init__:["setAnimationSpeed"],setAnimationSpeed:["type",on]};function rn(t){return yt(t,"bpmn:SequenceFlow")}function an(t,e,n,i,o){this._elementRegistry=e,this._elementColors=n,this._simulator=i,this._simulationStyles=o,t.on(Lt,(t=>{t.active?this.setSequenceFlowsDefault():this.resetSequenceFlows()}))}function cn(t,e){this._elementRegistry=t,this._graphicsFactory=e}function ln(t){return"labelTarget"in t}an.prototype.setSequenceFlowsDefault=function(){const t=this._elementRegistry.filter((t=>yt(t,"bpmn:ExclusiveGateway")));for(const e of t)this.setSequenceFlow(e)},an.prototype.resetSequenceFlows=function(){this._elementRegistry.filter((t=>yt(t,"bpmn:ExclusiveGateway"))).forEach((t=>{t.outgoing.filter(rn).length&&this.resetSequenceFlow(t)}))},an.prototype.resetSequenceFlow=function(t){this._simulator.setConfig(t,{activeOutgoing:void 0})},an.prototype.setSequenceFlow=function(t){const e=t.outgoing.filter(rn);if(e.length<2)return;const{activeOutgoing:n}=this._simulator.getConfig(t);let i;i=n?function(t,e){var n=t.outgoing.filter(rn),i=n.indexOf(e||t.sequenceFlow);return n[i+1]?n[i+1]:n[0]}(t,n):e[0],this._simulator.setConfig(t,{activeOutgoing:i}),t.outgoing.forEach((t=>{const e=t===i?"--token-simulation-grey-darken-30":"--token-simulation-grey-lighten-56",n=this._simulationStyles.get(e);this._elementColors.set(t,{stroke:n})}))},an.$inject=["eventBus","elementRegistry","elementColors","simulator","simulationStyles"],cn.$inject=["elementRegistry","graphicsFactory"],cn.prototype.get=function(t){const e=i(t);if(e)return ln(t)?{stroke:e.label&&e.label.get("color")}:{fill:e.get("background-color"),stroke:e.get("border-color")}},cn.prototype.set=function(t,e){const{fill:n,stroke:o}=e,s=i(t);s&&(ln(t)?s.label&&s.label.set("color",o):(s.set("background-color",n),s.set("border-color",o)),this._forceRedraw(t))},cn.prototype._forceRedraw=function(t){const e=this._elementRegistry.getGraphics(t),n=t.waypoints?"connection":"shape";this._graphicsFactory.update(n,t,e)};const pn={elementColors:["type",cn]},hn={__depends__:[pn,Re],exclusiveGatewaySettings:["type",an]};function un(t,e,n){this._elementRegistry=e,this._elementColors=n,this._colorCache={},t.on(Lt,5e4,(t=>{t.active?this.preserveColors():this.resetColors()}))}un.prototype.preserveColors=function(){this._elementRegistry.forEach((t=>{this._colorCache[t.id]=this._elementColors.get(t),this._elementColors.set(t,{stroke:"#000",fill:"#fff"})}))},un.prototype.resetColors=function(){this._elementRegistry.forEach((t=>{const e=this._colorCache[t.id];e&&this._elementColors.set(t,e)})),this._colorCache={}},un.$inject=["eventBus","elementRegistry","elementColors"];const mn={__depends__:[pn],__init__:["preserveElementColors"],preserveElementColors:["type",un]};function dn(t,e){var n=this;this._canvas=e,this.entries=[],this._init(),t.on(Lt,(function(t){t.active?l(n.container).remove("hidden"):l(n.container).add("hidden")}))}dn.prototype._init=function(){this.container=p('<div class="bts-palette hidden"></div>'),this._canvas.getContainer().appendChild(this.container)},dn.prototype.addEntry=function(t,e){var n=0;this.entries.forEach((function(t){e>=t.index&&n++})),this.container.insertBefore(t,this.container.childNodes[n]),this.entries.push({entry:t,index:e})},dn.$inject=["eventBus","canvas"];const fn={__depends__:[Ft,oe,re,Te,Me,Oe,qe,Ue,Je,Xe,en,sn,hn,mn,{__init__:["tokenSimulationPalette"],tokenSimulationPalette:["type",dn]}]};function vn(t,e,n,i,o,s,r,a){let c=!1;function l(t,e,n){const i=t[e];t[e]=function(){return n.call(this,i,arguments)}}function p(t,e){l(t,e,(function(t,e){if(!c)return t.apply(this,e)}))}function h(t,e){l(t,e,(function(t,e){if(c)throw new Error("model is read-only");return t.apply(this,e)}))}t.on(Lt,10001,(t=>{c=t.active,c&&(i.cancel(),e.close(),n.cancel()),r._update()})),p(e,"open"),p(n,"init"),p(i,"activate"),p(n,"init"),p(i,"activate"),h(s,"moveShape"),h(s,"updateAttachment"),h(s,"moveElements"),h(s,"moveConnection"),h(s,"layoutConnection"),h(s,"createConnection"),h(s,"createShape"),h(s,"createLabel"),h(s,"appendShape"),h(s,"removeElements"),h(s,"distributeElements"),h(s,"removeShape"),h(s,"removeConnection"),h(s,"replaceShape"),h(s,"pasteElements"),h(s,"alignElements"),h(s,"resizeShape"),h(s,"createSpace"),h(s,"updateWaypoints"),h(s,"reconnectStart"),h(s,"reconnectEnd"),l(o,"trigger",(function(t,e){const n=e[0];if(!c||!function(t,e){return t.indexOf(e)>-1}(["undo","redo","copy","paste","removeSelection","spaceTool","lassoTool","globalConnectTool","distributeElements","alignElements","directEditing"],n))return t.apply(this,e)}))}vn.$inject=["eventBus","contextPad","dragging","directEditing","editorActions","modeling","palette","paletteProvider"];const gn={__init__:["disableModeling"],disableModeling:["type",vn]};function _n(t,e,n,i){this._eventBus=t,this._canvas=e,this._selection=n,this._contextPad=i,this._active=!1,t.on("import.parse.start",(()=>{this._active&&(this.toggleMode(!1),t.once("import.done",(()=>{this.toggleMode(!0)})))})),t.on("diagram.init",(()=>{this._canvasParent=this._canvas.getContainer().parentNode,this._palette=a(".djs-palette",this._canvas.getContainer()),this._init()}))}_n.prototype._init=function(){this._container=p(`\n    <div class="bts-toggle-mode">\n      Token Simulation <span class="bts-toggle">${we()}</span>\n    </div>\n  `),h.bind(this._container,"click",(()=>this.toggleMode())),this._canvas.getContainer().appendChild(this._container)},_n.prototype.toggleMode=function(t=!this._active){if(t!==this._active){if(t)this._container.innerHTML=`Token Simulation <span class="bts-toggle">${Se()}</span>`,l(this._canvasParent).add("simulation"),l(this._palette).add("hidden");else{this._container.innerHTML=`Token Simulation <span class="bts-toggle">${we()}</span>`,l(this._canvasParent).remove("simulation"),l(this._palette).remove("hidden");const t=this._selection.get();1===t.length&&this._contextPad.open(t[0])}this._eventBus.fire(Lt,{active:t}),this._active=t}},_n.$inject=["eventBus","canvas","selection","contextPad"];const yn={__init__:["toggleMode"],toggleMode:["type",_n]};function bn(t,e,n,i,o,s){o.register({toggleTokenSimulation:function(){e.toggleMode()}}),o.register({togglePauseTokenSimulation:function(){n.toggle()}}),o.register({resetTokenSimulation:function(){i.resetSimulation()}});const r=s.get("log",!1);r&&o.register({toggleTokenSimulationLog:function(){r.toggle()}})}bn.$inject=["eventBus","toggleMode","pauseSimulation","resetSimulation","editorActions","injector"];const wn={__init__:["tokenSimulationEditorActions"],tokenSimulationEditorActions:["type",bn]};function Sn(t,e){var n=e.get("editorActions",!1),i=e.get("keyboard",!1);if(i&&n){var o=!1;t.on("keyboard.init",(function(){i.addListener(1e4,(function(t){!function(t){En(["t","T"],t)?n.trigger("toggleTokenSimulation"):o&&(En(["l","L"],t)?n.trigger("toggleTokenSimulationLog"):En([" ","Spacebar"],t)?n.trigger("togglePauseTokenSimulation"):En(["r","R"],t)&&n.trigger("resetTokenSimulation"))}(t.keyEvent)}))})),t.on(Lt,(function(t){var e=t.active;o=!!e}))}}function En(t,e){return t.indexOf(e.key)>-1}Sn.$inject=["eventBus","injector"];const Cn={__depends__:[fn,gn,yn,wn,{__init__:["tokenSimulationKeyboardBindings"],tokenSimulationKeyboardBindings:["type",Sn]}]};export{Cn as T};
