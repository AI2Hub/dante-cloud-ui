import{j as t}from"./npm-jsbn.c4097e57.js";const{BigInteger:e}=t.exports;class n{constructor(){this.tlv=null,this.t="00",this.l="00",this.v=""}getEncodedHex(){return this.tlv||(this.v=this.getValue(),this.l=this.getLength(),this.tlv=this.t+this.l+this.v),this.tlv}getLength(){const t=this.v.length/2;let e=t.toString(16);if(e.length%2==1&&(e="0"+e),t<128)return e;return(128+e.length/2).toString(16)+e}getValue(){return""}}class r extends n{constructor(t){super(),this.t="02",t&&(this.v=function(t){let n=t.toString(16);if("-"!==n[0])n.length%2==1?n="0"+n:n.match(/^[0-7]/)||(n="00"+n);else{n=n.substr(1);let r=n.length;r%2==1?r+=1:n.match(/^[0-7]/)||(r+=2);let i="";for(let t=0;t<r;t++)i+="f";i=new e(i,16),n=i.xor(t).add(e.ONE),n=n.toString(16).replace(/^-/,"")}return n}(t))}getValue(){return this.v}}class i extends n{constructor(t){super(),this.t="30",this.asn1Array=t}getValue(){return this.v=this.asn1Array.map((t=>t.getEncodedHex())).join(""),this.v}}function s(t,e){return+t[e+2]<8?1:128&+t.substr(e+2,2)}function o(t,n){const r=s(t,n),i=t.substr(n+2,2*r);if(!i)return-1;return(+i[0]<8?new e(i,16):new e(i.substr(2),16)).intValue()}function u(t,e){return e+2*(s(t,e)+1)}var l={encodeDer(t,e){const n=new r(t),s=new r(e);return new i([n,s]).getEncodedHex()},decodeDer(t){const n=u(t,0),r=u(t,n),i=o(t,n),s=t.substr(r,2*i),l=r+s.length,c=u(t,l),h=o(t,l),a=t.substr(c,2*h);return{r:new e(s,16),s:new e(a,16)}}};const{BigInteger:c}=t.exports,h=new c("2"),a=new c("3");class g{constructor(t,e){this.x=e,this.q=t}equals(t){return t===this||this.q.equals(t.q)&&this.x.equals(t.x)}toBigInteger(){return this.x}negate(){return new g(this.q,this.x.negate().mod(this.q))}add(t){return new g(this.q,this.x.add(t.toBigInteger()).mod(this.q))}subtract(t){return new g(this.q,this.x.subtract(t.toBigInteger()).mod(this.q))}multiply(t){return new g(this.q,this.x.multiply(t.toBigInteger()).mod(this.q))}divide(t){return new g(this.q,this.x.multiply(t.toBigInteger().modInverse(this.q)).mod(this.q))}square(){return new g(this.q,this.x.square().mod(this.q))}}class f{constructor(t,e,n,r){this.curve=t,this.x=e,this.y=n,this.z=null==r?c.ONE:r,this.zinv=null}getX(){return null===this.zinv&&(this.zinv=this.z.modInverse(this.curve.q)),this.curve.fromBigInteger(this.x.toBigInteger().multiply(this.zinv).mod(this.curve.q))}getY(){return null===this.zinv&&(this.zinv=this.z.modInverse(this.curve.q)),this.curve.fromBigInteger(this.y.toBigInteger().multiply(this.zinv).mod(this.curve.q))}equals(t){if(t===this)return!0;if(this.isInfinity())return t.isInfinity();if(t.isInfinity())return this.isInfinity();if(!t.y.toBigInteger().multiply(this.z).subtract(this.y.toBigInteger().multiply(t.z)).mod(this.curve.q).equals(c.ZERO))return!1;return t.x.toBigInteger().multiply(this.z).subtract(this.x.toBigInteger().multiply(t.z)).mod(this.curve.q).equals(c.ZERO)}isInfinity(){return null===this.x&&null===this.y||this.z.equals(c.ZERO)&&!this.y.toBigInteger().equals(c.ZERO)}negate(){return new f(this.curve,this.x,this.y.negate(),this.z)}add(t){if(this.isInfinity())return t;if(t.isInfinity())return this;const e=this.x.toBigInteger(),n=this.y.toBigInteger(),r=this.z,i=t.x.toBigInteger(),s=t.y.toBigInteger(),o=t.z,u=this.curve.q,l=e.multiply(o).mod(u),h=i.multiply(r).mod(u),a=l.subtract(h),g=n.multiply(o).mod(u),d=s.multiply(r).mod(u),p=g.subtract(d);if(c.ZERO.equals(a))return c.ZERO.equals(p)?this.twice():this.curve.infinity;const F=l.add(h),y=r.multiply(o).mod(u),m=a.square().mod(u),w=a.multiply(m).mod(u),x=y.multiply(p.square()).subtract(F.multiply(m)).mod(u),v=a.multiply(x).mod(u),I=p.multiply(m.multiply(l).subtract(x)).subtract(g.multiply(w)).mod(u),b=w.multiply(y).mod(u);return new f(this.curve,this.curve.fromBigInteger(v),this.curve.fromBigInteger(I),b)}twice(){if(this.isInfinity())return this;if(!this.y.toBigInteger().signum())return this.curve.infinity;const t=this.x.toBigInteger(),e=this.y.toBigInteger(),n=this.z,r=this.curve.q,i=this.curve.a.toBigInteger(),s=t.square().multiply(a).add(i.multiply(n.square())).mod(r),o=e.shiftLeft(1).multiply(n).mod(r),u=e.square().mod(r),l=u.multiply(t).multiply(n).mod(r),c=o.square().mod(r),h=s.square().subtract(l.shiftLeft(3)).mod(r),g=o.multiply(h).mod(r),d=s.multiply(l.shiftLeft(2).subtract(h)).subtract(c.shiftLeft(1).multiply(u)).mod(r),p=o.multiply(c).mod(r);return new f(this.curve,this.curve.fromBigInteger(g),this.curve.fromBigInteger(d),p)}multiply(t){if(this.isInfinity())return this;if(!t.signum())return this.curve.infinity;const e=t.multiply(a),n=this.negate();let r=this;for(let i=e.bitLength()-2;i>0;i--){r=r.twice();const s=e.testBit(i);s!==t.testBit(i)&&(r=r.add(s?this:n))}return r}}var d={ECPointFp:f,ECCurveFp:class{constructor(t,e,n){this.q=t,this.a=this.fromBigInteger(e),this.b=this.fromBigInteger(n),this.infinity=new f(this,null,null)}equals(t){return t===this||this.q.equals(t.q)&&this.a.equals(t.a)&&this.b.equals(t.b)}fromBigInteger(t){return new g(this.q,t)}decodePointHex(t){switch(parseInt(t.substr(0,2),16)){case 0:return this.infinity;case 2:case 3:const e=this.fromBigInteger(new c(t.substr(2),16));let n=this.fromBigInteger(e.multiply(e.square()).add(e.multiply(this.a)).add(this.b).toBigInteger().modPow(this.q.divide(new c("4")).add(c.ONE),this.q));return n.toBigInteger().mod(h).equals(new c(t.substr(0,2),16).subtract(h))||(n=n.negate()),new f(this,e,n);case 4:case 6:case 7:const r=(t.length-2)/2,i=t.substr(2,r),s=t.substr(r+2,r);return new f(this,this.fromBigInteger(new c(i,16)),this.fromBigInteger(new c(s,16)));default:return null}}}};const{BigInteger:p,SecureRandom:F}=t.exports,{ECCurveFp:y}=d,m=new F,{curve:w,G:x,n:v}=I();function I(){const t=new p("FFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00000000FFFFFFFFFFFFFFFF",16),e=new p("FFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00000000FFFFFFFFFFFFFFFC",16),n=new p("28E9FA9E9D9F5E344D5A9E4BCF6509A7F39789F515AB8F92DDBCBD414D940E93",16),r=new y(t,e,n),i=r.decodePointHex("0432C4AE2C1F1981195F9904466A39C9948FE30BBFF2660BE1715A4589334C74C7BC3736A2F4F6779C59BDCEE36B692153D0A9877CC62A474002DF32E52139F0A0");return{curve:r,G:i,n:new p("FFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFF7203DF6B21C6052B53BBF40939D54123",16)}}function b(t,e){return t.length>=e?t:new Array(e-t.length+1).join("0")+t}var B={getGlobalCurve:function(){return w},generateEcparam:I,generateKeyPairHex:function(t,e,n){const r=(t?new p(t,e,n):new p(v.bitLength(),m)).mod(v.subtract(p.ONE)).add(p.ONE),i=b(r.toString(16),64),s=x.multiply(r);return{privateKey:i,publicKey:"04"+b(s.getX().toBigInteger().toString(16),64)+b(s.getY().toBigInteger().toString(16),64)}},compressPublicKeyHex:function(t){if(130!==t.length)throw new Error("Invalid public key to compress");const e=(t.length-2)/2,n=t.substr(2,e);let r="03";return new p(t.substr(e+2,e),16).mod(new p("2")).equals(p.ZERO)&&(r="02"),r+n},utf8ToHex:function(t){const e=(t=unescape(encodeURIComponent(t))).length,n=[];for(let i=0;i<e;i++)n[i>>>2]|=(255&t.charCodeAt(i))<<24-i%4*8;const r=[];for(let i=0;i<e;i++){const t=n[i>>>2]>>>24-i%4*8&255;r.push((t>>>4).toString(16)),r.push((15&t).toString(16))}return r.join("")},leftPad:b,arrayToHex:function(t){return t.map((t=>1===(t=t.toString(16)).length?"0"+t:t)).join("")},arrayToUtf8:function(t){const e=[];let n=0;for(let i=0;i<2*t.length;i+=2)e[i>>>3]|=parseInt(t[n],10)<<24-i%8*4,n++;try{const n=[];for(let r=0;r<t.length;r++){const t=e[r>>>2]>>>24-r%4*8&255;n.push(String.fromCharCode(t))}return decodeURIComponent(escape(n.join("")))}catch(r){throw new Error("Malformed UTF-8 data")}},hexToArray:function(t){const e=[];let n=t.length;n%2!=0&&(t=b(t,n+1)),n=t.length;for(let r=0;r<n;r+=2)e.push(parseInt(t.substr(r,2),16));return e},verifyPublicKey:function(t){const e=w.decodePointHex(t);if(!e)return!1;const n=e.getX();return e.getY().square().equals(n.multiply(n.square()).add(n.multiply(w.a)).add(w.b))},comparePublicKeyHex:function(t,e){const n=w.decodePointHex(t);if(!n)return!1;const r=w.decodePointHex(e);return!!r&&n.equals(r)}};function q(t,e){const n=[],r=~~(e/8),i=e%8;for(let s=0,o=t.length;s<o;s++)n[s]=(t[(s+r)%o]<<i&255)+(t[(s+r+1)%o]>>>8-i&255);return n}function P(t,e){const n=[];for(let r=t.length-1;r>=0;r--)n[r]=255&(t[r]^e[r]);return n}function E(t,e){const n=[];for(let r=t.length-1;r>=0;r--)n[r]=t[r]&e[r]&255;return n}function A(t,e){const n=[];for(let r=t.length-1;r>=0;r--)n[r]=255&(t[r]|e[r]);return n}function H(t,e){const n=[];let r=0;for(let i=t.length-1;i>=0;i--){const s=t[i]+e[i]+r;s>255?(r=1,n[i]=255&s):(r=0,n[i]=255&s)}return n}function C(t){return P(P(t,q(t,9)),q(t,17))}function S(t,e,n,r){return r>=0&&r<=15?P(P(t,e),n):A(A(E(t,e),E(t,n)),E(e,n))}function T(t,e,n,r){return r>=0&&r<=15?P(P(t,e),n):A(E(t,e),E(function(t){const e=[];for(let n=t.length-1;n>=0;n--)e[n]=255&~t[n];return e}(t),n))}function R(t,e){const n=[],r=[];for(let w=0;w<16;w++){const t=4*w;n.push(e.slice(t,t+4))}for(let w=16;w<68;w++)n.push(P(P((i=P(P(n[w-16],n[w-9]),q(n[w-3],15)),P(P(i,q(i,15)),q(i,23))),q(n[w-13],7)),n[w-6]));var i;for(let w=0;w<64;w++)r.push(P(n[w],n[w+4]));const s=[121,204,69,25],o=[122,135,157,138];let u,l,c,h,a=t.slice(0,4),g=t.slice(4,8),f=t.slice(8,12),d=t.slice(12,16),p=t.slice(16,20),F=t.slice(20,24),y=t.slice(24,28),m=t.slice(28,32);for(let w=0;w<64;w++){const t=w>=0&&w<=15?s:o;u=q(H(H(q(a,12),p),q(t,w)),7),l=P(u,q(a,12)),c=H(H(H(S(a,g,f,w),d),l),r[w]),h=H(H(H(T(p,F,y,w),m),u),n[w]),d=f,f=q(g,9),g=a,a=c,m=y,y=q(F,19),F=p,p=C(h)}return P([].concat(a,g,f,d,p,F,y,m),t)}function K(t){let e=8*t.length,n=e%512;n=n>=448?512-n%448-1:448-n-1;const r=new Array((n-7)/8);for(let l=0,c=r.length;l<c;l++)r[l]=0;const i=[];e=e.toString(2);for(let l=7;l>=0;l--)if(e.length>8){const t=e.length-8;i[l]=parseInt(e.substr(t),2),e=e.substr(0,t)}else e.length>0?(i[l]=parseInt(e,2),e=""):i[l]=0;const s=[].concat(t,[128],r,i),o=s.length/64;let u=[115,128,22,111,73,20,178,185,23,36,66,215,218,138,6,0,169,111,48,188,22,49,56,170,227,141,238,77,176,251,14,78];for(let l=0;l<o;l++){const t=64*l;u=R(u,s.slice(t,t+64))}return u}const z=new Array(64),D=new Array(64);for(let ht=0;ht<64;ht++)z[ht]=54,D[ht]=92;var O={sm3:K,hmac:function(t,e){for(e.length>64&&(e=K(e));e.length<64;)e.push(0);let n=P(e,z).concat(t);return n=K(n),n=P(e,D).concat(n),n=K(n),n}};const{BigInteger:j}=t.exports,{encodeDer:k,decodeDer:X}=l,Z=B,L=O.sm3,{G:Y,curve:G,n:N}=Z.generateEcparam();function V(t,e,n="1234567812345678"){n=Z.utf8ToHex(n);const r=Z.leftPad(Y.curve.a.toBigInteger().toRadix(16),64),i=Z.leftPad(Y.curve.b.toBigInteger().toRadix(16),64),s=Z.leftPad(Y.getX().toBigInteger().toRadix(16),64),o=Z.leftPad(Y.getY().toBigInteger().toRadix(16),64);let u,l;if(128===e.length)u=e.substr(0,64),l=e.substr(64,64);else{const t=Y.curve.decodePointHex(e);u=Z.leftPad(t.getX().toBigInteger().toRadix(16),64),l=Z.leftPad(t.getY().toBigInteger().toRadix(16),64)}const c=Z.hexToArray(n+r+i+s+o+u+l),h=4*n.length;c.unshift(255&h),c.unshift(h>>8&255);const a=L(c);return Z.arrayToHex(L(a.concat(Z.hexToArray(t))))}function U(){const t=Z.generateKeyPairHex(),e=G.decodePointHex(t.publicKey);return t.k=new j(t.privateKey,16),t.x1=e.getX().toBigInteger(),t}var M={generateKeyPairHex:Z.generateKeyPairHex,compressPublicKeyHex:Z.compressPublicKeyHex,comparePublicKeyHex:Z.comparePublicKeyHex,doEncrypt:function(t,e,n=1){t="string"==typeof t?Z.hexToArray(Z.utf8ToHex(t)):Array.prototype.slice.call(t),e=Z.getGlobalCurve().decodePointHex(e);const r=Z.generateKeyPairHex(),i=new j(r.privateKey,16);let s=r.publicKey;s.length>128&&(s=s.substr(s.length-128));const o=e.multiply(i),u=Z.hexToArray(Z.leftPad(o.getX().toBigInteger().toRadix(16),64)),l=Z.hexToArray(Z.leftPad(o.getY().toBigInteger().toRadix(16),64)),c=Z.arrayToHex(L([].concat(u,t,l)));let h=1,a=0,g=[];const f=[].concat(u,l),d=()=>{g=L([...f,h>>24&255,h>>16&255,h>>8&255,255&h]),h++,a=0};d();for(let F=0,y=t.length;F<y;F++)a===g.length&&d(),t[F]^=255&g[a++];const p=Z.arrayToHex(t);return 0===n?s+p+c:s+c+p},doDecrypt:function(t,e,n=1,{output:r="string"}={}){e=new j(e,16);let i=t.substr(128,64),s=t.substr(192);0===n&&(i=t.substr(t.length-64),s=t.substr(128,t.length-128-64));const o=Z.hexToArray(s),u=Z.getGlobalCurve().decodePointHex("04"+t.substr(0,128)).multiply(e),l=Z.hexToArray(Z.leftPad(u.getX().toBigInteger().toRadix(16),64)),c=Z.hexToArray(Z.leftPad(u.getY().toBigInteger().toRadix(16),64));let h=1,a=0,g=[];const f=[].concat(l,c),d=()=>{g=L([...f,h>>24&255,h>>16&255,h>>8&255,255&h]),h++,a=0};d();for(let p=0,F=o.length;p<F;p++)a===g.length&&d(),o[p]^=255&g[a++];return Z.arrayToHex(L([].concat(l,o,c)))===i.toLowerCase()?"array"===r?o:Z.arrayToUtf8(o):"array"===r?[]:""},doSignature:function(t,e,{pointPool:n,der:r,hash:i,publicKey:s,userId:o}={}){let u="string"==typeof t?Z.utf8ToHex(t):Z.arrayToHex(t);i&&(s=s||function(t){const e=Y.multiply(new j(t,16)),n=Z.leftPad(e.getX().toBigInteger().toString(16),64),r=Z.leftPad(e.getY().toBigInteger().toString(16),64);return"04"+n+r}(e),u=V(u,s,o));const l=new j(e,16),c=new j(u,16);let h=null,a=null,g=null;do{do{let t;t=n&&n.length?n.pop():U(),h=t.k,a=c.add(t.x1).mod(N)}while(a.equals(j.ZERO)||a.add(h).equals(N));g=l.add(j.ONE).modInverse(N).multiply(h.subtract(a.multiply(l))).mod(N)}while(g.equals(j.ZERO));return r?k(a,g):Z.leftPad(a.toString(16),64)+Z.leftPad(g.toString(16),64)},doVerifySignature:function(t,e,n,{der:r,hash:i,userId:s}={}){let o,u,l="string"==typeof t?Z.utf8ToHex(t):Z.arrayToHex(t);if(i&&(l=V(l,n,s)),r){const t=X(e);o=t.r,u=t.s}else o=new j(e.substring(0,64),16),u=new j(e.substring(64),16);const c=G.decodePointHex(n),h=new j(l,16),a=o.add(u).mod(N);if(a.equals(j.ZERO))return!1;const g=Y.multiply(u).add(c.multiply(a)),f=h.add(g.getX().toBigInteger()).mod(N);return o.equals(f)},getPoint:U,verifyPublicKey:Z.verifyPublicKey};const{sm3:J,hmac:Q}=O;function W(t){return t.map((t=>1===(t=t.toString(16)).length?"0"+t:t)).join("")}function $(t){const e=[];let n=t.length;var r,i;n%2!=0&&(i=n+1,t=(r=t).length>=i?r:new Array(i-r.length+1).join("0")+r),n=t.length;for(let s=0;s<n;s+=2)e.push(parseInt(t.substr(s,2),16));return e}const _=16,tt=[214,144,233,254,204,225,61,183,22,182,20,194,40,251,44,5,43,103,154,118,42,190,4,195,170,68,19,38,73,134,6,153,156,66,80,244,145,239,152,122,51,84,11,67,237,207,172,98,228,179,28,169,201,8,232,149,128,223,148,250,117,143,63,166,71,7,167,252,243,115,23,186,131,89,60,25,230,133,79,168,104,107,129,178,113,100,218,139,248,235,15,75,112,86,157,53,30,36,14,94,99,88,209,162,37,34,124,59,1,33,120,135,212,0,70,87,159,211,39,82,76,54,2,231,160,196,200,158,234,191,138,210,64,199,56,181,163,247,242,206,249,97,21,161,224,174,93,164,155,52,26,85,173,147,50,48,245,140,177,227,29,246,226,46,130,102,202,96,192,41,35,171,13,83,78,111,213,219,55,69,222,253,142,47,3,255,106,114,109,108,91,81,141,27,175,146,187,221,188,127,17,217,92,65,31,16,90,216,10,193,49,136,165,205,123,189,45,116,208,18,184,229,180,176,137,105,151,74,12,150,119,126,101,185,241,9,197,110,198,132,24,240,125,236,58,220,77,32,121,238,95,62,215,203,57,72],et=[462357,472066609,943670861,1415275113,1886879365,2358483617,2830087869,3301692121,3773296373,4228057617,404694573,876298825,1347903077,1819507329,2291111581,2762715833,3234320085,3705924337,4177462797,337322537,808926789,1280531041,1752135293,2223739545,2695343797,3166948049,3638552301,4110090761,269950501,741554753,1213159005,1684763257];function nt(t){const e=[];for(let n=0,r=t.length;n<r;n+=2)e.push(parseInt(t.substr(n,2),16));return e}function rt(t,e){return t<<e|t>>>32-e}function it(t){return(255&tt[t>>>24&255])<<24|(255&tt[t>>>16&255])<<16|(255&tt[t>>>8&255])<<8|255&tt[255&t]}function st(t){return t^rt(t,2)^rt(t,10)^rt(t,18)^rt(t,24)}function ot(t){return t^rt(t,13)^rt(t,23)}function ut(t,e,n){const r=new Array(4),i=new Array(4);for(let s=0;s<4;s++)i[0]=255&t[4*s],i[1]=255&t[4*s+1],i[2]=255&t[4*s+2],i[3]=255&t[4*s+3],r[s]=i[0]<<24|i[1]<<16|i[2]<<8|i[3];for(let s,o=0;o<32;o+=4)s=r[1]^r[2]^r[3]^n[o+0],r[0]^=st(it(s)),s=r[2]^r[3]^r[0]^n[o+1],r[1]^=st(it(s)),s=r[3]^r[0]^r[1]^n[o+2],r[2]^=st(it(s)),s=r[0]^r[1]^r[2]^n[o+3],r[3]^=st(it(s));for(let s=0;s<16;s+=4)e[s]=r[3-s/4]>>>24&255,e[s+1]=r[3-s/4]>>>16&255,e[s+2]=r[3-s/4]>>>8&255,e[s+3]=255&r[3-s/4]}function lt(t,e,n,{padding:r="pkcs#7",mode:i,iv:s=[],output:o="string"}={}){if("cbc"===i&&("string"==typeof s&&(s=nt(s)),16!==s.length))throw new Error("iv is invalid");if("string"==typeof e&&(e=nt(e)),16!==e.length)throw new Error("key is invalid");if(t="string"==typeof t?0!==n?function(t){const e=[];for(let n=0,r=t.length;n<r;n++){const r=t.codePointAt(n);if(r<=127)e.push(r);else if(r<=2047)e.push(192|r>>>6),e.push(128|63&r);else if(r<=55295||r>=57344&&r<=65535)e.push(224|r>>>12),e.push(128|r>>>6&63),e.push(128|63&r);else{if(!(r>=65536&&r<=1114111))throw e.push(r),new Error("input is not supported");n++,e.push(240|r>>>18&28),e.push(128|r>>>12&63),e.push(128|r>>>6&63),e.push(128|63&r)}}return e}(t):nt(t):[...t],("pkcs#5"===r||"pkcs#7"===r)&&0!==n){const e=_-t.length%_;for(let n=0;n<e;n++)t.push(e)}const u=new Array(32);!function(t,e,n){const r=new Array(4),i=new Array(4);for(let s=0;s<4;s++)i[0]=255&t[0+4*s],i[1]=255&t[1+4*s],i[2]=255&t[2+4*s],i[3]=255&t[3+4*s],r[s]=i[0]<<24|i[1]<<16|i[2]<<8|i[3];r[0]^=2746333894,r[1]^=1453994832,r[2]^=1736282519,r[3]^=2993693404;for(let s,o=0;o<32;o+=4)s=r[1]^r[2]^r[3]^et[o+0],e[o+0]=r[0]^=ot(it(s)),s=r[2]^r[3]^r[0]^et[o+1],e[o+1]=r[1]^=ot(it(s)),s=r[3]^r[0]^r[1]^et[o+2],e[o+2]=r[2]^=ot(it(s)),s=r[0]^r[1]^r[2]^et[o+3],e[o+3]=r[3]^=ot(it(s));if(0===n)for(let s,o=0;o<16;o++)s=e[o],e[o]=e[31-o],e[31-o]=s}(e,u,n);const l=[];let c=s,h=t.length,a=0;for(;h>=_;){const e=t.slice(a,a+16),r=new Array(16);if("cbc"===i)for(let t=0;t<_;t++)0!==n&&(e[t]^=c[t]);ut(e,r,u);for(let t=0;t<_;t++)"cbc"===i&&0===n&&(r[t]^=c[t]),l[a+t]=r[t];"cbc"===i&&(c=0!==n?r:e),h-=_,a+=_}if(("pkcs#5"===r||"pkcs#7"===r)&&0===n){const t=l.length,e=l[t-1];for(let n=1;n<=e;n++)if(l[t-n]!==e)throw new Error("padding is invalid");l.splice(t-e,e)}return"array"!==o?0!==n?l.map((t=>1===(t=t.toString(16)).length?"0"+t:t)).join(""):function(t){const e=[];for(let n=0,r=t.length;n<r;n++)t[n]>=240&&t[n]<=247?(e.push(String.fromCodePoint(((7&t[n])<<18)+((63&t[n+1])<<12)+((63&t[n+2])<<6)+(63&t[n+3]))),n+=3):t[n]>=224&&t[n]<=239?(e.push(String.fromCodePoint(((15&t[n])<<12)+((63&t[n+1])<<6)+(63&t[n+2]))),n+=2):t[n]>=192&&t[n]<=223?(e.push(String.fromCodePoint(((31&t[n])<<6)+(63&t[n+1]))),n++):e.push(String.fromCodePoint(t[n]));return e.join("")}(l):l}var ct={sm2:M,sm3:function(t,e){if(t="string"==typeof t?function(t){const e=[];for(let n=0,r=t.length;n<r;n++){const r=t.codePointAt(n);if(r<=127)e.push(r);else if(r<=2047)e.push(192|r>>>6),e.push(128|63&r);else if(r<=55295||r>=57344&&r<=65535)e.push(224|r>>>12),e.push(128|r>>>6&63),e.push(128|63&r);else{if(!(r>=65536&&r<=1114111))throw e.push(r),new Error("input is not supported");n++,e.push(240|r>>>18&28),e.push(128|r>>>12&63),e.push(128|r>>>6&63),e.push(128|63&r)}}return e}(t):Array.prototype.slice.call(t),e){if("hmac"!==(e.mode||"hmac"))throw new Error("invalid mode");let n=e.key;if(!n)throw new Error("invalid key");return n="string"==typeof n?$(n):Array.prototype.slice.call(n),W(Q(t,n))}return W(J(t))},sm4:{encrypt:(t,e,n)=>lt(t,e,1,n),decrypt:(t,e,n)=>lt(t,e,0,n)}};export{ct as s};
