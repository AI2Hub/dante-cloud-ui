(window.webpackJsonp=window.webpackJsonp||[]).push([["npm.bpmn-js-token-simulation"],{e72f:function(t,e,n){"use strict";var i=n("63fd");const o=Object.freeze({ACTIVATED:1,RUNNING:2,ENDING:4,ENDED:8,DESTROYED:16,FAILED:32,TERMINATED:64,CANCELED:128,COMPLETED:256,COMPENSABLE:512,ACTIVE:7,NOT_DEAD:9}),s={};function r(t,e){throw new Error(`illegal transition: ${t.name} -> ${e}`)}function c(t,e){return t===s?e:t}class a{constructor(t,e,{start:n,cancel:i,complete:o,destroy:s,fail:r,terminate:a,compensable:l}={}){this.name=t,this.traits=e,this._start=c(n,this),this._compensable=c(l,this),this._cancel=c(i,this),this._complete=c(o,this),this._destroy=c(s,this),this._fail=c(r,this),this._terminate=c(a,this)}hasTrait(t){return 0!=(this.traits&t)}complete(){return this._complete||r(this,"complete")}destroy(){return this._destroy||r(this,"destroy")}cancel(){return this._cancel||r(this,"cancel")}fail(){return this._fail||r(this,"fail")}terminate(){return this._terminate||r(this,"terminate")}compensable(){return this._compensable||r(this,"compensable")}start(){return this._start||r(this,"start")}}const l=new a("failed",o.DESTROYED|o.FAILED),p=new a("terminated",o.DESTROYED|o.TERMINATED),h=new a("completed",o.DESTROYED|o.COMPLETED),u=new a("terminating",o.ENDING|o.TERMINATED,{destroy:p}),m=new a("canceling",o.ENDING|o.FAILED|o.CANCELED,{destroy:l,complete:s,terminate:u}),d=new a("completing",o.ENDING|o.COMPLETED,{destroy:h,cancel:m,terminate:u}),f=new a("failing",o.ENDING|o.FAILED,{cancel:m,complete:d,destroy:l,terminate:u}),v=new a("compensable:failing",o.ENDING|o.FAILED,{complete:s,terminate:u,destroy:l}),g=new a("compensable:completed",o.ENDED|o.COMPLETED,{cancel:m,fail:v,destroy:h,compensable:s}),_=new a("compensable:completing",o.ENDING|o.COMPLETED,{destroy:g,terminate:u,compensable:s}),y=new a("compensable:running",o.RUNNING|o.COMPENSABLE,{cancel:m,complete:_,compensable:s,destroy:g,fail:f,terminate:u}),b=new a("running",o.RUNNING,{cancel:m,complete:d,compensable:y,destroy:p,fail:f,terminate:u}),w=new a("activated",o.ACTIVATED,{start:b,destroy:p}),S=Object.freeze({ACTIVATED:w,RUNNING:b,CANCELING:m,COMPLETING:d,COMPLETED:h,FAILING:f,FAILED:l,TERMINATING:u,TERMINATED:p});class E{constructor(t,e,n=null,i=null){this.id=t,this.element=e,this.parent=n,this.initiator=i,this.subscriptions=new Set,this.children=[],this.state=S.ACTIVATED}get running(){return this.hasTrait(o.RUNNING)}get destroyed(){return this.hasTrait(o.DESTROYED)}get completed(){return this.hasTrait(o.COMPLETED)}get canceled(){return this.hasTrait(o.CANCELED)}get failed(){return this.hasTrait(o.FAILED)}hasTrait(t){return this.state.hasTrait(t)}start(){return this.state=this.state.start(),this}compensable(){return this.state=this.state.compensable(),this}fail(t){return this.failed||(this.state=this.state.fail(),this.failInitiator=t),this}cancel(t){return this.canceled||(this.state=this.state.cancel(),this.cancelInitiator=t),this}terminate(t){return this.state=this.state.terminate(),this.terminateInitiator=t,this}complete(){return this.state=this.state.complete(),this}destroy(t){return this.state=this.state.destroy(),this.destroyInitiator=t,this}getTokens(){return this.children.filter(t=>!t.destroyed).length}getTokensByElement(t){return this.children.filter(e=>!e.destroyed&&e.element===t).length}}function C(t,e){const n=[];for(const i of t)e(i)&&n.push(i);return n}function x(t,e){for(const n of t)if(e(n))return n;return null}function B(t,e){return["type","name","ref","iref"].every(n=>!(n in t)||t[n]===e[n])}var j=n("979a");var O=Object.prototype.toString,T=Object.prototype.hasOwnProperty;function k(t){return void 0===t}function F(t){return"[object Array]"===O.call(t)}function $(t){var e=O.call(t);return"[object Function]"===e||"[object AsyncFunction]"===e||"[object GeneratorFunction]"===e||"[object AsyncGeneratorFunction]"===e||"[object Proxy]"===e}function A(t,e){return T.call(t,e)}function P(t,e){var n;return e=M(e),I(t,(function(t,i){if(e(t,i))return n=t,!1})),n}function I(t,e){var n;if(!k(t)){var i=F(t)?N:D;for(var o in t)if(A(t,o)&&!1===e(n=t[o],i(o)))return n}}function L(t,e){return!!P(t,e)}function M(t){return $(t)?t:function(e){return e===t}}function D(t){return t}function N(t){return Number(t)}function R(t){return t.filter(t=>Object(j.is)(t,"bpmn:SequenceFlow"))}function z(t){return Object(j.is)(t,"bpmn:MessageFlow")}function G(t){return Object(j.is)(t,"bpmn:SequenceFlow")}function q(t){return V(t)&&Q(t,"bpmn:CompensateEventDefinition")}function H(t){return Object(j.is)(t,"bpmn:Activity")&&t.businessObject.isForCompensation}function V(t){return Object(j.is)(t,"bpmn:CatchEvent")&&!W(t)}function Y(t){return Object(j.is)(t,"bpmn:BoundaryEvent")&&!W(t)}function U(t){return Object(j.is)(t,"bpmn:StartEvent")&&!W(t)}function W(t){return!!t.labelTarget}function Z(t){return Object(j.getBusinessObject)(t).triggeredByEvent}function J(t){return Object(j.is)(t,"bpmn:StartEvent")&&Object(j.getBusinessObject)(t).isInterrupting||Object(j.is)(t,"bpmn:BoundaryEvent")&&Object(j.getBusinessObject)(t).cancelActivity}function K(t,e){return e.some(e=>Object(j.is)(t,e))}function Q(t,e){return L(Object(j.getBusinessObject)(t).eventDefinitions,t=>Object(j.is)(t,e))}function X(t,e,n){const s=t.get("scopeIds",!1)||new i.default([32,36]),r={},c={},a=new tt,l=new Set,p=[],h=new Set,u=new Set;function m(t,e){if(p.push([e,t]),1!==p.length)return;let n;for(;n=p[0];){const[t,e]=n;e.destroyed||t(),p.shift()}$("tick")}function d(t){return c[t.type]||a}function f(t){const{element:e,parentScope:n,initiator:i=null}=t,o=t.scope||L({element:e,parent:n,initiator:i});return m(o,(function(){o.running||o.start(),T("signal",{...t,scope:o}),d(e).signal({...t,scope:o}),o.parent&&F(o.parent)})),o}function v(t){const{event:e,initiator:n,scope:i}=t,o=y(e),s=i.subscriptions,r=C(s,t=>B(o,t.event)),c=r.filter(t=>!t.event.interrupting),a=r.filter(t=>t.event.interrupting);if(!a.length)return c.map(t=>t.triggerFn(n)).flat();const l=a.find(t=>!t.event.boundary)||a[0],p=C(s,t=>t.event.persistent||function(t,e){return t.type===e.type&&t.boundary&&!e.boundary}(t.event,l.event));return s.forEach(t=>{p.includes(t)||t.remove()}),[l.triggerFn(n)].flat().filter(t=>t)}function g(t,e,n){const i=(e=y(e)).element,o={scope:t,event:e,element:i,triggerFn:n,remove(){_(o)}};return u.add(o),t.subscriptions.add(o),i&&k(i),o}function _(t){const{scope:e,event:n}=t;u.delete(t),e.subscriptions.delete(t),n.element&&k(n.element)}function y(t){if(!t.businessObject)return t;const e=J(t),i=Y(t),o=function(t){return Object(j.is)(t,"bpmn:StartEvent")||Object(j.is)(t,"bpmn:IntermediateCatchEvent")||Object(j.is)(t,"bpmn:ReceiveTask")?Object(j.getBusinessObject)(t).name||t.id:null}(t),s={element:t,interrupting:e,boundary:i,...o?{iref:o}:{}},r=(t.businessObject.eventDefinitions||{})[0];if(!r)return{...s,type:et(t)?"message":"none"};if(Object(j.is)(r,"bpmn:LinkEventDefinition"))return{...s,type:"link",name:r.name};if(Object(j.is)(r,"bpmn:SignalEventDefinition"))return{...s,type:"signal",ref:r.signalRef};if(Object(j.is)(r,"bpmn:TimerEventDefinition"))return{...s,type:"timer"};if(Object(j.is)(r,"bpmn:ConditionalEventDefinition"))return{...s,type:"condition"};if(Object(j.is)(r,"bpmn:EscalationEventDefinition"))return{...s,type:"escalation",ref:r.escalationRef};if(Object(j.is)(r,"bpmn:CancelEventDefinition"))return{...s,type:"cancel"};if(Object(j.is)(r,"bpmn:ErrorEventDefinition"))return{...s,type:"error",ref:r.errorRef};if(Object(j.is)(r,"bpmn:MessageEventDefinition"))return{...s,type:"message",ref:r.messageRef};if(Object(j.is)(r,"bpmn:CompensateEventDefinition")){let e=r.activityRef&&n.get(r.activityRef.id);return e||(e=U(t)&&Z(t.parent)?t.parent.parent:Y(t)?t.host:t.parent),{...s,type:"compensate",ref:e,persistent:!0}}throw new Error("unknown event definition",r)}function b(t,e=!0){const{element:n,parent:i,initiator:o}=t;e&&T("createScope",{element:n,scope:i});const r=new E(s.next(),n,i,o);return i&&i.children.push(r),h.add(r),e&&$("createScope",{scope:r}),k(n),i&&k(i.element),r}function w(t){if("function"==typeof t)return t;const{event:e,element:n,scope:i}=t,o=t.elements||n&&[n],s=e&&y(e);return t=>(!s||B(s,t.event))&&(!o||o.includes(t.element))&&(!i||i===t.scope)}function S(t){if("function"==typeof t)return t;const{element:e,waitsOnElement:n,parent:i,trait:s=o.RUNNING,subscribedTo:r}=t,c=r?function(t){const e="function"===t?t:w(t);return t=>Array.from(t.subscriptions).some(e)}(r):()=>!0;return t=>(!e||t.element===e)&&(!i||t.parent===i)&&(!n||t.getTokensByElement(n)>0)&&t.hasTrait(s)&&c(t)}function O(t,e=null){if(!t.destroyed){t.destroy(e);for(const e of t.subscriptions){const n=e.event.traits||o.ACTIVE;t.hasTrait(n)||_(e)}if(t.destroyed){for(const n of t.children)n.destroyed||O(n,e);T("destroyScope",{element:t.element,scope:t}),h.delete(t),$("destroyScope",{scope:t})}k(t.element),t.parent&&k(t.parent.element)}}function T(t,e){$("trace",{...e,action:t})}function k(t){l.add(t),p.length||$("tick")}function F(t){$("scopeChanged",{scope:t})}function $(t,n={}){return e.fire("tokenSimulation.simulator."+t,n)}function A(t,n){e.on("tokenSimulation.simulator."+t,n)}function P(t,n){e.off("tokenSimulation.simulator."+t,n)}function I(t,e){const n=M(t);r[t.id||t]={...n,...e},k(t)}function L(t){const{element:e}=t,n=b(t),{children:i=[],attachers:o=[]}=e;for(const t of i)if(Z(t)){const e=t.children.filter(t=>U(t)&&!q(t));for(const i of e)g(n,i,e=>f({element:t,parentScope:n,startEvent:i,initiator:e}))}for(const t of o)Y(t)&&!q(t)&&g(n,t,e=>f({element:t,parentScope:n.parent,hostScope:n,initiator:e}));return n}function M(t){return r[t.id||t]||{}}A("tick",(function(){for(const t of l)$("elementChanged",{element:t});l.clear()})),this.createScope=b,this.destroyScope=O,this.findScope=function(t){return x(h,S(t))},this.findScopes=function(t){return C(h,S(t))},this.findSubscription=function(t){return x(u,w(t))},this.findSubscriptions=function(t){return C(u,w(t))},this.waitAtElement=function(t,e=!0){I(t,{wait:e})},this.waitForScopes=function(t,e){if(!e.length)return;const n={type:"all-completed",persistent:!1},i=new Set(e),o=e=>{i.delete(e.scope),0===i.size&&(P("destroyScope",o),v({scope:t,event:n}))};return A("destroyScope",o),n},this.setConfig=I,this.getConfig=M,this.signal=f,this.enter=function(t){const{element:e,scope:n,initiator:i=n}=t,o=L({element:e,parent:n,initiator:i});return m(o,(function(){o.running||o.start(),T("enter",t),d(e).enter({...t,initiator:i,scope:o}),F(n)})),o},this.exit=function(t){const{element:e,scope:n,initiator:i=n}=t;m(n,(function(){T("exit",t),d(e).exit({...t,initiator:i}),n.running&&n.complete(),O(n,i),n.parent&&F(n.parent)}))},this.subscribe=g,this.trigger=v,this.reset=function(){for(const t of h)O(t);for(const t of function(){const t=[];return n.forEach(e=>{if(!K(e,["bpmn:Process","bpmn:Participant"]))return;const n=b({element:e},!1);t.push(n);const i=e.children.filter(U);for(const t of i){g(n,{...y(t),interrupting:!1},n=>f({element:e,startEvent:t,initiator:n}))}}),t}())h.add(t);$("tick"),$("reset")},this.on=A,this.off=P,this.registerBehavior=function(t,e){c[t]=e}}function tt(){this.signal=function(t){console.log("ignored #exit",t.element)},this.exit=function(t){console.log("ignored #exit",t.element)},this.enter=function(t){console.log("ignored #enter",t.element)}}function et(t){return Object(j.is)(t,"bpmn:ReceiveTask")||t.incoming.some(t=>Object(j.is)(t,"bpmn:MessageFlow"))}function nt(t,e){this._simulator=t,this._activityBehavior=e,t.registerBehavior("bpmn:StartEvent",this)}function it(t,e,n){this._intermediateThrowEventBehavior=n,this._scopeBehavior=e,t.registerBehavior("bpmn:EndEvent",this)}function ot(t,e,n){this._simulator=t,this._activityBehavior=e,this._scopeBehavior=n,t.registerBehavior("bpmn:BoundaryEvent",this)}function st(t,e){this._activityBehavior=e,this._simulator=t,t.registerBehavior("bpmn:IntermediateCatchEvent",this),t.registerBehavior("bpmn:ReceiveTask",this)}function rt(t,e,n){this._simulator=t,this._activityBehavior=e,this._eventBehaviors=n,t.registerBehavior("bpmn:IntermediateThrowEvent",this)}function ct(t){this._simulator=t,t.registerBehavior("bpmn:ExclusiveGateway",this)}function at(t,e){this._simulator=t,this._activityBehavior=e,t.registerBehavior("bpmn:ParallelGateway",this)}function lt(t){this._simulator=t,t.registerBehavior("bpmn:EventBasedGateway",this)}function pt(t,e,n){this._simulator=t,this._scopeBehavior=e,this._transactionBehavior=n;const i=["bpmn:BusinessRuleTask","bpmn:CallActivity","bpmn:ManualTask","bpmn:ScriptTask","bpmn:SendTask","bpmn:ServiceTask","bpmn:Task","bpmn:UserTask"];for(const e of i)t.registerBehavior(e,this)}function ht(t,e,n,i){this._simulator=t,this._activityBehavior=e,this._scopeBehavior=n,this._transactionBehavior=i,t.registerBehavior("bpmn:SubProcess",this),t.registerBehavior("bpmn:Transaction",this),t.registerBehavior("bpmn:AdHocSubProcess",this)}X.$inject=["injector","eventBus","elementRegistry"],nt.prototype.signal=function(t){this._simulator.exit(t)},nt.prototype.exit=function(t){this._activityBehavior.exit(t)},nt.$inject=["simulator","activityBehavior"],it.$inject=["simulator","scopeBehavior","intermediateThrowEventBehavior"],it.prototype.enter=function(t){this._intermediateThrowEventBehavior.enter(t)},it.prototype.signal=function(t){this._intermediateThrowEventBehavior.signal(t)},it.prototype.exit=function(t){const{scope:e}=t;this._scopeBehavior.tryExit(e.parent,e)},ot.prototype.signal=function(t){const{element:e,scope:n,hostScope:i=this._simulator.findScope({parent:n.parent,element:e.host})}=t;if(!i)throw new Error("host scope not found");if(Object(j.getBusinessObject)(e).cancelActivity){this._scopeBehavior.interrupt(i,n);const e=this._scopeBehavior.tryExit(i,n);if(e){const n=this._simulator.subscribe(i,e,e=>(n.remove(),this._simulator.exit(t)));return}}this._simulator.exit(t)},ot.prototype.exit=function(t){this._activityBehavior.exit(t)},ot.$inject=["simulator","activityBehavior","scopeBehavior"],st.$inject=["simulator","activityBehavior"],st.prototype.signal=function(t){const{element:e}=t;return Object(j.is)(e,"bpmn:ReceiveTask")?this._activityBehavior.signal(t):this._simulator.exit(t)},st.prototype.enter=function(t){const{element:e}=t;if(Object(j.is)(e,"bpmn:ReceiveTask")){const e=this._activityBehavior._triggerMessages(t);if(e)return this._activityBehavior.signalOnEvent(t,e)}return this._activityBehavior.signalOnEvent(t,e)},st.prototype.exit=function(t){this._activityBehavior.exit(t)},rt.prototype.enter=function(t){const{element:e}=t,n=this._eventBehaviors.get(e);if(n){const e=n(t);if(e)return this._activityBehavior.signalOnEvent(t,e)}this._activityBehavior.enter(t)},rt.prototype.signal=function(t){this._activityBehavior.signal(t)},rt.prototype.exit=function(t){this._activityBehavior.exit(t)},rt.$inject=["simulator","activityBehavior","eventBehaviors"],ct.prototype.enter=function(t){this._simulator.exit(t)},ct.prototype.exit=function(t){const{element:e,scope:n}=t,i=R(e.outgoing);if(1===i.length)return this._simulator.enter({element:i[0],scope:n.parent});const{activeOutgoing:o}=this._simulator.getConfig(e),s=i.find(t=>t===o);if(!s)throw new Error("no outgoing configured");return this._simulator.enter({element:s,scope:n.parent})},ct.$inject=["simulator"],at.prototype.enter=function(t){const{scope:e,element:n}=t,i=R(n.incoming),{parent:o}=e,s=this._simulator.findScopes({parent:o,element:n});if(s.length===i.length){for(const t of s)t!==e&&this._simulator.destroyScope(t.complete(),e);this._simulator.exit(t)}},at.prototype.exit=function(t){this._activityBehavior.exit(t)},at.$inject=["simulator","activityBehavior"],lt.$inject=["simulator"],lt.prototype.enter=function(t){const{element:e,scope:n}=t,i=n.parent,o=function(t){return t.outgoing.map(t=>t.target).filter(t=>K(t,["bpmn:IntermediateCatchEvent","bpmn:ReceiveTask"]))}(e).map(t=>this._simulator.subscribe(i,t,e=>(o.forEach(t=>t.remove()),this._simulator.destroyScope(n,e),this._simulator.signal({element:t,parentScope:i,initiator:e}))))},pt.$inject=["simulator","scopeBehavior","transactionBehavior"],pt.prototype.signal=function(t){const e=this._triggerMessages(t);if(e)return this.signalOnEvent(t,e);this._simulator.exit(t)},pt.prototype.enter=function(t){const{element:e}=t,n=this.waitAtElement(e);if(n)return this.signalOnEvent(t,n);const i=this._triggerMessages(t);if(i)return this.signalOnEvent(t,i);this._simulator.exit(t)},pt.prototype.exit=function(t){const{element:e,scope:n}=t,i=n.parent,o=!n.failed;o&&!Z(e)&&this._transactionBehavior.registerCompensation(n);const s=o?e.outgoing.filter(G):[];s.forEach(t=>this._simulator.enter({element:t,scope:i})),0===s.length&&this._scopeBehavior.tryExit(i,n)},pt.prototype.signalOnEvent=function(t,e){const{scope:n,element:i}=t,o=this._simulator.subscribe(n,e,t=>(o.remove(),this._simulator.signal({scope:n,element:i,initiator:t})))},pt.prototype.waitAtElement=function(t){return this._simulator.getConfig(t).wait&&{element:t,type:"continue",interrupting:!1,boundary:!1}},pt.prototype._getMessageContexts=function(t,e=null){const n=e?t=>t.referencePoint.x>e.x:()=>!0;return[...t.incoming.filter(z).map(t=>{return{incoming:t,referencePoint:(e=t.waypoints,e&&e[e.length-1])};var e}),...t.outgoing.filter(z).map(t=>{return{outgoing:t,referencePoint:(e=t.waypoints,e&&e[0])};var e})].sort((t,e)=>t.referencePoint.x-e.referencePoint.x).filter(n)},pt.prototype._triggerMessages=function(t){const{element:e,initiator:n,scope:i}=t;let o=i.messageContexts;o||(o=i.messageContexts=this._getMessageContexts(e));const s=n&&n.element;if(z(s)&&i.expectedIncoming!==s)console.debug("Simulator :: ActivityBehavior :: ignoring out-of-bounds message");else for(;o.length;){const{incoming:t,outgoing:s}=o.shift();if(t){if(!n)continue;return i.expectedIncoming=t,{element:e,type:"message",name:t.id,interrupting:!1,boundary:!1}}this._simulator.signal({element:s})}},ht.$inject=["simulator","activityBehavior","scopeBehavior","transactionBehavior"],ht.prototype.signal=function(t){this._start(t)},ht.prototype.enter=function(t){const{element:e}=t,n=this._activityBehavior.waitAtElement(e);if(n)return this._activityBehavior.signalOnEvent(t,n);this._start(t)},ht.prototype.exit=function(t){const{scope:e}=t,n=e.parent;n.failInitiator===e&&n.complete(),this._activityBehavior.exit(t)},ht.prototype._start=function(t){const{element:e,startEvent:n,scope:i}=t,o=i.parent;if(Z(e)){if(!n)throw new Error("missing <startEvent>: required for event sub-process")}else if(n)throw new Error("unexpected <startEvent>: not allowed for sub-process");if(o.destroyed)throw new Error(`target scope <${o.id}> destroyed`);(function(t){return Object(j.is)(t,"bpmn:Transaction")})(e)&&this._transactionBehavior.setup(t),n&&J(n)&&this._scopeBehavior.interrupt(o,i);const s=n?[n]:function(t){return t.children.filter(t=>{if(W(t))return!1;return!t.incoming.find(t=>Object(j.is)(t,"bpmn:SequenceFlow"))&&(!H(t)&&(!Z(t)&&K(t,["bpmn:Activity","bpmn:StartEvent","bpmn:EndEvent"])))})}(e);for(const t of s)this._simulator.signal({element:t,parentScope:i,initiator:i})};const ut={type:"cancel",interrupting:!0,boundary:!1,persistent:!0};function mt(t,e){this._simulator=t,this._scopeBehavior=e}function dt(t,e){this._simulator=t,this._scopeBehavior=e,t.registerBehavior("bpmn:SequenceFlow",this)}function ft(t){this._simulator=t,t.registerBehavior("bpmn:MessageFlow",this)}function vt(t,e){return"label"!==t.type&&(Array.isArray(e)||(e=[e]),e.some((function(e){return Object(j.is)(t,e)})))}function gt(t,e){return L(Object(j.getBusinessObject)(t).eventDefinitions,t=>vt(t,e))}function _t(t,e,n){this._simulator=t,this._elementRegistry=e,this._scopeBehavior=n}function yt(t){return e=t,n="bpmn:LinkEventDefinition",P(Object(j.getBusinessObject)(e).eventDefinitions,t=>vt(t,n));var e,n}function bt(t){for(;Z(t.parent.element);)t=t.parent;return t.parent}mt.$inject=["simulator","scopeBehavior"],mt.prototype.setup=function(t){const{scope:e}=t,n=this._simulator.subscribe(e,ut,t=>(n.remove(),this.cancel({scope:e,initiator:t}))),i={type:"compensate",ref:e.element,persistent:!0,traits:o.NOT_DEAD},s=this._simulator.subscribe(e,i,t=>e.canceled?(s.remove(),this.compensate({scope:e,element:e.element,initiator:t})):this._simulator.trigger({event:ut,scope:e}))},mt.prototype.cancel=function(t){const{scope:e,initiator:n}=t;if(!e.destroyed)return e.cancel(n),this._simulator.trigger({event:{type:"compensate",ref:e.element},initiator:n,scope:e}),this._simulator.trigger({scope:e,initiator:n,event:ut})},mt.prototype.registerCompensation=function(t){const{element:e}=t,n=e.children.filter(Z).map(t=>t.children.find(t=>U(t)&&q(t))).filter(t=>t),i=e.attachers.filter(q);if(!n.length&&!i.length)return;const s=this.findTransactionScope(t.parent);Object(j.is)(s.element,"bpmn:Transaction")||this.makeCompensable(s);for(const i of n){const n={element:i,type:"compensate",persistent:!0,interrupting:!0,ref:e,traits:o.NOT_DEAD},s=i.parent,r=this._simulator.subscribe(t,n,e=>(r.remove(),this._simulator.signal({initiator:e,element:s,startEvent:i,parentScope:t})))}for(const t of i){const n={element:t,type:"compensate",persistent:!0,ref:e,traits:o.NOT_DEAD},i=t.outgoing.map(t=>t.target).find(H);if(!i)continue;const r=this._simulator.subscribe(s,n,t=>(r.remove(),this._simulator.enter({initiator:t,element:i,scope:s})))}},mt.prototype.makeCompensable=function(t){if(t.hasTrait(o.COMPENSABLE)||!t.parent)return;const e={type:"compensate",ref:t.element,interrupting:!0,persistent:!0,traits:o.NOT_DEAD};t.compensable();const n=this._simulator.subscribe(t,e,e=>(n.remove(),t.fail(e),this.compensate({scope:t,element:t.element,initiator:e}),this._scopeBehavior.tryExit(t,e),t)),i=t.parent;if(!i)return;const s=this._simulator.subscribe(i,e,n=>(s.remove(),this._simulator.trigger({scope:t,event:e,initiator:n})));this.makeCompensable(i)},mt.prototype.findTransactionScope=function(t){let e=t;for(;e;){const t=e.element;if(Object(j.is)(t,"bpmn:SubProcess")&&!Z(t))return e;if(K(t,["bpmn:Transaction","bpmn:Process","bpmn:Participant"]))return e;e=e.parent}throw function(t){throw new Error(`no transaction context for <${t.id}>`)}(t)},mt.prototype.compensate=function(t){const{scope:e,element:n}=t,i=C(e.subscriptions,t=>B({type:"compensate"},t.event)),o=i.filter(t=>t.event.ref===n),s=i.filter(t=>t.event.ref!==n);for(const t of o)this._scopeBehavior.preExit(e,e=>this._simulator.trigger(t));for(const t of s.reverse())this._scopeBehavior.preExit(e,e=>this._simulator.trigger(t))},dt.prototype.enter=function(t){this._simulator.exit(t)},dt.prototype.exit=function(t){const{element:e,scope:n}=t;this._simulator.enter({element:e.target,scope:n.parent})},dt.$inject=["simulator","scopeBehavior"],ft.$inject=["simulator"],ft.prototype.signal=function(t){this._simulator.exit(t)},ft.prototype.exit=function(t){const{element:e,scope:n}=t,i=e.target,o=V(i)?i:{type:"message",element:e,name:e.id},s=this._simulator.findSubscription({event:o,elements:[i,i.parent]});s&&this._simulator.trigger({event:o,initiator:n,scope:s.scope})},_t.$inject=["simulator","elementRegistry","scopeBehavior"],_t.prototype.get=function(t){const e={"bpmn:LinkEventDefinition":t=>{const{element:e,scope:n}=t,i=yt(e),o=n.parent,s=o.element.children.filter(t=>function(t){return V(t)&&Q(t,"bpmn:LinkEventDefinition")}(t)&&yt(t).name===i.name);for(const t of s)this._simulator.signal({element:t,parentScope:o,initiator:n})},"bpmn:SignalEventDefinition":t=>{const{element:e,scope:n}=t,i=this._simulator.findSubscriptions({event:e}),o=new Set;for(const t of i){const i=t.scope;o.has(i)||(o.add(i),this._simulator.trigger({event:e,scope:i,initiator:n}))}},"bpmn:EscalationEventDefinition":t=>{const{element:e,scope:n}=t,i=this._simulator.findScopes({subscribedTo:{event:e},trait:o.ACTIVE});let s=n;for(;s=s.parent;)if(i.includes(s)){this._simulator.trigger({event:e,scope:s,initiator:n});break}},"bpmn:ErrorEventDefinition":t=>{const{element:e,scope:n}=t;this._simulator.trigger({event:e,initiator:n,scope:bt(n)})},"bpmn:TerminateEventDefinition":t=>{const{scope:e}=t;this._scopeBehavior.terminate(e.parent,e)},"bpmn:CancelEventDefinition":t=>{const{scope:e,element:n}=t;this._simulator.trigger({event:n,initiator:e,scope:bt(e)})},"bpmn:CompensateEventDefinition":t=>{const{scope:e,element:n}=t;return this._simulator.waitForScopes(e,this._simulator.trigger({event:n,scope:bt(e)}))}},n=Object.entries(e).find(e=>gt(t,e[0]));return n&&n[1]};const wt={type:"pre-exit",persistent:!0,interrupting:!0,boundary:!1},St={type:"exit",interrupting:!0,boundary:!1,persistent:!0};function Et(t){this._simulator=t}function Ct(t){return"function"==typeof t?t:e=>e===t}function xt(t,e){this._simulator=t,this._scopeBehavior=e,t.registerBehavior("bpmn:Process",this),t.registerBehavior("bpmn:Participant",this)}Et.$inject=["simulator"],Et.prototype.isFinished=function(t,e=null){return e=Ct(e),t.children.every(t=>t.destroyed||t.completed||e(t))},Et.prototype.destroyChildren=function(t,e,n=null){n=Ct(n),t.children.filter(t=>!t.destroyed&&!n(t)).map(t=>{this._simulator.destroyScope(t,e)})},Et.prototype.terminate=function(t,e){this.destroyChildren(t,e),t.terminate(e),this.tryExit(t,e)},Et.prototype.interrupt=function(t,e){this.destroyChildren(t,e,e),t.fail(e)},Et.prototype.tryExit=function(t,e){if(!t)throw new Error("missing <scope>");if(e||(e=t),!this.isFinished(t,e))return St;const n=this._simulator.findSubscriptions({event:wt,scope:t});for(const t of n){const{event:n,scope:i}=t;if(this._simulator.trigger({event:n,scope:i,initiator:e}).length)return St}this._simulator.trigger({event:St,scope:t,initiator:e}),this.exit({scope:t,initiator:e})},Et.prototype.exit=function(t){const{scope:e,initiator:n}=t;if(!n)throw new Error("missing <initiator>");this._simulator.exit({element:e.element,scope:e,initiator:n})},Et.prototype.preExit=function(t,e){const n=this._simulator.subscribe(t,wt,t=>(n.remove(),e(t)));return n},xt.prototype.signal=function(t){const{startEvent:e,scope:n}=t;if(!e)throw new Error("missing <startEvent>");this._simulator.signal({element:e,parentScope:n})},xt.prototype.exit=function(t){const{scope:e,initiator:n}=t;this._scopeBehavior.destroyChildren(e,n)},xt.$inject=["simulator","scopeBehavior"];var Bt={__depends__:[{__init__:["startEventBehavior","endEventBehavior","boundaryEventBehavior","intermediateCatchEventBehavior","intermediateThrowEventBehavior","exclusiveGatewayBehavior","parallelGatewayBehavior","eventBasedGatewayBehavior","subProcessBehavior","sequenceFlowBehavior","messageFlowBehavior","processBehavior"],startEventBehavior:["type",nt],endEventBehavior:["type",it],boundaryEventBehavior:["type",ot],intermediateCatchEventBehavior:["type",st],intermediateThrowEventBehavior:["type",rt],exclusiveGatewayBehavior:["type",ct],parallelGatewayBehavior:["type",at],eventBasedGatewayBehavior:["type",lt],activityBehavior:["type",pt],subProcessBehavior:["type",ht],sequenceFlowBehavior:["type",dt],messageFlowBehavior:["type",ft],eventBehaviors:["type",_t],scopeBehavior:["type",Et],processBehavior:["type",xt],transactionBehavior:["type",mt]}],__init__:[["eventBus","simulator",function(t,e){t.on(["tokenSimulation.toggleMode","tokenSimulation.resetSimulation"],5e3,t=>{e.reset()})}]],simulator:["type",X]},jt=n("a092"),Ot=n.n(jt);function Tt(t,e){t.invoke(ft,this),this._animation=e}function kt(t,e){t.invoke(dt,this),this._animation=e}Ot()(Tt,ft),Tt.$inject=["injector","animation"],Tt.prototype.signal=function(t){const{element:e,scope:n}=t;this._animation.animate(e,n,()=>{ft.prototype.signal.call(this,t)})},Ot()(kt,dt),kt.$inject=["injector","animation"],kt.prototype.enter=function(t){const{element:e,scope:n}=t;this._animation.animate(e,n,()=>{dt.prototype.enter.call(this,t)})};var Ft={sequenceFlowBehavior:["type",kt],messageFlowBehavior:["type",Tt]};const $t="tokenSimulation.toggleMode",At="tokenSimulation.resetSimulation",Pt="tokenSimulation.simulator.destroyScope",It="tokenSimulation.simulator.createScope",Lt=t=>!0;function Mt(t,e){this._eventBus=t,this._simulator=e,this._filter=Lt,t.on([$t,At],()=>{this._filter=Lt}),t.on(Pt,t=>{const{scope:e}=t;this._scope===e&&e.parent&&this.toggle(e.parent)}),t.on(It,t=>{const{scope:e}=t;e.parent||!this._scope||Dt(this._scope,e)||this.toggle(null)})}function Dt(t,e){do{if(t===e)return!0}while(e=e.parent);return!1}Mt.prototype.toggle=function(t){const e=this._scope!==t;this._scope=e?t:null,this._filter=this._scope?t=>Dt(this._scope,t):t=>!0,this._eventBus.fire("tokenSimulation.scopeFilterChanged",{filter:this._filter,scope:this._scope})},Mt.prototype.isShown=function(t){return"string"==typeof t&&(t=this._simulator.findScope(e=>e.id===t)),t&&this._filter(t)},Mt.prototype.findScope=function(t){return this._simulator.findScopes(t).filter(t=>this.isShown(t))[0]},Mt.$inject=["eventBus","simulator"];var Nt={scopeFilter:["type",Mt]},Rt=n("f6d6"),zt=n("bbf8");const Gt=getComputedStyle(document.documentElement),qt=Gt.getPropertyValue("--token-simulation-green-base-44"),Ht=Gt.getPropertyValue("--token-simulation-white");function Vt(){}function Yt(t,e){return 2===e.length?Jt:1===t?Wt:t===e.length-1?Zt:Ut}const Ut=function(t){return t},Wt=function(t){return 1-Math.cos(t*Math.PI/2)},Zt=function(t){return Math.sin(t*Math.PI/2)},Jt=function(t){return-Math.cos(t*Math.PI)/2+.5};function Kt(t,e,n){this._eventBus=e,this._scopeFilter=n,this._animations=new Set,this._speed=1,e.on("import.done",()=>{const e=Object(Rt.query)(".viewport",t._svg);this.group=Object(zt.b)(Object(zt.g)('<g class="bts-animation-tokens" />'),e)}),e.on(At,()=>{this.clearAnimations()}),e.on("tokenSimulation.pauseSimulation",()=>{this.pause()}),e.on("tokenSimulation.playSimulation",()=>{this.play()}),e.on("tokenSimulation.scopeFilterChanged",t=>{this.each(t=>{this._scopeFilter.isShown(t.scope)?t.show():t.hide()})}),e.on(Pt,t=>{const{scope:e}=t;this.clearAnimations(e)})}function Qt(t,e,n){this.gfx=t,this.waypoints=e,this.done=n,this._paused=!0,this._t=0,this._parts=[],this.create()}Kt.prototype.animate=function(t,e,n){this.createAnimation(t,e,n)},Kt.prototype.pause=function(){this.each(t=>t.pause())},Kt.prototype.play=function(){this.each(t=>t.play())},Kt.prototype.each=function(t){this._animations.forEach(t)},Kt.prototype.createAnimation=function(t,e,n=Vt){if(!this.group)return;const i=new Qt(this._createTokenGfx(e),t.waypoints,()=>{this._animations.delete(i),n()});return i.setSpeed(this.getAnimationSpeed()),this._scopeFilter.isShown(e)||i.hide(),i.scope=e,i.element=t,this._animations.add(i),this._eventBus.fire("tokenSimulation.animationCreated",{animation:i}),i.play(),i},Kt.prototype.setAnimationSpeed=function(t){this._speed=t,this.each(e=>e.setSpeed(t)),this._eventBus.fire("tokenSimulation.animationSpeedChanged",{speed:t})},Kt.prototype.getAnimationSpeed=function(){return this._speed},Kt.prototype.clearAnimations=function(t){this.each(e=>{t&&e.scope!==t||e.remove()})},Kt.prototype._createTokenGfx=function(t){const e=Object(zt.g)(this._getTokenSVG(t).trim());return Object(zt.b)(e,this.group)},Kt.prototype._getTokenSVG=function(t){const e=t.colors||{primary:qt,auxiliary:Ht};return`\n    <g class="bts-token">\n      <circle\n        class="bts-circle"\n        r="10"\n        cx="10"\n        cy="10"\n        fill="${e.primary}"\n      />\n      <text\n        class="bts-text"\n        transform="translate(10, 14)"\n        text-anchor="middle"\n        fill="${e.auxiliary}"\n      >1</text>\n    </g>\n  `},Kt.$inject=["canvas","eventBus","scopeFilter"],Qt.prototype.pause=function(){this._paused=!0},Qt.prototype.play=function(){this._paused&&(this._paused=!1,this.tick(0)),this.schedule()},Qt.prototype.schedule=function(){if(this._paused)return;if(this._scheduled)return;const t=Date.now();this._scheduled=!0,requestAnimationFrame(()=>{this._scheduled=!1,this._paused||(this.tick((Date.now()-t)*this._speed),this.schedule())})},Qt.prototype.tick=function(t){const e=this._t=this._t+t,n=this._parts.find(t=>t.startTime<=e&&t.endTime>e);if(!n)return this.remove();const i=e-n.startTime,o=n.length*n.easing(i/n.duration),s=n.startLength+o,r=this._path.getPointAtLength(s);this.move(r.x,r.y)},Qt.prototype.move=function(t,e){Object(zt.c)(this.gfx,"transform",`translate(${t}, ${e})`)},Qt.prototype.create=function(){const t=this.waypoints,e=t.reduce((e,n,i)=>{const o=t[i-1];if(o){const c=e[e.length-1],a=c&&c.endLength||0,l=(s=o,r=n,Math.sqrt(Math.pow(s.x-r.x,2)+Math.pow(s.y-r.y,2)));e.push({startLength:a,endLength:a+l,length:l,easing:Yt(i,t)})}var s,r;return e},[]),n=e.reduce((function(t,e){return t+e.length}),0),i=t.reduce((t,e,n)=>{const i=e.x-10,o=e.y-10;return t.push([n>0?"L":"M",i,o]),t},[]).flat().join(" "),o=(s=n,Math.log(s)*(c=300,(r=250)+Math.floor(Math.random()*(c-r))));var s,r,c;this._parts=e.reduce((t,e,i)=>{const s=o/n*e.length,r=i>0?t[i-1].endTime:0,c=r+s;return[...t,{...e,startTime:r,endTime:c,duration:s}]},[]),this._path=Object(zt.g)(`<path d="${i}" />`),this._t=0},Qt.prototype.show=function(){Object(zt.c)(this.gfx,"display","")},Qt.prototype.hide=function(){Object(zt.c)(this.gfx,"display","none")},Qt.prototype.remove=function(){this.pause(),Object(zt.k)(this.gfx),this.done()},Qt.prototype.setSpeed=function(t){this._speed=t};var Xt={__depends__:[Bt,Ft,Nt],animation:["type",Kt]},te=n("2f5d"),ee=n.n(te);function ne(t){const e=ee()({count:60}).filter(t=>n(t.substring(1))<200);function n(t){return(299*parseInt(t.substr(0,2),16)+587*parseInt(t.substr(2,2),16)+114*parseInt(t.substr(4,2),16))/1e3}let i=0;t.on(It,1500,t=>{const{scope:o}=t;o.colors=function(t){const{element:o}=t;if(o&&"bpmn:MessageFlow"===o.type)return{primary:"#999",auxiliary:"#FFF"};if(t.parent)return t.parent.colors;const s=e[i++%e.length];return{primary:s,auxiliary:n(s)>=128?"#111":"#fff"}}(o)})}ne.$inject=["eventBus"];var ie={__init__:["coloredScopes"],coloredScopes:["type",ne]};function oe(t){return function(e=""){return`<span class="bts-icon ${e}">${t}</span>`}}const se=oe('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">\x3c!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --\x3e<path fill="currentColor" d="M12.83 352h262.34A12.82 12.82 0 0 0 288 339.17v-38.34A12.82 12.82 0 0 0 275.17 288H12.83A12.82 12.82 0 0 0 0 300.83v38.34A12.82 12.82 0 0 0 12.83 352zm0-256h262.34A12.82 12.82 0 0 0 288 83.17V44.83A12.82 12.82 0 0 0 275.17 32H12.83A12.82 12.82 0 0 0 0 44.83v38.34A12.82 12.82 0 0 0 12.83 96zM432 160H16a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h416a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0 256H16a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h416a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16z"/></svg>'),re=oe('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 512">\x3c!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --\x3e<path fill="currentColor" d="M224.3 273l-136 136c-9.4 9.4-24.6 9.4-33.9 0l-22.6-22.6c-9.4-9.4-9.4-24.6 0-33.9l96.4-96.4-96.4-96.4c-9.4-9.4-9.4-24.6 0-33.9L54.3 103c9.4-9.4 24.6-9.4 33.9 0l136 136c9.5 9.4 9.5 24.6.1 34z"/></svg>'),ce=oe('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">\x3c!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --\x3e<path fill="currentColor" d="M504 256c0 136.967-111.033 248-248 248S8 392.967 8 256 119.033 8 256 8s248 111.033 248 248zM227.314 387.314l184-184c6.248-6.248 6.248-16.379 0-22.627l-22.627-22.627c-6.248-6.249-16.379-6.249-22.628 0L216 308.118l-70.059-70.059c-6.248-6.248-16.379-6.248-22.628 0l-22.627 22.627c-6.248 6.248-6.248 16.379 0 22.627l104 104c6.249 6.249 16.379 6.249 22.628.001z"/></svg>'),ae=oe('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 580.5 448">\n  <path fill="currentColor" d="M112 0C85 0 64 22 64 48v196l192-89V48c0-26-22-48-48-48zm256 0c-27 0-48 22-48 48v77l190-89c-5-21-24-36-46-36Zm144 105-192 89v70l192-89zM256 224 64 314v70l192-90zm256 21-192 89v66c0 27 21 48 48 48h96c26 0 48-21 48-48zM256 364 89 442c7 4 14 6 23 6h96c26 0 48-21 48-48z"/>\n  <rect fill="currentColor" width="63.3" height="618.2" x="311.5" y="-469.4" transform="rotate(65)" rx="10"/>\n</svg>\n'),le=oe('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512">\x3c!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --\x3e<path fill="currentColor" d="M384 144c0-44.2-35.8-80-80-80s-80 35.8-80 80c0 36.4 24.3 67.1 57.5 76.8-.6 16.1-4.2 28.5-11 36.9-15.4 19.2-49.3 22.4-85.2 25.7-28.2 2.6-57.4 5.4-81.3 16.9v-144c32.5-10.2 56-40.5 56-76.3 0-44.2-35.8-80-80-80S0 35.8 0 80c0 35.8 23.5 66.1 56 76.3v199.3C23.5 365.9 0 396.2 0 432c0 44.2 35.8 80 80 80s80-35.8 80-80c0-34-21.2-63.1-51.2-74.6 3.1-5.2 7.8-9.8 14.9-13.4 16.2-8.2 40.4-10.4 66.1-12.8 42.2-3.9 90-8.4 118.2-43.4 14-17.4 21.1-39.8 21.6-67.9 31.6-10.8 54.4-40.7 54.4-75.9zM80 64c8.8 0 16 7.2 16 16s-7.2 16-16 16-16-7.2-16-16 7.2-16 16-16zm0 384c-8.8 0-16-7.2-16-16s7.2-16 16-16 16 7.2 16 16-7.2 16-16 16zm224-320c8.8 0 16 7.2 16 16s-7.2 16-16 16-16-7.2-16-16 7.2-16 16-16z"/></svg>'),pe=oe('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512">\x3c!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --\x3e<path fill="currentColor" d="M569.517 440.013C587.975 472.007 564.806 512 527.94 512H48.054c-36.937 0-59.999-40.055-41.577-71.987L246.423 23.985c18.467-32.009 64.72-31.951 83.154 0l239.94 416.028zM288 354c-25.405 0-46 20.595-46 46s20.595 46 46 46 46-20.595 46-46-20.595-46-46-46zm-43.673-165.346l7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373 0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884 0-12.356 5.78-11.981 12.654z"/></svg>'),he=oe('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 192 512">\x3c!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --\x3e<path fill="currentColor" d="M20 424.229h20V279.771H20c-11.046 0-20-8.954-20-20V212c0-11.046 8.954-20 20-20h112c11.046 0 20 8.954 20 20v212.229h20c11.046 0 20 8.954 20 20V492c0 11.046-8.954 20-20 20H20c-11.046 0-20-8.954-20-20v-47.771c0-11.046 8.954-20 20-20zM96 0C56.235 0 24 32.235 24 72s32.235 72 72 72 72-32.235 72-72S135.764 0 96 0z"/></svg>'),ue=oe('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">\x3c!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --\x3e<path fill="currentColor" d="M144 479H48c-26.5 0-48-21.5-48-48V79c0-26.5 21.5-48 48-48h96c26.5 0 48 21.5 48 48v352c0 26.5-21.5 48-48 48zm304-48V79c0-26.5-21.5-48-48-48h-96c-26.5 0-48 21.5-48 48v352c0 26.5 21.5 48 48 48h96c26.5 0 48-21.5 48-48z"/></svg>'),me=oe('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">\x3c!-- Adapted from Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --\x3e<path fill="currentColor" d="M424.4 214.7L72.4 6.6C43.8-10.3 0 6.1 0 47.9V464c0 37.5 40.7 60.1 72.4 41.3l352-208c31.4-18.5 31.5-64.1 0-82.6z"/></svg>'),de=oe('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">\x3c!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --\x3e<path fill="currentColor" d="M440.65 12.57l4 82.77A247.16 247.16 0 0 0 255.83 8C134.73 8 33.91 94.92 12.29 209.82A12 12 0 0 0 24.09 224h49.05a12 12 0 0 0 11.67-9.26 175.91 175.91 0 0 1 317-56.94l-101.46-4.86a12 12 0 0 0-12.57 12v47.41a12 12 0 0 0 12 12H500a12 12 0 0 0 12-12V12a12 12 0 0 0-12-12h-47.37a12 12 0 0 0-11.98 12.57zM255.83 432a175.61 175.61 0 0 1-146-77.8l101.8 4.87a12 12 0 0 0 12.57-12v-47.4a12 12 0 0 0-12-12H12a12 12 0 0 0-12 12V500a12 12 0 0 0 12 12h47.35a12 12 0 0 0 12-12.6l-4.15-82.57A247.17 247.17 0 0 0 255.83 504c121.11 0 221.93-86.92 243.55-201.82a12 12 0 0 0-11.8-14.18h-49.05a12 12 0 0 0-11.67 9.26A175.86 175.86 0 0 1 255.83 432z"/></svg>'),fe=oe('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512">\x3c!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --\x3e<path fill="currentColor" d="M288 32C128.94 32 0 160.94 0 320c0 52.8 14.25 102.26 39.06 144.8 5.61 9.62 16.3 15.2 27.44 15.2h443c11.14 0 21.83-5.58 27.44-15.2C561.75 422.26 576 372.8 576 320c0-159.06-128.94-288-288-288zm0 64c14.71 0 26.58 10.13 30.32 23.65-1.11 2.26-2.64 4.23-3.45 6.67l-9.22 27.67c-5.13 3.49-10.97 6.01-17.64 6.01-17.67 0-32-14.33-32-32S270.33 96 288 96zM96 384c-17.67 0-32-14.33-32-32s14.33-32 32-32 32 14.33 32 32-14.33 32-32 32zm48-160c-17.67 0-32-14.33-32-32s14.33-32 32-32 32 14.33 32 32-14.33 32-32 32zm246.77-72.41l-61.33 184C343.13 347.33 352 364.54 352 384c0 11.72-3.38 22.55-8.88 32H232.88c-5.5-9.45-8.88-20.28-8.88-32 0-33.94 26.5-61.43 59.9-63.59l61.34-184.01c4.17-12.56 17.73-19.45 30.36-15.17 12.57 4.19 19.35 17.79 15.17 30.36zm14.66 57.2l15.52-46.55c3.47-1.29 7.13-2.23 11.05-2.23 17.67 0 32 14.33 32 32s-14.33 32-32 32c-11.38-.01-20.89-6.28-26.57-15.22zM480 384c-17.67 0-32-14.33-32-32s14.33-32 32-32 32 14.33 32 32-14.33 32-32 32z"/></svg>'),ve=oe('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">\x3c!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --\x3e<path fill="currentColor" d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm121.6 313.1c4.7 4.7 4.7 12.3 0 17L338 377.6c-4.7 4.7-12.3 4.7-17 0L256 312l-65.1 65.6c-4.7 4.7-12.3 4.7-17 0L134.4 338c-4.7-4.7-4.7-12.3 0-17l65.6-65-65.6-65.1c-4.7-4.7-4.7-12.3 0-17l39.6-39.6c4.7-4.7 12.3-4.7 17 0l65 65.7 65.1-65.6c4.7-4.7 12.3-4.7 17 0l39.6 39.6c4.7 4.7 4.7 12.3 0 17L312 256l65.6 65.1z"/></svg>'),ge=oe('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 352 512">\x3c!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --\x3e<path fill="currentColor" d="M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z"/></svg>'),_e=oe('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512">\x3c!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --\x3e<path fill="currentColor" d="M384 64H192C85.961 64 0 149.961 0 256s85.961 192 192 192h192c106.039 0 192-85.961 192-192S490.039 64 384 64zM64 256c0-70.741 57.249-128 128-128 70.741 0 128 57.249 128 128 0 70.741-57.249 128-128 128-70.741 0-128-57.249-128-128zm320 128h-48.905c65.217-72.858 65.236-183.12 0-256H384c70.741 0 128 57.249 128 128 0 70.74-57.249 128-128 128z"/></svg>'),ye=oe('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512">\x3c!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --\x3e<path fill="currentColor" d="M384 64H192C86 64 0 150 0 256s86 192 192 192h192c106 0 192-86 192-192S490 64 384 64zm0 320c-70.8 0-128-57.3-128-128 0-70.8 57.3-128 128-128 70.8 0 128 57.3 128 128 0 70.8-57.3 128-128 128z"/></svg>');function be(t){this._exclusiveGatewaySettings=t}function we(t){this._simulator=t}function Se(t){this._simulator=t}be.prototype.createContextPads=function(t){if(t.outgoing.filter((function(t){return vt(t,"bpmn:SequenceFlow")})).length<2)return;const e=`\n    <div class="bts-context-pad" title="Set Sequence Flow">\n      ${le()}\n    </div>\n  `;return[{action:()=>{this._exclusiveGatewaySettings.setSequenceFlow(t)},element:t,html:e}]},be.$inject=["exclusiveGatewaySettings"],we.prototype.createContextPads=function(t){return vt(t,"bpmn:ReceiveTask")||vt(t,"bpmn:SubProcess")&&Object(j.getBusinessObject)(t).triggeredByEvent?[]:[this.createPauseContextPad(t)]},we.prototype.createPauseContextPad=function(t){const e=this._isPaused(t),n=`\n    <div class="bts-context-pad ${e?"":"show-hover"}" title="${e?"Remove":"Add"} pause point">\n      ${(e?ae:ue)("show-hover")}\n      ${ue("hide-hover")}\n    </div>\n  `;return{action:()=>{this._togglePaused(t)},element:t,hideContexts:()=>this._findSubscriptions({element:t}),html:n}},we.prototype._isPaused=function(t){const{wait:e}=this._simulator.getConfig(t);return e},we.prototype._togglePaused=function(t){const e=!this._isPaused(t);this._simulator.waitAtElement(t,e)},we.prototype._findSubscriptions=function(t){return this._simulator.findSubscriptions(t)},we.$inject=["simulator"],Se.$inject=["simulator"],Se.prototype.createContextPads=function(t){return[this.createTriggerContextPad(t)]},Se.prototype.createTriggerContextPad=function(t){const e=`\n    <div class="bts-context-pad" title="Trigger Event">\n      ${me()}\n    </div>\n  `;return{action:t=>{const{event:e,scope:n}=t[0];return this._simulator.trigger({event:e,scope:n})},element:t,html:e,contexts:()=>this._findSubscriptions({element:t})}},Se.prototype._findSubscriptions=function(t){return this._simulator.findSubscriptions(t)};function Ee(t,e,n,i,o,s){this._elementRegistry=e,this._overlays=n,this._injector=i,this._canvas=o,this._scopeFilter=s,this._overlayCache=new Map,this._handlerIdx=0,this._handlers=[],this.registerHandler("bpmn:ExclusiveGateway",be),this.registerHandler("bpmn:Activity",we),this.registerHandler("bpmn:StartEvent",Se),this.registerHandler("bpmn:IntermediateCatchEvent",Se),this.registerHandler("bpmn:BoundaryEvent",Se),this.registerHandler("bpmn:Activity",Se),t.on($t,500,t=>{t.active?this.openContextPads():this.closeContextPads()}),t.on(At,500,()=>{this.closeContextPads(),this.openContextPads()}),t.on("tokenSimulation.scopeFilterChanged",t=>{const e=Object(Rt.queryAll)(".djs-overlay-ts-context-menu [data-scope-ids]",n._overlayRoot);for(const t of e){const e=t.dataset.scopeIds.split(",").some(t=>s.isShown(t));Object(Rt.classes)(t).toggle("hidden",!e)}const i=Object(Rt.queryAll)(".djs-overlay-ts-context-menu [data-hide-scope-ids]",n._overlayRoot);for(const t of i){const e=t.dataset.hideScopeIds.split(",").some(t=>s.isShown(t));Object(Rt.classes)(t).toggle("hidden",e)}}),t.on("tokenSimulation.simulator.elementChanged",500,t=>{const{element:e}=t;this.updateElementContextPads(e)})}Ee.prototype.registerHandler=function(t,e){const n=this._injector.instantiate(e);n.hash=String(this._handlerIdx++),this._handlers.push({handler:n,type:t})},Ee.prototype.getHandlers=function(t){return this._handlers.filter(({type:e})=>vt(t,e)).map(({handler:t})=>t)},Ee.prototype.openContextPads=function(t){t||(t=this._canvas.getRootElement()),this._elementRegistry.forEach(e=>{(function(t,e){do{if(t===e)return!0;e=e.parent}while(e);return!1})(t,e)&&this.updateElementContextPads(e)})},Ee.prototype._getOverlays=function(t){return this._overlayCache.get(t)||[]},Ee.prototype._addOverlay=function(t,e){const{handlerHash:n}=e;if(!n)throw new Error("<handlerHash> required");const i=this._overlays.add(t,"ts-context-menu",{...e,position:{top:-15,left:-15},show:{minZoom:.5}}),o=this._overlays.get(i),s=this._overlayCache;s.has(n)||s.set(n,[]),s.get(n).push(o)},Ee.prototype._removeOverlay=function(t){const{id:e,handlerHash:n}=t;this._overlays.remove(e);const i=this._overlayCache.get(n)||[],o=i.indexOf(t);-1!==o&&i.splice(o,1)},Ee.prototype.updateElementContextPads=function(t){for(const e of this.getHandlers(t))this._updateElementContextPads(t,e)},Ee.prototype._updateElementContextPads=function(t,e){const n=(e.createContextPads(t)||[]).filter(t=>t),i=`${t.id}------${e.hash}`,o=this._getOverlays(i),s=[];for(const t of n){const{element:e,contexts:n,hideContexts:r,action:c,html:a}=t,l=`${t.element.id}-------${a}`;let p=o.find(t=>t.hash===l);const h=p&&p.html||Object(Rt.domify)(a);if(n){const t=n();h.dataset.scopeIds=t.map(t=>t.scope.id).join(",");const e=t.filter(t=>this._scopeFilter.isShown(t.scope));Object(Rt.classes)(h).toggle("hidden",0===e.length)}if(r){const t=r();h.dataset.hideScopeIds=t.map(t=>t.scope.id).join(",");const e=t.filter(t=>this._scopeFilter.isShown(t.scope));Object(Rt.classes)(h).toggle("hidden",e.length>0)}p?s.push(p):(c&&Rt.event.bind(h,"click",t=>{t.preventDefault();const e=n?n().filter(t=>this._scopeFilter.isShown(t.scope)):null;c(e)}),this._addOverlay(e,{hash:l,handlerHash:i,html:h}))}for(const t of o)s.includes(t)||this._removeOverlay(t)},Ee.prototype.closeContextPads=function(){for(const t of this._overlayCache.values())for(const e of t)this._closeOverlay(e);this._overlayCache.clear()},Ee.prototype._closeOverlay=function(t){this._overlays.remove(t.id)},Ee.$inject=["eventBus","elementRegistry","overlays","injector","canvas","scopeFilter"];var Ce={__depends__:[Nt],__init__:["contextPads"],contextPads:["type",Ee]};function xe(t,e,n){t.on(Pt,t=>{const{scope:e}=t,{destroyInitiator:i,element:o}=e;if(!e.completed||!i)return;["bpmn:Process","bpmn:Participant"].includes(o.type)&&n.addElementNotification(i.element,{type:"success",icon:ce(),text:"Finished",scope:e})})}xe.$inject=["eventBus","simulator","elementNotifications"];function Be(t,e){this._overlays=t,e.on([At,It,$t],()=>{this.clear()})}Be.prototype.addElementNotification=function(t,e){const n={top:-15,right:15},{type:i,icon:o,text:s,scope:r={}}=e,c=r.colors,a=c?`style="color: ${c.auxiliary}; background: ${c.primary}"`:"",l=Object(Rt.domify)(`\n    <div class="bts-element-notification ${i||""}" ${a}>\n      ${o||""}\n      <span class="bts-text">${s}</span>\n    </div>\n  `);this._overlays.add(t,"element-notification",{position:n,html:l,show:{minZoom:.5}})},Be.prototype.clear=function(){this._overlays.remove({type:"element-notification"})},Be.prototype.removeElementNotification=function(t){this._overlays.remove({element:t})},Be.$inject=["overlays","eventBus"];var je={elementNotifications:["type",Be]};const Oe=2e3,Te=he();function ke(t,e,n){this._eventBus=t,this._canvas=e,this._scopeFilter=n,this._init(),t.on([$t,At],t=>{this.clear()})}ke.prototype._init=function(){this.container=Object(Rt.domify)('<div class="bts-notifications"></div>'),this._canvas.getContainer().appendChild(this.container)},ke.prototype.showNotification=function(t){const{text:e,type:n="info",icon:i=Te,scope:o,ttl:s=Oe}=t;if(o&&!this._scopeFilter.isShown(o))return;const r=i.startsWith("<")?i:`<i class="${i}"></i>`,c=o&&o.colors,a=c?`style="color: ${c.auxiliary}; background: ${c.primary}"`:"",l=Object(Rt.domify)(`\n    <div class="bts-notification ${n}">\n      <span class="bts-icon">${r}</span>\n      <span class="bts-text">${e}</span>\n      ${o?`<span class="bts-scope" ${a}>${o.id}</span>`:""}\n    </div>\n  `);for(this.container.appendChild(l);this.container.children.length>5;)this.container.children[0].remove();setTimeout((function(){l.remove()}),s)},ke.prototype.clear=function(){for(;this.container.children.length;)this.container.children[0].remove()},ke.$inject=["eventBus","canvas","scopeFilter"];var Fe={__depends__:[Nt],notifications:["type",ke]},$e={__depends__:[je,Fe],__init__:["simulationState"],simulationState:["type",xe]};function Ae(t,e,n,i,o){this._eventBus=t,this._canvas=e,this._scopeFilter=n,this._elementColors=i,this._simulationStyles=o,this._highlight=null,this._init(),t.on($t,t=>{t.active?Object(Rt.classes)(this._container).remove("hidden"):(Object(Rt.classes)(this._container).add("hidden"),Object(Rt.clear)(this._container),this.unhighlightScope())}),t.on("tokenSimulation.scopeFilterChanged",t=>{const e=this.getScopeElements();for(const t of e){const e=t.dataset.scopeId;Object(Rt.classes)(t).toggle("inactive",!this._scopeFilter.isShown(e))}}),t.on(It,t=>{this.addScope(t.scope)}),t.on(Pt,t=>{this.removeScope(t.scope)}),t.on("tokenSimulation.simulator.scopeChanged",t=>{this.updateScope(t.scope)}),t.on(At,()=>{this.removeAllInstances()})}function Pe(){this._cache={}}function Ie(){return{getPropertyValue:()=>""}}Ae.prototype._init=function(){this._container=Object(Rt.domify)('<div class="bts-scopes hidden"></div>'),this._canvas.getContainer().appendChild(this._container)},Ae.prototype.addScope=function(t){const{element:e}=t;if(!["bpmn:Process","bpmn:SubProcess","bpmn:Participant"].includes(e.type))return;const n=t.colors,i=n?`style="color: ${n.auxiliary}; background: ${n.primary}"`:"",o=Object(Rt.domify)(`\n    <div data-scope-id="${t.id}" class="bts-scope"\n         title="View Process Instance ${t.id}" ${i}>\n      ${t.getTokens()}\n    </div>\n  `);Rt.event.bind(o,"click",()=>{this._scopeFilter.toggle(t)}),Rt.event.bind(o,"mouseenter",()=>{this.highlightScope(e)}),Rt.event.bind(o,"mouseleave",()=>{this.unhighlightScope()}),this._scopeFilter.isShown(t)||Object(Rt.classes)(o).add("inactive"),this._container.appendChild(o)},Ae.prototype.getScopeElements=function(){return Object(Rt.queryAll)("[data-scope-id]",this._container)},Ae.prototype.getScopeElement=function(t){return Object(Rt.query)(`[data-scope-id="${t.id}"]`,this._container)},Ae.prototype.updateScope=function(t){const e=this.getScopeElement(t);e&&(e.textContent=t.getTokens())},Ae.prototype.removeScope=function(t){const e=this.getScopeElement(t);e&&e.remove()},Ae.prototype.removeAllInstances=function(){this._container.innerHTML=""},Ae.prototype.highlightScope=function(t){this.unhighlightScope(),this._highlight={element:t,colors:this._elementColors.get(t)},this._elementColors.set(t,this._getHighlightColors()),t.parent||Object(Rt.classes)(this._canvas.getContainer()).add("highlight")},Ae.prototype.unhighlightScope=function(){if(!this._highlight)return;const{element:t,colors:e}=this._highlight;this._elementColors.set(t,e),t.parent||Object(Rt.classes)(this._canvas.getContainer()).remove("highlight"),this._highlight=null},Ae.prototype._getHighlightColors=function(){return{fill:this._simulationStyles.get("--token-simulation-silver-base-97"),stroke:this._simulationStyles.get("--token-simulation-green-base-44")}},Ae.$inject=["eventBus","canvas","scopeFilter","elementColors","simulationStyles"],Pe.$inject=[],Pe.prototype.get=function(t){const e=this._cache[t];return e||(this._computedStyle||(this._computedStyle=this._getComputedStyle()),this._cache[t]=this._computedStyle.getPropertyValue(t).trim())},Pe.prototype._getComputedStyle=function(){return("function"==typeof getComputedStyle?getComputedStyle:Ie)("undefined"!=typeof document?document.documentElement:{})};var Le={simulationStyles:["type",Pe]},Me={__depends__:[Nt,Le],__init__:["showScopes"],showScopes:["type",Ae]},De=n("04ae");const Ne=he();function Re(t){const e=t&&t.businessObject.name;return e&&Object(De.a)(e)}function ze(t,e,n,i,o,s){this._notifications=e,this._tokenSimulationPalette=n,this._canvas=i,this._scopeFilter=o,this._init(),t.on("tokenSimulation.scopeFilterChanged",t=>{const e=Object(Rt.queryAll)(".bts-entry[data-scope-id]",this._container);for(const t of e){const e=t.dataset.scopeId;Object(Rt.classes)(t).toggle("inactive",!this._scopeFilter.isShown(e))}}),t.on(Pt,t=>{const{scope:e}=t,{element:n}=e,i=e.completed;if(!["bpmn:Process","bpmn:Participant","bpmn:SubProcess"].includes(n.type))return;const o=`${vt(n,"bpmn:SubProcess")?Re(n)||"SubProcess":"Process"} ${i?"finished":"canceled"}`;this.log({text:o,icon:i?ce():ve(),scope:e})}),t.on(It,t=>{const{scope:e}=t,{element:n}=e;if(!["bpmn:Process","bpmn:Participant","bpmn:SubProcess"].includes(n.type))return;const i=(vt(n,"bpmn:SubProcess")?Re(n)||"SubProcess":"Process")+" started";this.log({text:i,icon:ce(),scope:e})}),t.on("tokenSimulation.simulator.trace",t=>{const{action:e,scope:n,element:i}=t;if("exit"!==e)return;const o=n.parent,s=Re(i);if(vt(i,"bpmn:BusinessRuleTask")?this.log({text:s||"Business Rule Task",icon:"bpmn-icon-business-rule",scope:o}):vt(i,"bpmn:CallActivity")?this.log({text:s||"Call Activity",icon:"bpmn-icon-call-activity",scope:o}):(vt(i,"bpmn:IntermediateCatchEvent")||vt(i,"bpmn:IntermediateThrowEvent"))&&this.log({text:s||"Intermediate Event",icon:"bpmn-icon-intermediate-event-none",scope:o}),vt(i,"bpmn:BoundaryEvent"))this.log({text:s||"Boundary Event",icon:"bpmn-icon-intermediate-event-none",scope:o});else if(vt(i,"bpmn:ManualTask"))this.log({text:s||"Manual Task",icon:"bpmn-icon-manual",scope:o});else if(vt(i,"bpmn:ScriptTask"))this.log({text:s||"Script Task",icon:"bpmn-icon-script",scope:o});else if(vt(i,"bpmn:ServiceTask"))this.log({text:s||"Service Task",icon:"bpmn-icon-service",scope:o});else if(vt(i,"bpmn:Task"))this.log({text:s||"Task",icon:"bpmn-icon-task",scope:o});else if(vt(i,"bpmn:UserTask"))this.log({text:s||"User Task",icon:"bpmn-icon-user",scope:o});else if(vt(i,"bpmn:ExclusiveGateway")){if(i.outgoing.length<2)return;const t=Re(i.sequenceFlow);let e=s||"Gateway";t&&(e=e.concat(` ${re()} ${t}`)),this.log({text:e,icon:"bpmn-icon-gateway-xor",scope:o})}else vt(i,"bpmn:EndEvent")?gt(Object(j.getBusinessObject)(i),"bpmn:TerminateEventDefinition")?this.log({text:s||"Terminate End Event",icon:"bpmn-icon-end-event-terminate",scope:o}):this.log({text:s||"End Event",icon:"bpmn-icon-end-event-none",scope:o}):vt(i,"bpmn:StartEvent")&&this.log({text:s||"Start Event",icon:"bpmn-icon-start-event-none",scope:o})}),t.on([$t,At],t=>{this.clear(),Object(Rt.classes)(this._container).add("hidden")})}ze.prototype._init=function(){this._container=Object(Rt.domify)(`\n    <div class="bts-log hidden">\n      <div class="bts-header">\n        ${se("bts-log-icon")}\n        <button class="bts-close">\n          ${ge()}\n        </button>\n      </div>\n      <div class="bts-content">\n        <p class="bts-entry placeholder">No Entries</p>\n      </div>\n    </div>\n  `),this._placeholder=Object(Rt.query)(".bts-placeholder",this._container),this._content=Object(Rt.query)(".bts-content",this._container),Rt.event.bind(this._content,"wheel",t=>{t.stopPropagation()}),Rt.event.bind(this._content,"mousedown",t=>{t.stopPropagation()}),this._close=Object(Rt.query)(".bts-close",this._container),Rt.event.bind(this._close,"click",()=>{Object(Rt.classes)(this._container).add("hidden")}),this._icon=Object(Rt.query)(".bts-log-icon",this._container),Rt.event.bind(this._icon,"click",()=>{Object(Rt.classes)(this._container).add("hidden")}),this._canvas.getContainer().appendChild(this._container),this.paletteEntry=Object(Rt.domify)(`\n    <div class="bts-entry" title="Show Simulation Log">\n      ${se()}\n    </div>\n  `),Rt.event.bind(this.paletteEntry,"click",()=>{Object(Rt.classes)(this._container).remove("hidden")}),this._tokenSimulationPalette.addEntry(this.paletteEntry,3)},ze.prototype.toggle=function(){const t=this._container;Object(Rt.classes)(t).has("hidden")?Object(Rt.classes)(t).remove("hidden"):Object(Rt.classes)(t).add("hidden")},ze.prototype.log=function(t){const{text:e,type:n="info",icon:i=Ne,scope:o}=t;Object(Rt.classes)(this._placeholder).add("hidden");const s=new Date,r=s.toLocaleTimeString()+":"+s.getUTCMilliseconds();this._notifications.showNotification(t);const c=i.startsWith("<")?i:`<i class="${i}"></i>`,a=o&&o.colors,l=a?`style="background: ${a.primary}; color: ${a.auxiliary}"`:"",p=Object(Rt.domify)(`\n    <p class="bts-entry ${n} ${o&&this._scopeFilter.isShown(o)?"":"inactive"}" ${o?`data-scope-id="${o.id}"`:""}>\n      <span class="bts-date">${r}</span>\n      <span class="bts-icon">${c}</span>\n      <span class="bts-text">${e}</span>\n      ${o?`<span class="bts-scope" data-scope-id="${o.id}" ${l}>${o.id}</span>`:""}\n    </p>\n  `);Rt.delegate.bind(p,".bts-scope[data-scope-id]","click",t=>{this._scopeFilter.toggle(o)}),this._content.appendChild(p),this._content.scrollTop=this._content.scrollHeight},ze.prototype.clear=function(){for(;this._content.firstChild;)this._content.removeChild(this._content.firstChild);this._placeholder=Object(Rt.domify)('<p class="bts-entry placeholder">No Entries</p>'),this._content.appendChild(this._placeholder)},ze.$inject=["eventBus","notifications","tokenSimulationPalette","canvas","scopeFilter","simulator"];var Ge={__depends__:[Fe,Nt],__init__:["log"],log:["type",ze]};const qe=["bpmn:InclusiveGateway","bpmn:ComplexGateway"];function He(t,e,n,i,o){this._eventBus=t,this._elementRegistry=e,this._elementNotifications=o,this._notifications=i,this._canvasParent=n.getContainer().parentNode,t.on($t,t=>{t.active?this.enable():this.clear()})}He.prototype.getUnsupportedElements=function(){return this._unsupportedElements},He.prototype.enable=function(){const t=[];this._elementRegistry.forEach(e=>{(function(t){return t.labelTarget})(e)||vt(e,qe)&&(this.showWarning(e),t.push(e))}),t.length&&this._notifications.showNotification({text:"Found unsupported elements",icon:pe(),type:"warning",ttl:5e3}),this._unsupportedElements=t},He.prototype.clear=function(){Object(Rt.classes)(this._canvasParent).remove("warning")},He.prototype.showWarning=function(t){this._elementNotifications.addElementNotification(t,{type:"warning",icon:pe(),text:"Not supported"})},He.$inject=["eventBus","elementRegistry","canvas","notifications","elementNotifications"];var Ve={__depends__:[je,Fe],__init__:["elementSupport"],elementSupport:["type",He]};const Ye=me(),Ue=ue();function We(t,e,n,i){this._eventBus=t,this._tokenSimulationPalette=e,this._notifications=n,this.canvasParent=i.getContainer().parentNode,this.isActive=!1,this.isPaused=!0,this._init(),t.on(It,1500,t=>{this.activate(),this.unpause()}),t.on([At,$t],()=>{this.deactivate(),this.pause()}),t.on("tokenSimulation.simulator.trace",1500,t=>{this.unpause()})}We.prototype._init=function(){this.paletteEntry=Object(Rt.domify)(`\n    <div class="bts-entry disabled" title="Play/Pause Simulation">\n      ${Ye}\n    </div>\n  `),Rt.event.bind(this.paletteEntry,"click",this.toggle.bind(this)),this._tokenSimulationPalette.addEntry(this.paletteEntry,1)},We.prototype.toggle=function(){this.isPaused?this.unpause():this.pause()},We.prototype.pause=function(){this.isActive&&(Object(Rt.classes)(this.paletteEntry).remove("active"),Object(Rt.classes)(this.canvasParent).add("paused"),this.paletteEntry.innerHTML=Ye,this._eventBus.fire("tokenSimulation.pauseSimulation"),this._notifications.showNotification({text:"Pause Simulation"}),this.isPaused=!0)},We.prototype.unpause=function(){this.isActive&&this.isPaused&&(Object(Rt.classes)(this.paletteEntry).add("active"),Object(Rt.classes)(this.canvasParent).remove("paused"),this.paletteEntry.innerHTML=Ue,this._eventBus.fire("tokenSimulation.playSimulation"),this._notifications.showNotification({text:"Play Simulation"}),this.isPaused=!1)},We.prototype.activate=function(){this.isActive=!0,Object(Rt.classes)(this.paletteEntry).remove("disabled")},We.prototype.deactivate=function(){this.isActive=!1,Object(Rt.classes)(this.paletteEntry).remove("active"),Object(Rt.classes)(this.paletteEntry).add("disabled")},We.$inject=["eventBus","tokenSimulationPalette","notifications","canvas"];var Ze={__depends__:[Fe],__init__:["pauseSimulation"],pauseSimulation:["type",We]};function Je(t,e,n){this._eventBus=t,this._tokenSimulationPalette=e,this._notifications=n,this._init(),t.on(It,()=>{Object(Rt.classes)(this._paletteEntry).remove("disabled")}),t.on($t,t=>{(this._active=t.active)||this.resetSimulation()})}Je.prototype._init=function(){this._paletteEntry=Object(Rt.domify)(`\n    <div class="bts-entry disabled" title="Reset Simulation">\n      ${de()}\n    </div>\n  `),Rt.event.bind(this._paletteEntry,"click",()=>{this.resetSimulation(),this._notifications.showNotification({text:"Reset Simulation",type:"info"})}),this._tokenSimulationPalette.addEntry(this._paletteEntry,2)},Je.prototype.resetSimulation=function(){Object(Rt.classes)(this._paletteEntry).add("disabled"),this._eventBus.fire(At)},Je.$inject=["eventBus","tokenSimulationPalette","notifications"];var Ke={__depends__:[Fe],__init__:["resetSimulation"],resetSimulation:["type",Je]};function Qe(t,e,n,i,o){this._overlays=e,this._scopeFilter=i,this._simulator=n,this._simulationStyles=o,this.overlayIds={},t.on("tokenSimulation.simulator.elementChanged",500,t=>{const{element:e}=t;this.removeTokenCounts(e),this.addTokenCounts(e)}),t.on("tokenSimulation.scopeFilterChanged",t=>{const n=Object(Rt.queryAll)(".bts-token-count[data-scope-id]",e._overlayRoot);for(const t of n){const e=t.dataset.scopeId;Object(Rt.classes)(t).toggle("inactive",!this._scopeFilter.isShown(e))}})}Qe.prototype.addTokenCounts=function(t){if(vt(t,"bpmn:MessageFlow")||vt(t,"bpmn:SequenceFlow"))return;const e=this._simulator.findScopes(e=>!e.destroyed&&e.children.some(e=>!e.destroyed&&e.element===t&&!e.children.length));this.addTokenCount(t,e)},Qe.prototype.addTokenCount=function(t,e){if(!e.length)return;const n=e.map(e=>this._getTokenHTML(t,e)).join(""),i=Object(Rt.domify)(`\n    <div class="bts-token-count-parent">\n      ${n}\n    </div>\n  `),o={bottom:10,left:-15},s=this._overlays.add(t,"token-count",{position:o,html:i,show:{minZoom:.5}});this.overlayIds[t.id]=s},Qe.prototype.removeTokenCounts=function(t){this.removeTokenCount(t)},Qe.prototype.removeTokenCount=function(t){const e=this.overlayIds[t.id];e&&(this._overlays.remove(e),delete this.overlayIds[t.id])},Qe.prototype._getTokenHTML=function(t,e){const n=e.colors||this._getDefaultColors();return`\n    <div data-scope-id="${e.id}" class="bts-token-count waiting ${this._scopeFilter.isShown(e)?"":"inactive"}"\n         style="color: ${n.auxiliary}; background: ${n.primary}">\n      ${e.getTokensByElement(t)}\n    </div>\n  `},Qe.prototype._getDefaultColors=function(){return{primary:this._simulationStyles.get("--token-simulation-green-base-44"),auxiliary:this._simuationStyles.get("--token-simulation-white")}},Qe.$inject=["eventBus","overlays","simulator","scopeFilter","simulationStyles"];var Xe={__depends__:[Nt,Le],__init__:["tokenCount"],tokenCount:["type",Qe]};const tn=[["Slow",.5],["Normal",1],["Fast",2]];function en(t,e,n){this._canvas=t,this._animation=e,this._eventBus=n,this._init(e.getAnimationSpeed()),n.on($t,t=>{t.active?Object(Rt.classes)(this._container).remove("hidden"):Object(Rt.classes)(this._container).add("hidden")}),n.on("tokenSimulation.animationSpeedChanged",t=>{this.setActive(t.speed)})}en.prototype.getToggleSpeed=function(t){return parseFloat(t.dataset.speed)},en.prototype._init=function(t){this._container=Object(Rt.domify)(`\n    <div class="bts-set-animation-speed hidden">\n      ${fe()}\n      <div class="bts-animation-speed-buttons">\n        ${tn.map(([e,n],i)=>`\n            <button title="Set animation speed = ${e}" data-speed="${n}" class="bts-animation-speed-button ${n===t?"active":""}">\n              ${Array.from({length:i+1}).map(()=>re()).join("")}\n            </button>\n          `).join("")}\n      </div>\n    </div>\n  `),Rt.delegate.bind(this._container,"[data-speed]","click",t=>{const e=t.delegateTarget,n=this.getToggleSpeed(e);this._animation.setAnimationSpeed(n)}),this._canvas.getContainer().appendChild(this._container)},en.prototype.setActive=function(t){Object(Rt.queryAll)("[data-speed]",this._container).forEach(e=>{const n=this.getToggleSpeed(e)===t;Object(Rt.classes)(e)[n?"add":"remove"]("active")})},en.$inject=["canvas","animation","eventBus"];var nn={__init__:["setAnimationSpeed"],setAnimationSpeed:["type",en]};function on(t){return vt(t,"bpmn:SequenceFlow")}function sn(t,e,n,i,o){this._elementRegistry=e,this._elementColors=n,this._simulator=i,this._simulationStyles=o,t.on($t,t=>{t.active?this.setSequenceFlowsDefault():this.resetSequenceFlows()})}function rn(t,e){this._elementRegistry=t,this._graphicsFactory=e}function cn(t){return t.businessObject&&t.businessObject.di}function an(t){return"labelTarget"in t}sn.prototype.setSequenceFlowsDefault=function(){const t=this._elementRegistry.filter(t=>vt(t,"bpmn:ExclusiveGateway"));for(const e of t)this.setSequenceFlow(e)},sn.prototype.resetSequenceFlows=function(){this._elementRegistry.filter(t=>vt(t,"bpmn:ExclusiveGateway")).forEach(t=>{t.outgoing.filter(on).length&&this.resetSequenceFlow(t)})},sn.prototype.resetSequenceFlow=function(t){this._simulator.setConfig(t,{activeOutgoing:void 0})},sn.prototype.setSequenceFlow=function(t){const e=t.outgoing.filter(on);if(e.length<2)return;const{activeOutgoing:n}=this._simulator.getConfig(t);let i;i=n?function(t,e){var n=t.outgoing.filter(on),i=n.indexOf(e||t.sequenceFlow);return n[i+1]?n[i+1]:n[0]}(t,n):e[0],this._simulator.setConfig(t,{activeOutgoing:i}),t.outgoing.forEach(t=>{const e=t===i?"--token-simulation-grey-darken-30":"--token-simulation-grey-lighten-56",n=this._simulationStyles.get(e);this._elementColors.set(t,{stroke:n})})},sn.$inject=["eventBus","elementRegistry","elementColors","simulator","simulationStyles"],rn.$inject=["elementRegistry","graphicsFactory"],rn.prototype.get=function(t){const e=cn(t);if(e)return an(t)?{stroke:e.label&&e.label.get("color")}:{fill:e.get("background-color"),stroke:e.get("border-color")}},rn.prototype.set=function(t,e){const{fill:n,stroke:i}=e,o=cn(t);o&&(an(t)?o.label&&o.label.set("color",i):(o.set("background-color",n),o.set("border-color",i)),this._forceRedraw(t))},rn.prototype._forceRedraw=function(t){const e=this._elementRegistry.getGraphics(t),n=t.waypoints?"connection":"shape";this._graphicsFactory.update(n,t,e)};var ln={elementColors:["type",rn]},pn={__depends__:[ln,Le],exclusiveGatewaySettings:["type",sn]};function hn(t,e,n){this._elementRegistry=e,this._elementColors=n,this._colorCache={},t.on($t,5e4,t=>{t.active?this.preserveColors():this.resetColors()})}hn.prototype.preserveColors=function(){this._elementRegistry.forEach(t=>{this._colorCache[t.id]=this._elementColors.get(t),this._elementColors.set(t,{stroke:"#000",fill:"#fff"})})},hn.prototype.resetColors=function(){this._elementRegistry.forEach(t=>{const e=this._colorCache[t.id];e&&this._elementColors.set(t,e)}),this._colorCache={}},hn.$inject=["eventBus","elementRegistry","elementColors"];var un={__depends__:[ln],__init__:["preserveElementColors"],preserveElementColors:["type",hn]};function mn(t,e){var n=this;this._canvas=e,this.entries=[],this._init(),t.on($t,(function(t){t.active?Object(Rt.classes)(n.container).remove("hidden"):Object(Rt.classes)(n.container).add("hidden")}))}mn.prototype._init=function(){this.container=Object(Rt.domify)('<div class="bts-palette hidden"></div>'),this._canvas.getContainer().appendChild(this.container)},mn.prototype.addEntry=function(t,e){var n=0;this.entries.forEach((function(t){e>=t.index&&n++})),this.container.insertBefore(t,this.container.childNodes[n]),this.entries.push({entry:t,index:e})},mn.$inject=["eventBus","canvas"];var dn={__depends__:[Bt,Xt,ie,Ce,$e,Me,Ge,Ve,Ze,Ke,Xe,nn,pn,un,{__init__:["tokenSimulationPalette"],tokenSimulationPalette:["type",mn]}]};function fn(t,e,n,i,o,s,r,c){let a=!1;function l(t,e,n){const i=t[e];t[e]=function(){return n.call(this,i,arguments)}}function p(t,e){l(t,e,(function(t,e){if(!a)return t.apply(this,e)}))}function h(t,e){l(t,e,(function(t,e){if(a)throw new Error("model is read-only");return t.apply(this,e)}))}t.on($t,10001,t=>{a=t.active,a&&(i.cancel(),e.close(),n.cancel()),r._update()}),p(e,"open"),p(n,"init"),p(i,"activate"),p(n,"init"),p(i,"activate"),h(s,"moveShape"),h(s,"updateAttachment"),h(s,"moveElements"),h(s,"moveConnection"),h(s,"layoutConnection"),h(s,"createConnection"),h(s,"createShape"),h(s,"createLabel"),h(s,"appendShape"),h(s,"removeElements"),h(s,"distributeElements"),h(s,"removeShape"),h(s,"removeConnection"),h(s,"replaceShape"),h(s,"pasteElements"),h(s,"alignElements"),h(s,"resizeShape"),h(s,"createSpace"),h(s,"updateWaypoints"),h(s,"reconnectStart"),h(s,"reconnectEnd"),l(o,"trigger",(function(t,e){const n=e[0];if(!a||!function(t,e){return t.indexOf(e)>-1}(["undo","redo","copy","paste","removeSelection","spaceTool","lassoTool","globalConnectTool","distributeElements","alignElements","directEditing"],n))return t.apply(this,e)}))}fn.$inject=["eventBus","contextPad","dragging","directEditing","editorActions","modeling","palette","paletteProvider"];var vn={__init__:["disableModeling"],disableModeling:["type",fn]};function gn(t,e,n,i){this._eventBus=t,this._canvas=e,this._selection=n,this._contextPad=i,this._active=!1,t.on("import.parse.start",()=>{this._active&&(this.toggleMode(!1),t.once("import.done",()=>{this.toggleMode(!0)}))}),t.on("diagram.init",()=>{this._canvasParent=this._canvas.getContainer().parentNode,this._palette=Object(Rt.query)(".djs-palette",this._canvas.getContainer()),this._init()})}gn.prototype._init=function(){this._container=Object(Rt.domify)(`\n    <div class="bts-toggle-mode">\n      Token Simulation <span class="bts-toggle">${_e()}</span>\n    </div>\n  `),Rt.event.bind(this._container,"click",()=>this.toggleMode()),this._canvas.getContainer().appendChild(this._container)},gn.prototype.toggleMode=function(t=!this._active){if(t!==this._active){if(t)this._container.innerHTML=`Token Simulation <span class="bts-toggle">${ye()}</span>`,Object(Rt.classes)(this._canvasParent).add("simulation"),Object(Rt.classes)(this._palette).add("hidden");else{this._container.innerHTML=`Token Simulation <span class="bts-toggle">${_e()}</span>`,Object(Rt.classes)(this._canvasParent).remove("simulation"),Object(Rt.classes)(this._palette).remove("hidden");const t=this._selection.get();1===t.length&&this._contextPad.open(t[0])}this._eventBus.fire($t,{active:t}),this._active=t}},gn.$inject=["eventBus","canvas","selection","contextPad"];var _n={__init__:["toggleMode"],toggleMode:["type",gn]};function yn(t,e,n,i,o,s){o.register({toggleTokenSimulation:function(){e.toggleMode()}}),o.register({togglePauseTokenSimulation:function(){n.toggle()}}),o.register({resetTokenSimulation:function(){i.resetSimulation()}});const r=s.get("log",!1);r&&o.register({toggleTokenSimulationLog:function(){r.toggle()}})}yn.$inject=["eventBus","toggleMode","pauseSimulation","resetSimulation","editorActions","injector"];var bn={__init__:["tokenSimulationEditorActions"],tokenSimulationEditorActions:["type",yn]};function wn(t,e){var n=e.get("editorActions",!1),i=e.get("keyboard",!1);if(i&&n){var o=!1;t.on("keyboard.init",(function(){i.addListener(1e4,(function(t){!function(t){Sn(["t","T"],t)?n.trigger("toggleTokenSimulation"):o&&(Sn(["l","L"],t)?n.trigger("toggleTokenSimulationLog"):Sn([" ","Spacebar"],t)?n.trigger("togglePauseTokenSimulation"):Sn(["r","R"],t)&&n.trigger("resetTokenSimulation"))}(t.keyEvent)}))})),t.on($t,(function(t){var e=t.active;o=!!e}))}}function Sn(t,e){return t.indexOf(e.key)>-1}wn.$inject=["eventBus","injector"];var En={__init__:["tokenSimulationKeyboardBindings"],tokenSimulationKeyboardBindings:["type",wn]};e.a={__depends__:[dn,vn,_n,bn,En]}}}]);